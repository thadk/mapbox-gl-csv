!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;((g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mapboxgl||(g.mapboxgl={})).CSVSource=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function CSVSource(id,options,dispatcher){GeoJSONSource.call(this,id,options,dispatcher)}var util=require("mapbox-gl/js/util/util"),GeoJSONSource=require("mapbox-gl/js/source/geojson_source"),webworkify=require("webworkify");module.exports=CSVSource,CSVSource.prototype=util.inherit(GeoJSONSource,{type:"csv"}),CSVSource.workerSourceURL=URL.createObjectURL(webworkify(require("./csv_worker.js"),{bare:!0}))},{"./csv_worker.js":2,"mapbox-gl/js/source/geojson_source":35,"mapbox-gl/js/util/util":61,webworkify:78}],2:[function(require,module,exports){function loadGeoJSON(params,callback){console.log("data0",params);var getCSVCallback=function(err,csvdata){if(err)return callback(err);csv2geojson.csv2geojson(csvdata,params,callback)};getCSV(params.url,getCSVCallback)}function CSVWorkerSource(actor,style){GeoJSONWorkerSource.call(this,actor,style,loadGeoJSON)}var util=require("mapbox-gl/js/util/util"),csv2geojson=require("csv2geojson"),GeoJSONWorkerSource=require("mapbox-gl/js/source/geojson_worker_source"),getCSV=function(url,callback){var xhr=new XMLHttpRequest;return xhr.open("GET",url,!0),xhr.setRequestHeader("Accept","text/plain"),xhr.onerror=function(e){callback(e)},xhr.onload=function(){if(xhr.status>=200&&xhr.status<300&&xhr.response){var data;try{data=xhr.response}catch(err){return callback(err)}callback(null,data)}else callback(new Error(xhr.statusText))},xhr.send(),xhr};CSVWorkerSource.prototype=util.inherit(GeoJSONWorkerSource),module.exports=function(self){self.registerWorkerSource("csv",CSVWorkerSource)}},{csv2geojson:3,"mapbox-gl/js/source/geojson_worker_source":36,"mapbox-gl/js/util/util":61}],3:[function(require,module,exports){"use strict";function guessHeader(row,regexp){var name,match,score;for(var f in row)(match=f.match(regexp))&&(!name||match[0].length/f.length>score)&&(score=match[0].length/f.length,name=f);return name}function guessLatHeader(row){return guessHeader(row,latRegex)}function guessLonHeader(row){return guessHeader(row,lonRegex)}function isLat(f){return!!f.match(latRegex)}function isLon(f){return!!f.match(lonRegex)}function keyCount(o){return"object"==typeof o?Object.keys(o).length:0}function autoDelimiter(x){var results=[];return[",",";","\t","|"].forEach(function(delimiter){var res=dsv.dsvFormat(delimiter).parse(x);if(res.length>=1){for(var count=keyCount(res[0]),i=0;i<res.length;i++)if(keyCount(res[i])!==count)return;results.push({delimiter:delimiter,arity:Object.keys(res[0]).length})}}),results.length?results.sort(function(a,b){return b.arity-a.arity})[0].delimiter:null}function deleteColumns(x){return delete x.columns,x}function auto(x){var delimiter=autoDelimiter(x);return delimiter?deleteColumns(dsv.dsvFormat(delimiter).parse(x)):null}function csv2geojson(x,options,callback){callback||(callback=options,options={}),options.delimiter=options.delimiter||",";var latfield=options.latfield||"",lonfield=options.lonfield||"",crs=options.crs||"",features=[],featurecollection={type:"FeatureCollection",features:features};if(""!==crs&&(featurecollection.crs={type:"name",properties:{name:crs}}),"auto"!==options.delimiter||"string"!=typeof x||(options.delimiter=autoDelimiter(x),options.delimiter)){var parsed="string"==typeof x?dsv.dsvFormat(options.delimiter).parse(x):x;if(parsed.length){var i,errors=[];if(latfield||(latfield=guessLatHeader(parsed[0])),lonfield||(lonfield=guessLonHeader(parsed[0])),!latfield||!lonfield){for(i=0;i<parsed.length;i++)features.push({type:"Feature",properties:parsed[i],geometry:null});callback(errors.length?errors:null,featurecollection)}else{for(i=0;i<parsed.length;i++)if(void 0!==parsed[i][lonfield]&&void 0!==parsed[i][latfield]){var lonf,latf,a,lonk=parsed[i][lonfield],latk=parsed[i][latfield];(a=sexagesimal(lonk,"EW"))&&(lonk=a),(a=sexagesimal(latk,"NS"))&&(latk=a),lonf=parseFloat(lonk),latf=parseFloat(latk),isNaN(lonf)||isNaN(latf)?errors.push({message:"A row contained an invalid value for latitude or longitude",row:parsed[i],index:i}):(options.includeLatLon||(delete parsed[i][lonfield],delete parsed[i][latfield]),features.push({type:"Feature",properties:parsed[i],geometry:{type:"Point",coordinates:[parseFloat(lonf),parseFloat(latf)]}}))}callback(errors.length?errors:null,featurecollection)}}else callback(null,featurecollection)}else callback({type:"Error",message:"Could not autodetect delimiter"})}function toLine(gj){for(var features=gj.features,line={type:"Feature",geometry:{type:"LineString",coordinates:[]}},i=0;i<features.length;i++)line.geometry.coordinates.push(features[i].geometry.coordinates);return line.properties=features.reduce(function(aggregatedProperties,newFeature){for(var key in newFeature.properties)aggregatedProperties[key]||(aggregatedProperties[key]=[]),aggregatedProperties[key].push(newFeature.properties[key]);return aggregatedProperties},{}),{type:"FeatureCollection",features:[line]}}function toPolygon(gj){for(var features=gj.features,poly={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}},i=0;i<features.length;i++)poly.geometry.coordinates[0].push(features[i].geometry.coordinates);return poly.properties=features.reduce(function(aggregatedProperties,newFeature){for(var key in newFeature.properties)aggregatedProperties[key]||(aggregatedProperties[key]=[]),aggregatedProperties[key].push(newFeature.properties[key]);return aggregatedProperties},{}),{type:"FeatureCollection",features:[poly]}}var dsv=require("d3-dsv"),sexagesimal=require("sexagesimal"),latRegex=/(Lat)(itude)?/gi,lonRegex=/(L)(on|ng)(gitude)?/i;module.exports={isLon:isLon,isLat:isLat,guessLatHeader:guessLatHeader,guessLonHeader:guessLonHeader,csv:dsv.csvParse,tsv:dsv.tsvParse,dsv:dsv,auto:auto,csv2geojson:csv2geojson,toLine:toLine,toPolygon:toPolygon}},{"d3-dsv":4,sexagesimal:68}],4:[function(require,module,exports){!function(global,factory){factory("object"==typeof exports&&void 0!==module?exports:global.d3=global.d3||{})}(this,function(exports){"use strict";function objectConverter(columns){return new Function("d","return {"+columns.map(function(name,i){return JSON.stringify(name)+": d["+i+"]"}).join(",")+"}")}function customConverter(columns,f){var object=objectConverter(columns);return function(row,i){return f(object(row),i,columns)}}function inferColumns(rows){var columnSet=Object.create(null),columns=[];return rows.forEach(function(row){for(var column in row)column in columnSet||columns.push(columnSet[column]=column)}),columns}function dsv(delimiter){function parse(text,f){var convert,columns,rows=parseRows(text,function(row,i){if(convert)return convert(row,i-1);columns=row,convert=f?customConverter(row,f):objectConverter(row)});return rows.columns=columns,rows}function parseRows(text,f){function token(){if(I>=N)return EOF;if(eol)return eol=!1,EOL;var c,j=I;if(34===text.charCodeAt(j)){for(var i=j;i++<N;)if(34===text.charCodeAt(i)){if(34!==text.charCodeAt(i+1))break;++i}return I=i+2,c=text.charCodeAt(i+1),13===c?(eol=!0,10===text.charCodeAt(i+2)&&++I):10===c&&(eol=!0),text.slice(j+1,i).replace(/""/g,'"')}for(;I<N;){var k=1;if(10===(c=text.charCodeAt(I++)))eol=!0;else if(13===c)eol=!0,10===text.charCodeAt(I)&&(++I,++k);else if(c!==delimiterCode)continue;return text.slice(j,I-k)}return text.slice(j)}for(var t,eol,EOL={},EOF={},rows=[],N=text.length,I=0,n=0;(t=token())!==EOF;){for(var a=[];t!==EOL&&t!==EOF;)a.push(t),t=token();f&&null==(a=f(a,n++))||rows.push(a)}return rows}function format(rows,columns){return null==columns&&(columns=inferColumns(rows)),[columns.map(formatValue).join(delimiter)].concat(rows.map(function(row){return columns.map(function(column){return formatValue(row[column])}).join(delimiter)})).join("\n")}function formatRows(rows){return rows.map(formatRow).join("\n")}function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(text){return null==text?"":reFormat.test(text+="")?'"'+text.replace(/\"/g,'""')+'"':text}var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);return{parse:parse,parseRows:parseRows,format:format,formatRows:formatRows}}var csv=dsv(","),csvParse=csv.parse,csvParseRows=csv.parseRows,csvFormat=csv.format,csvFormatRows=csv.formatRows,tsv=dsv("\t"),tsvParse=tsv.parse,tsvParseRows=tsv.parseRows,tsvFormat=tsv.format,tsvFormatRows=tsv.formatRows;exports.dsvFormat=dsv,exports.csvParse=csvParse,exports.csvParseRows=csvParseRows,exports.csvFormat=csvFormat,exports.csvFormatRows=csvFormatRows,exports.tsvParse=tsvParse,exports.tsvParseRows=tsvParseRows,exports.tsvFormat=tsvFormat,exports.tsvFormatRows=tsvFormatRows,Object.defineProperty(exports,"__esModule",{value:!0})})},{}],5:[function(require,module,exports){"use strict";function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,size;if(hasHoles&&(outerNode=eliminateHoles(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)x=data[i],y=data[i+1],x<minX&&(minX=x),y<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);size=Math.max(maxX-minX,maxY-minY)}return earcutLinked(outerNode,triangles,dim,minX,minY,size),triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)return null;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(ear){!pass&&size&&indexCurve(ear,minX,minY,size);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,size?isEarHashed(ear,minX,minY,size):isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(ear,triangles,dim),triangles,dim,minX,minY,size,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,size):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,size,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size),p=ear.nextZ;p&&p.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=ear.prevZ;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,size),void earcutLinked(c,triangles,dim,minX,minY,size)}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var i,len,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)(list=linkedList(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)eliminateHole(queue[i],outerNode),outerNode=filterPoints(outerNode,outerNode.next);return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){if(outerNode=findHoleBridge(hole,outerNode)){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){if(qx=x,x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;for(p=m.next;p!==stop;)hx>=p.x&&p.x>=mx&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&((tan=Math.abs(hy-p.y)/(hx-p.x))<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)&&(m=p,tanMin=tan),p=p.next;return m}function indexCurve(start,minX,minY,size){var p=start;do{null===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,size)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0===pSize?(e=q,q=q.nextZ,qSize--):0!==qSize&&q?p.z<=q.z?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--):(e=p,p=p.nextZ,pSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){return x=32767*(x-minX)/size,y=32767*(y-minY)/size,x=16711935&(x|x<<8),x=252645135&(x|x<<4),x=858993459&(x|x<<2),x=1431655765&(x|x<<1),y=16711935&(y|y<<8),y=252645135&(y|y<<4),y=858993459&(y|y<<2),y=1431655765&(y|y<<1),x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{p.x<leftmost.x&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){return!!(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))||area(p1,q1,p2)>0!=area(p1,q1,q2)>0&&area(p2,q2,p1)>0!=area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}module.exports=earcut,earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&&0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&(holeIndex+=data[i-1].length,result.holes.push(holeIndex))}return result}},{}],6:[function(require,module,exports){"use strict";function createFilter(filter){return new Function("f","var p = (f && f.properties || {}); return "+compile(filter))}function compile(filter){if(!filter)return"true";var op=filter[0];return filter.length<=1?"any"===op?"false":"true":"("+("=="===op?compileComparisonOp(filter[1],filter[2],"===",!1):"!="===op?compileComparisonOp(filter[1],filter[2],"!==",!1):"<"===op||">"===op||"<="===op||">="===op?compileComparisonOp(filter[1],filter[2],op,!0):"any"===op?compileLogicalOp(filter.slice(1),"||"):"all"===op?compileLogicalOp(filter.slice(1),"&&"):"none"===op?compileNegation(compileLogicalOp(filter.slice(1),"||")):"in"===op?compileInOp(filter[1],filter.slice(2)):"!in"===op?compileNegation(compileInOp(filter[1],filter.slice(2))):"has"===op?compileHasOp(filter[1]):"!has"===op?compileNegation(compileHasOp([filter[1]])):"true")+")"}function compilePropertyReference(property){return"$type"===property?"f.type":"$id"===property?"f.id":"p["+JSON.stringify(property)+"]"}function compileComparisonOp(property,value,op,checkType){var left=compilePropertyReference(property),right="$type"===property?types.indexOf(value):JSON.stringify(value);return(checkType?"typeof "+left+"=== typeof "+right+"&&":"")+left+op+right}function compileLogicalOp(expressions,op){return expressions.map(compile).join(op)}function compileInOp(property,values){"$type"===property&&(values=values.map(function(value){return types.indexOf(value)}));var left=JSON.stringify(values.sort(compare)),right=compilePropertyReference(property);return values.length<=200?left+".indexOf("+right+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+right+", "+left+",0,"+(values.length-1)+")"}function compileHasOp(property){return JSON.stringify(property)+" in p"}function compileNegation(expression){return"!("+expression+")"}function compare(a,b){return a<b?-1:a>b?1:0}module.exports=createFilter;var types=["Unknown","Point","LineString","Polygon"]},{}],7:[function(require,module,exports){function geometry(_){if("Polygon"===_.type)return polygonArea(_.coordinates);if("MultiPolygon"===_.type){for(var area=0,i=0;i<_.coordinates.length;i++)area+=polygonArea(_.coordinates[i]);return area}return null}function polygonArea(coords){var area=0;if(coords&&coords.length>0){area+=Math.abs(ringArea(coords[0]));for(var i=1;i<coords.length;i++)area-=Math.abs(ringArea(coords[i]))}return area}function ringArea(coords){var area=0;if(coords.length>2){for(var p1,p2,i=0;i<coords.length-1;i++)p1=coords[i],area+=rad((p2=coords[i+1])[0]-p1[0])*(2+Math.sin(rad(p1[1]))+Math.sin(rad(p2[1])));area=area*wgs84.RADIUS*wgs84.RADIUS/2}return area}function rad(_){return _*Math.PI/180}var wgs84=require("wgs84");module.exports.geometry=geometry,module.exports.ring=ringArea},{wgs84:79}],8:[function(require,module,exports){function rewind(gj,outer){switch(gj&&gj.type||null){case"FeatureCollection":return gj.features=gj.features.map(curryOuter(rewind,outer)),gj;case"Feature":return gj.geometry=rewind(gj.geometry,outer),gj;case"Polygon":case"MultiPolygon":return correct(gj,outer);default:return gj}}function curryOuter(a,b){return function(_){return a(_,b)}}function correct(_,outer){return"Polygon"===_.type?_.coordinates=correctRings(_.coordinates,outer):"MultiPolygon"===_.type&&(_.coordinates=_.coordinates.map(curryOuter(correctRings,outer))),_}function correctRings(_,outer){outer=!!outer,_[0]=wind(_[0],!outer);for(var i=1;i<_.length;i++)_[i]=wind(_[i],outer);return _}function wind(_,dir){return cw(_)===dir?_:_.reverse()}function cw(_){return geojsonArea.ring(_)>=0}var geojsonArea=require("geojson-area");module.exports=rewind},{"geojson-area":7}],9:[function(require,module,exports){"use strict";function clip(features,scale,k1,k2,axis,intersect,minAll,maxAll){if(k1/=scale,k2/=scale,minAll>=k1&&maxAll<=k2)return features;if(minAll>k2||maxAll<k1)return null;for(var clipped=[],i=0;i<features.length;i++){var min,max,feature=features[i],geometry=feature.geometry,type=feature.type;if(min=feature.min[axis],max=feature.max[axis],min>=k1&&max<=k2)clipped.push(feature);else if(!(min>k2||max<k1)){var slices=1===type?clipPoints(geometry,k1,k2,axis):clipGeometry(geometry,k1,k2,axis,intersect,3===type);slices.length&&clipped.push(createFeature(feature.tags,type,slices,feature.id))}}return clipped.length?clipped:null}function clipPoints(geometry,k1,k2,axis){for(var slice=[],i=0;i<geometry.length;i++){var a=geometry[i],ak=a[axis];ak>=k1&&ak<=k2&&slice.push(a)}return slice}function clipGeometry(geometry,k1,k2,axis,intersect,closed){for(var slices=[],i=0;i<geometry.length;i++){var a,j,last,ak=0,bk=0,b=null,points=geometry[i],area=points.area,dist=points.dist,outer=points.outer,len=points.length,slice=[];for(j=0;j<len-1;j++)a=b||points[j],b=points[j+1],ak=bk||a[axis],bk=b[axis],ak<k1?bk>k2?(slice.push(intersect(a,b,k1),intersect(a,b,k2)),closed||(slice=newSlice(slices,slice,area,dist,outer))):bk>=k1&&slice.push(intersect(a,b,k1)):ak>k2?bk<k1?(slice.push(intersect(a,b,k2),intersect(a,b,k1)),closed||(slice=newSlice(slices,slice,area,dist,outer))):bk<=k2&&slice.push(intersect(a,b,k2)):(slice.push(a),bk<k1?(slice.push(intersect(a,b,k1)),closed||(slice=newSlice(slices,slice,area,dist,outer))):bk>k2&&(slice.push(intersect(a,b,k2)),closed||(slice=newSlice(slices,slice,area,dist,outer))));(ak=(a=points[len-1])[axis])>=k1&&ak<=k2&&slice.push(a),last=slice[slice.length-1],closed&&last&&(slice[0][0]!==last[0]||slice[0][1]!==last[1])&&slice.push(slice[0]),newSlice(slices,slice,area,dist,outer)}return slices}function newSlice(slices,slice,area,dist,outer){return slice.length&&(slice.area=area,slice.dist=dist,void 0!==outer&&(slice.outer=outer),slices.push(slice)),[]}module.exports=clip;var createFeature=require("./feature")},{"./feature":11}],10:[function(require,module,exports){"use strict";function convert(data,tolerance){var features=[];if("FeatureCollection"===data.type)for(var i=0;i<data.features.length;i++)convertFeature(features,data.features[i],tolerance);else"Feature"===data.type?convertFeature(features,data,tolerance):convertFeature(features,{geometry:data},tolerance);return features}function convertFeature(features,feature,tolerance){if(null!==feature.geometry){var i,j,rings,projectedRing,geom=feature.geometry,type=geom.type,coords=geom.coordinates,tags=feature.properties,id=feature.id;if("Point"===type)features.push(createFeature(tags,1,[projectPoint(coords)],id));else if("MultiPoint"===type)features.push(createFeature(tags,1,project(coords),id));else if("LineString"===type)features.push(createFeature(tags,2,[project(coords,tolerance)],id));else if("MultiLineString"===type||"Polygon"===type){for(rings=[],i=0;i<coords.length;i++)projectedRing=project(coords[i],tolerance),"Polygon"===type&&(projectedRing.outer=0===i),rings.push(projectedRing);features.push(createFeature(tags,"Polygon"===type?3:2,rings,id))}else if("MultiPolygon"===type){for(rings=[],i=0;i<coords.length;i++)for(j=0;j<coords[i].length;j++)(projectedRing=project(coords[i][j],tolerance)).outer=0===j,rings.push(projectedRing);features.push(createFeature(tags,3,rings,id))}else{if("GeometryCollection"!==type)throw new Error("Input data is not a valid GeoJSON object.");for(i=0;i<geom.geometries.length;i++)convertFeature(features,{geometry:geom.geometries[i],properties:tags},tolerance)}}}function project(lonlats,tolerance){for(var projected=[],i=0;i<lonlats.length;i++)projected.push(projectPoint(lonlats[i]));return tolerance&&(simplify(projected,tolerance),calcSize(projected)),projected}function projectPoint(p){var sin=Math.sin(p[1]*Math.PI/180),x=p[0]/360+.5,y=.5-.25*Math.log((1+sin)/(1-sin))/Math.PI;return y=y<0?0:y>1?1:y,[x,y,0]}function calcSize(points){for(var a,b,area=0,dist=0,i=0;i<points.length-1;i++)a=b||points[i],b=points[i+1],area+=a[0]*b[1]-b[0]*a[1],dist+=Math.abs(b[0]-a[0])+Math.abs(b[1]-a[1]);points.area=Math.abs(area/2),points.dist=dist}module.exports=convert;var simplify=require("./simplify"),createFeature=require("./feature")},{"./feature":11,"./simplify":13}],11:[function(require,module,exports){"use strict";function createFeature(tags,type,geom,id){var feature={id:id||null,type:type,geometry:geom,tags:tags||null,min:[1/0,1/0],max:[-1/0,-1/0]};return calcBBox(feature),feature}function calcBBox(feature){var geometry=feature.geometry,min=feature.min,max=feature.max;if(1===feature.type)calcRingBBox(min,max,geometry);else for(var i=0;i<geometry.length;i++)calcRingBBox(min,max,geometry[i]);return feature}function calcRingBBox(min,max,points){for(var p,i=0;i<points.length;i++)p=points[i],min[0]=Math.min(p[0],min[0]),max[0]=Math.max(p[0],max[0]),min[1]=Math.min(p[1],min[1]),max[1]=Math.max(p[1],max[1])}module.exports=createFeature},{}],12:[function(require,module,exports){"use strict";function geojsonvt(data,options){return new GeoJSONVT(data,options)}function GeoJSONVT(data,options){var debug=(options=this.options=extend(Object.create(this.options),options)).debug;debug&&console.time("preprocess data");var z2=1<<options.maxZoom,features=convert(data,options.tolerance/(z2*options.extent));this.tiles={},this.tileCoords=[],debug&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",options.indexMaxZoom,options.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(features=wrap(features,options.buffer/options.extent,intersectX)).length&&this.splitTile(features,0,0,0),debug&&(features.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(z,x,y){return 32*((1<<z)*y+x)+z}function intersectX(a,b,x){return[x,(x-a[0])*(b[1]-a[1])/(b[0]-a[0])+a[1],1]}function intersectY(a,b,y){return[(y-a[1])*(b[0]-a[0])/(b[1]-a[1])+a[0],y,1]}function extend(dest,src){for(var i in src)dest[i]=src[i];return dest}function isClippedSquare(tile,extent,buffer){var features=tile.source;if(1!==features.length)return!1;var feature=features[0];if(3!==feature.type||feature.geometry.length>1)return!1;var len=feature.geometry[0].length;if(5!==len)return!1;for(var i=0;i<len;i++){var p=transform.point(feature.geometry[0][i],extent,tile.z2,tile.x,tile.y);if(p[0]!==-buffer&&p[0]!==extent+buffer||p[1]!==-buffer&&p[1]!==extent+buffer)return!1}return!0}module.exports=geojsonvt;var convert=require("./convert"),transform=require("./transform"),clip=require("./clip"),wrap=require("./wrap"),createTile=require("./tile");GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},GeoJSONVT.prototype.splitTile=function(features,z,x,y,cz,cx,cy){for(var stack=[features,z,x,y],options=this.options,debug=options.debug,solid=null;stack.length;){y=stack.pop(),x=stack.pop(),z=stack.pop(),features=stack.pop();var z2=1<<z,id=toID(z,x,y),tile=this.tiles[id],tileTolerance=z===options.maxZoom?0:options.tolerance/(z2*options.extent);if(!tile&&(debug>1&&console.time("creation"),tile=this.tiles[id]=createTile(features,z2,x,y,tileTolerance,z===options.maxZoom),this.tileCoords.push({z:z,x:x,y:y}),debug)){debug>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,x,y,tile.numFeatures,tile.numPoints,tile.numSimplified),console.timeEnd("creation"));var key="z"+z;this.stats[key]=(this.stats[key]||0)+1,this.total++}if(tile.source=features,cz){if(z===options.maxZoom||z===cz)continue;var m=1<<cz-z;if(x!==Math.floor(cx/m)||y!==Math.floor(cy/m))continue}else if(z===options.indexMaxZoom||tile.numPoints<=options.indexMaxPoints)continue;if(options.solidChildren||!isClippedSquare(tile,options.extent,options.buffer)){tile.source=null,debug>1&&console.time("clipping");var tl,bl,tr,br,left,right,k1=.5*options.buffer/options.extent,k2=.5-k1,k3=.5+k1,k4=1+k1;tl=bl=tr=br=null,left=clip(features,z2,x-k1,x+k3,0,intersectX,tile.min[0],tile.max[0]),right=clip(features,z2,x+k2,x+k4,0,intersectX,tile.min[0],tile.max[0]),left&&(tl=clip(left,z2,y-k1,y+k3,1,intersectY,tile.min[1],tile.max[1]),bl=clip(left,z2,y+k2,y+k4,1,intersectY,tile.min[1],tile.max[1])),right&&(tr=clip(right,z2,y-k1,y+k3,1,intersectY,tile.min[1],tile.max[1]),br=clip(right,z2,y+k2,y+k4,1,intersectY,tile.min[1],tile.max[1])),debug>1&&console.timeEnd("clipping"),features.length&&(stack.push(tl||[],z+1,2*x,2*y),stack.push(bl||[],z+1,2*x,2*y+1),stack.push(tr||[],z+1,2*x+1,2*y),stack.push(br||[],z+1,2*x+1,2*y+1))}else cz&&(solid=z)}return solid},GeoJSONVT.prototype.getTile=function(z,x,y){var options=this.options,extent=options.extent,debug=options.debug,z2=1<<z,id=toID(z,x=(x%z2+z2)%z2,y);if(this.tiles[id])return transform.tile(this.tiles[id],extent);debug>1&&console.log("drilling down to z%d-%d-%d",z,x,y);for(var parent,z0=z,x0=x,y0=y;!parent&&z0>0;)z0--,x0=Math.floor(x0/2),y0=Math.floor(y0/2),parent=this.tiles[toID(z0,x0,y0)];if(!parent||!parent.source)return null;if(debug>1&&console.log("found parent tile z%d-%d-%d",z0,x0,y0),isClippedSquare(parent,extent,options.buffer))return transform.tile(parent,extent);debug>1&&console.time("drilling down");var solid=this.splitTile(parent.source,z0,x0,y0,z,x,y);if(debug>1&&console.timeEnd("drilling down"),null!==solid){var m=1<<z-solid;id=toID(solid,Math.floor(x/m),Math.floor(y/m))}return this.tiles[id]?transform.tile(this.tiles[id],extent):null}},{"./clip":9,"./convert":10,"./tile":14,"./transform":15,"./wrap":16}],13:[function(require,module,exports){"use strict";function simplify(points,tolerance){var i,maxSqDist,sqDist,index,sqTolerance=tolerance*tolerance,first=0,last=points.length-1,stack=[];for(points[first][2]=1,points[last][2]=1;last;){for(maxSqDist=0,i=first+1;i<last;i++)(sqDist=getSqSegDist(points[i],points[first],points[last]))>maxSqDist&&(index=i,maxSqDist=sqDist);maxSqDist>sqTolerance?(points[index][2]=maxSqDist,stack.push(first),stack.push(index),first=index):(last=stack.pop(),first=stack.pop())}}function getSqSegDist(p,a,b){var x=a[0],y=a[1],bx=b[0],by=b[1],px=p[0],py=p[1],dx=bx-x,dy=by-y;if(0!==dx||0!==dy){var t=((px-x)*dx+(py-y)*dy)/(dx*dx+dy*dy);t>1?(x=bx,y=by):t>0&&(x+=dx*t,y+=dy*t)}return dx=px-x,dy=py-y,dx*dx+dy*dy}module.exports=simplify},{}],14:[function(require,module,exports){"use strict";function createTile(features,z2,tx,ty,tolerance,noSimplify){for(var tile={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:tx,y:ty,z2:z2,transformed:!1,min:[2,1],max:[-1,0]},i=0;i<features.length;i++){tile.numFeatures++,addFeature(tile,features[i],tolerance,noSimplify);var min=features[i].min,max=features[i].max;min[0]<tile.min[0]&&(tile.min[0]=min[0]),min[1]<tile.min[1]&&(tile.min[1]=min[1]),max[0]>tile.max[0]&&(tile.max[0]=max[0]),max[1]>tile.max[1]&&(tile.max[1]=max[1])}return tile}function addFeature(tile,feature,tolerance,noSimplify){var i,j,ring,p,geom=feature.geometry,type=feature.type,simplified=[],sqTolerance=tolerance*tolerance;if(1===type)for(i=0;i<geom.length;i++)simplified.push(geom[i]),tile.numPoints++,tile.numSimplified++;else for(i=0;i<geom.length;i++)if(ring=geom[i],noSimplify||!(2===type&&ring.dist<tolerance||3===type&&ring.area<sqTolerance)){var simplifiedRing=[];for(j=0;j<ring.length;j++)p=ring[j],(noSimplify||p[2]>sqTolerance)&&(simplifiedRing.push(p),tile.numSimplified++),tile.numPoints++;3===type&&rewind(simplifiedRing,ring.outer),simplified.push(simplifiedRing)}else tile.numPoints+=ring.length;if(simplified.length){var tileFeature={geometry:simplified,type:type,tags:feature.tags||null};null!==feature.id&&(tileFeature.id=feature.id),tile.features.push(tileFeature)}}function rewind(ring,clockwise){signedArea(ring)<0===clockwise&&ring.reverse()}function signedArea(ring){for(var p1,p2,sum=0,i=0,len=ring.length,j=len-1;i<len;j=i++)p1=ring[i],sum+=((p2=ring[j])[0]-p1[0])*(p1[1]+p2[1]);return sum}module.exports=createTile},{}],15:[function(require,module,exports){"use strict";function transformTile(tile,extent){if(tile.transformed)return tile;var i,j,k,z2=tile.z2,tx=tile.x,ty=tile.y;for(i=0;i<tile.features.length;i++){var feature=tile.features[i],geom=feature.geometry;if(1===feature.type)for(j=0;j<geom.length;j++)geom[j]=transformPoint(geom[j],extent,z2,tx,ty);else for(j=0;j<geom.length;j++){var ring=geom[j];for(k=0;k<ring.length;k++)ring[k]=transformPoint(ring[k],extent,z2,tx,ty)}}return tile.transformed=!0,tile}function transformPoint(p,extent,z2,tx,ty){return[Math.round(extent*(p[0]*z2-tx)),Math.round(extent*(p[1]*z2-ty))]}exports.tile=transformTile,exports.point=transformPoint},{}],16:[function(require,module,exports){"use strict";function wrap(features,buffer,intersectX){var merged=features,left=clip(features,1,-1-buffer,buffer,0,intersectX,-1,2),right=clip(features,1,1-buffer,2+buffer,0,intersectX,-1,2);return(left||right)&&(merged=clip(features,1,-buffer,1+buffer,0,intersectX,-1,2)||[],left&&(merged=shiftFeatureCoords(left,1).concat(merged)),right&&(merged=merged.concat(shiftFeatureCoords(right,-1)))),merged}function shiftFeatureCoords(features,offset){for(var newFeatures=[],i=0;i<features.length;i++){var newGeometry,feature=features[i],type=feature.type;if(1===type)newGeometry=shiftCoords(feature.geometry,offset);else{newGeometry=[];for(var j=0;j<feature.geometry.length;j++)newGeometry.push(shiftCoords(feature.geometry[j],offset))}newFeatures.push(createFeature(feature.tags,type,newGeometry,feature.id))}return newFeatures}function shiftCoords(points,offset){var newPoints=[];newPoints.area=points.area,newPoints.dist=points.dist;for(var i=0;i<points.length;i++)newPoints.push([points[i][0]+offset,points[i][1],points[i][2]]);return newPoints}var clip=require("./clip"),createFeature=require("./feature");module.exports=wrap},{"./clip":9,"./feature":11}],17:[function(require,module,exports){"use strict";function GridIndex(extent,n,padding){var cells=this.cells=[];if(extent instanceof ArrayBuffer){this.arrayBuffer=extent;var array=new Int32Array(this.arrayBuffer);extent=array[0],n=array[1],padding=array[2],this.d=n+2*padding;for(var k=0;k<this.d*this.d;k++){var start=array[NUM_PARAMS+k],end=array[NUM_PARAMS+k+1];cells.push(start===end?null:array.subarray(start,end))}var keysOffset=array[NUM_PARAMS+cells.length],bboxesOffset=array[NUM_PARAMS+cells.length+1];this.keys=array.subarray(keysOffset,bboxesOffset),this.bboxes=array.subarray(bboxesOffset),this.insert=this._insertReadonly}else{this.d=n+2*padding;for(var i=0;i<this.d*this.d;i++)cells.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=extent,this.padding=padding,this.scale=n/extent,this.uid=0;var p=padding/n*extent;this.min=-p,this.max=extent+p}module.exports=GridIndex;var NUM_PARAMS=3;GridIndex.prototype.insert=function(key,x1,y1,x2,y2){this._forEachCell(x1,y1,x2,y2,this._insertCell,this.uid++),this.keys.push(key),this.bboxes.push(x1),this.bboxes.push(y1),this.bboxes.push(x2),this.bboxes.push(y2)},GridIndex.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},GridIndex.prototype._insertCell=function(x1,y1,x2,y2,cellIndex,uid){this.cells[cellIndex].push(uid)},GridIndex.prototype.query=function(x1,y1,x2,y2){var min=this.min,max=this.max;if(x1<=min&&y1<=min&&max<=x2&&max<=y2)return Array.prototype.slice.call(this.keys);var result=[],seenUids={};return this._forEachCell(x1,y1,x2,y2,this._queryCell,result,seenUids),result},GridIndex.prototype._queryCell=function(x1,y1,x2,y2,cellIndex,result,seenUids){var cell=this.cells[cellIndex];if(null!==cell)for(var keys=this.keys,bboxes=this.bboxes,u=0;u<cell.length;u++){var uid=cell[u];if(void 0===seenUids[uid]){var offset=4*uid;x1<=bboxes[offset+2]&&y1<=bboxes[offset+3]&&x2>=bboxes[offset+0]&&y2>=bboxes[offset+1]?(seenUids[uid]=!0,result.push(keys[uid])):seenUids[uid]=!1}}},GridIndex.prototype._forEachCell=function(x1,y1,x2,y2,fn,arg1,arg2){for(var cx1=this._convertToCellCoord(x1),cy1=this._convertToCellCoord(y1),cx2=this._convertToCellCoord(x2),cy2=this._convertToCellCoord(y2),x=cx1;x<=cx2;x++)for(var y=cy1;y<=cy2;y++){var cellIndex=this.d*y+x;if(fn.call(this,x1,y1,x2,y2,cellIndex,arg1,arg2))return}},GridIndex.prototype._convertToCellCoord=function(x){return Math.max(0,Math.min(this.d-1,Math.floor(x*this.scale)+this.padding))},GridIndex.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var cells=this.cells,metadataLength=NUM_PARAMS+this.cells.length+1+1,totalCellLength=0,i=0;i<this.cells.length;i++)totalCellLength+=this.cells[i].length;var array=new Int32Array(metadataLength+totalCellLength+this.keys.length+this.bboxes.length);array[0]=this.extent,array[1]=this.n,array[2]=this.padding;for(var offset=metadataLength,k=0;k<cells.length;k++){var cell=cells[k];array[NUM_PARAMS+k]=offset,array.set(cell,offset),offset+=cell.length}return array[NUM_PARAMS+cells.length]=offset,array.set(this.keys,offset),offset+=this.keys.length,array[NUM_PARAMS+cells.length+1]=offset,array.set(this.bboxes,offset),offset+=this.bboxes.length,array.buffer}},{}],18:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],19:[function(require,module,exports){"use strict";function kdbush(points,getX,getY,nodeSize,ArrayType){return new KDBush(points,getX,getY,nodeSize,ArrayType)}function KDBush(points,getX,getY,nodeSize,ArrayType){getX=getX||defaultGetX,getY=getY||defaultGetY,ArrayType=ArrayType||Array,this.nodeSize=nodeSize||64,this.points=points,this.ids=new ArrayType(points.length),this.coords=new ArrayType(2*points.length);for(var i=0;i<points.length;i++)this.ids[i]=i,this.coords[2*i]=getX(points[i]),this.coords[2*i+1]=getY(points[i]);sort(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function defaultGetX(p){return p[0]}function defaultGetY(p){return p[1]}var sort=require("./sort"),range=require("./range"),within=require("./within");module.exports=kdbush,KDBush.prototype={range:function(minX,minY,maxX,maxY){return range(this.ids,this.coords,minX,minY,maxX,maxY,this.nodeSize)},within:function(x,y,r){return within(this.ids,this.coords,x,y,r,this.nodeSize)}}},{"./range":20,"./sort":21,"./within":22}],20:[function(require,module,exports){"use strict";function range(ids,coords,minX,minY,maxX,maxY,nodeSize){for(var x,y,stack=[0,ids.length-1,0],result=[];stack.length;){var axis=stack.pop(),right=stack.pop(),left=stack.pop();if(right-left<=nodeSize)for(var i=left;i<=right;i++)x=coords[2*i],y=coords[2*i+1],x>=minX&&x<=maxX&&y>=minY&&y<=maxY&&result.push(ids[i]);else{var m=Math.floor((left+right)/2);x=coords[2*m],y=coords[2*m+1],x>=minX&&x<=maxX&&y>=minY&&y<=maxY&&result.push(ids[m]);var nextAxis=(axis+1)%2;(0===axis?minX<=x:minY<=y)&&(stack.push(left),stack.push(m-1),stack.push(nextAxis)),(0===axis?maxX>=x:maxY>=y)&&(stack.push(m+1),stack.push(right),stack.push(nextAxis))}}return result}module.exports=range},{}],21:[function(require,module,exports){"use strict";function sortKD(ids,coords,nodeSize,left,right,depth){if(!(right-left<=nodeSize)){var m=Math.floor((left+right)/2);select(ids,coords,m,left,right,depth%2),sortKD(ids,coords,nodeSize,left,m-1,depth+1),sortKD(ids,coords,nodeSize,m+1,right,depth+1)}}function select(ids,coords,k,left,right,inc){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);select(ids,coords,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),inc)}var t=coords[2*k+inc],i=left,j=right;for(swapItem(ids,coords,left,k),coords[2*right+inc]>t&&swapItem(ids,coords,left,right);i<j;){for(swapItem(ids,coords,i,j),i++,j--;coords[2*i+inc]<t;)i++;for(;coords[2*j+inc]>t;)j--}coords[2*left+inc]===t?swapItem(ids,coords,left,j):swapItem(ids,coords,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swapItem(ids,coords,i,j){swap(ids,i,j),swap(coords,2*i,2*j),swap(coords,2*i+1,2*j+1)}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}module.exports=sortKD},{}],22:[function(require,module,exports){"use strict";function within(ids,coords,qx,qy,r,nodeSize){for(var stack=[0,ids.length-1,0],result=[],r2=r*r;stack.length;){var axis=stack.pop(),right=stack.pop(),left=stack.pop();if(right-left<=nodeSize)for(var i=left;i<=right;i++)sqDist(coords[2*i],coords[2*i+1],qx,qy)<=r2&&result.push(ids[i]);else{var m=Math.floor((left+right)/2),x=coords[2*m],y=coords[2*m+1];sqDist(x,y,qx,qy)<=r2&&result.push(ids[m]);var nextAxis=(axis+1)%2;(0===axis?qx-r<=x:qy-r<=y)&&(stack.push(left),stack.push(m-1),stack.push(nextAxis)),(0===axis?qx+r>=x:qy+r>=y)&&(stack.push(m+1),stack.push(right),stack.push(nextAxis))}}return result}function sqDist(ax,ay,bx,by){var dx=ax-bx,dy=ay-by;return dx*dx+dy*dy}module.exports=within},{}],23:[function(require,module,exports){"use strict";function ArrayGroup(arrayTypes){var LayoutVertexArrayType=arrayTypes.layoutVertexArrayType;this.layoutVertexArray=new LayoutVertexArrayType;var ElementArrayType=arrayTypes.elementArrayType;ElementArrayType&&(this.elementArray=new ElementArrayType);var ElementArrayType2=arrayTypes.elementArrayType2;ElementArrayType2&&(this.elementArray2=new ElementArrayType2),this.paintVertexArrays=util.mapObject(arrayTypes.paintVertexArrayTypes,function(PaintVertexArrayType){return new PaintVertexArrayType})}var util=require("../util/util");module.exports=ArrayGroup,ArrayGroup.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ArrayGroup.prototype.hasCapacityFor=function(numVertices){return this.layoutVertexArray.length+numVertices<=ArrayGroup.MAX_VERTEX_ARRAY_LENGTH},ArrayGroup.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ArrayGroup.prototype.trim=function(){this.layoutVertexArray.trim(),this.elementArray&&this.elementArray.trim(),this.elementArray2&&this.elementArray2.trim();for(var layerName in this.paintVertexArrays)this.paintVertexArrays[layerName].trim()},ArrayGroup.prototype.serialize=function(){return{layoutVertexArray:this.layoutVertexArray.serialize(),elementArray:this.elementArray&&this.elementArray.serialize(),elementArray2:this.elementArray2&&this.elementArray2.serialize(),paintVertexArrays:util.mapObject(this.paintVertexArrays,function(array){return array.serialize()})}},ArrayGroup.prototype.getTransferables=function(transferables){transferables.push(this.layoutVertexArray.arrayBuffer),this.elementArray&&transferables.push(this.elementArray.arrayBuffer),this.elementArray2&&transferables.push(this.elementArray2.arrayBuffer);for(var layerName in this.paintVertexArrays)transferables.push(this.paintVertexArrays[layerName].arrayBuffer)}},{"../util/util":61}],24:[function(require,module,exports){"use strict";function Bucket(options){if(this.zoom=options.zoom,this.overscaling=options.overscaling,this.layer=options.layer,this.childLayers=options.childLayers,this.type=this.layer.type,this.features=[],this.id=this.layer.id,this.index=options.index,this.sourceLayer=this.layer.sourceLayer,this.sourceLayerIndex=options.sourceLayerIndex,this.minZoom=this.layer.minzoom,this.maxZoom=this.layer.maxzoom,this.paintAttributes=createPaintAttributes(this),options.arrays){var programInterfaces=this.programInterfaces;this.bufferGroups=util.mapObject(options.arrays,function(programArrayGroups,programName){var programInterface=programInterfaces[programName],paintVertexArrayTypes=options.paintVertexArrayTypes[programName];return programArrayGroups.map(function(arrayGroup){return new BufferGroup(arrayGroup,{layoutVertexArrayType:programInterface.layoutVertexArrayType.serialize(),elementArrayType:programInterface.elementArrayType&&programInterface.elementArrayType.serialize(),elementArrayType2:programInterface.elementArrayType2&&programInterface.elementArrayType2.serialize(),paintVertexArrayTypes:paintVertexArrayTypes})})})}}function createPaintAttributes(bucket){var attributes={};for(var interfaceName in bucket.programInterfaces){for(var layerPaintAttributes=attributes[interfaceName]={},c=0;c<bucket.childLayers.length;c++)layerPaintAttributes[bucket.childLayers[c].id]={attributes:[],uniforms:[],defines:[],vertexPragmas:{define:{},initialize:{}},fragmentPragmas:{define:{},initialize:{}}};var interface_=bucket.programInterfaces[interfaceName];if(interface_.paintAttributes)for(var i=0;i<interface_.paintAttributes.length;i++){var attribute=interface_.paintAttributes[i];attribute.multiplier=attribute.multiplier||1;for(var j=0;j<bucket.childLayers.length;j++){var layer=bucket.childLayers[j],paintAttributes=layerPaintAttributes[layer.id],attributeInputName=attribute.name;assert("a_"===attribute.name.slice(0,2));var attributeVaryingDefinition,attributeInnerName=attribute.name.slice(2);if(paintAttributes.fragmentPragmas.initialize[attributeInnerName]="",layer.isPaintValueFeatureConstant(attribute.paintProperty))paintAttributes.uniforms.push(attribute),paintAttributes.fragmentPragmas.define[attributeInnerName]=paintAttributes.vertexPragmas.define[attributeInnerName]=["uniform","{precision}","{type}",attributeInputName].join(" ")+";",paintAttributes.fragmentPragmas.initialize[attributeInnerName]=paintAttributes.vertexPragmas.initialize[attributeInnerName]=["{precision}","{type}",attributeInnerName,"=",attributeInputName].join(" ")+";\n";else if(layer.isPaintValueZoomConstant(attribute.paintProperty)){paintAttributes.attributes.push(util.extend({},attribute,{name:attributeInputName})),attributeVaryingDefinition=["varying","{precision}","{type}",attributeInnerName].join(" ")+";\n";var attributeAttributeDefinition=[paintAttributes.fragmentPragmas.define[attributeInnerName],"attribute","{precision}","{type}",attributeInputName].join(" ")+";\n";paintAttributes.fragmentPragmas.define[attributeInnerName]=attributeVaryingDefinition,paintAttributes.vertexPragmas.define[attributeInnerName]=attributeVaryingDefinition+attributeAttributeDefinition,paintAttributes.vertexPragmas.initialize[attributeInnerName]=[attributeInnerName,"=",attributeInputName,"/",attribute.multiplier.toFixed(1)].join(" ")+";\n"}else{for(var tName="u_"+attributeInputName.slice(2)+"_t",zoomLevels=layer.getPaintValueStopZoomLevels(attribute.paintProperty),numStops=0;numStops<zoomLevels.length&&zoomLevels[numStops]<bucket.zoom;)numStops++;for(var stopOffset=Math.max(0,Math.min(zoomLevels.length-4,numStops-2)),fourZoomLevels=[],s=0;s<4;s++)fourZoomLevels.push(zoomLevels[Math.min(stopOffset+s,zoomLevels.length-1)]);attributeVaryingDefinition=["varying","{precision}","{type}",attributeInnerName].join(" ")+";\n",paintAttributes.vertexPragmas.define[attributeInnerName]=attributeVaryingDefinition+["uniform","lowp","float",tName].join(" ")+";\n",paintAttributes.fragmentPragmas.define[attributeInnerName]=attributeVaryingDefinition,paintAttributes.uniforms.push(util.extend({},attribute,{name:tName,getValue:createGetUniform(attribute,stopOffset),components:1}));var components=attribute.components;if(1===components)paintAttributes.attributes.push(util.extend({},attribute,{getValue:createFunctionGetValue(attribute,fourZoomLevels),isFunction:!0,components:4*components})),paintAttributes.vertexPragmas.define[attributeInnerName]+=["attribute","{precision}","vec4",attributeInputName].join(" ")+";\n",paintAttributes.vertexPragmas.initialize[attributeInnerName]=[attributeInnerName,"=","evaluate_zoom_function_1("+attributeInputName+", "+tName+")","/",attribute.multiplier.toFixed(1)].join(" ")+";\n";else{for(var attributeInputNames=[],k=0;k<4;k++)attributeInputNames.push(attributeInputName+k),paintAttributes.attributes.push(util.extend({},attribute,{getValue:createFunctionGetValue(attribute,[fourZoomLevels[k]]),isFunction:!0,name:attributeInputName+k})),paintAttributes.vertexPragmas.define[attributeInnerName]+=["attribute","{precision}","{type}",attributeInputName+k].join(" ")+";\n";paintAttributes.vertexPragmas.initialize[attributeInnerName]=[attributeInnerName," = ","evaluate_zoom_function_4("+attributeInputNames.join(", ")+", "+tName+")","/",attribute.multiplier.toFixed(1)].join(" ")+";\n"}}}}}return attributes}function createFunctionGetValue(attribute,stopZoomLevels){return function(layer,globalProperties,featureProperties){if(1===stopZoomLevels.length)return attribute.getValue(layer,util.extend({},globalProperties,{zoom:stopZoomLevels[0]}),featureProperties);for(var values=[],z=0;z<stopZoomLevels.length;z++){var stopZoomLevel=stopZoomLevels[z];values.push(attribute.getValue(layer,util.extend({},globalProperties,{zoom:stopZoomLevel}),featureProperties)[0])}return values}}function createGetUniform(attribute,stopOffset){return function(layer,globalProperties){var stopInterp=layer.getPaintInterpolationT(attribute.paintProperty,globalProperties.zoom);return[Math.max(0,Math.min(4,stopInterp-stopOffset))]}}var featureFilter=require("feature-filter"),ArrayGroup=require("./array_group"),BufferGroup=require("./buffer_group"),util=require("../util/util"),StructArrayType=require("../util/struct_array"),assert=require("assert");module.exports=Bucket,Bucket.create=function(options){return new({fill:require("./bucket/fill_bucket"),line:require("./bucket/line_bucket"),circle:require("./bucket/circle_bucket"),symbol:require("./bucket/symbol_bucket")}[options.layer.type])(options)},Bucket.EXTENT=8192,Bucket.prototype.populateArrays=function(){this.createArrays(),this.recalculateStyleLayers();for(var i=0;i<this.features.length;i++)this.addFeature(this.features[i]);this.trimArrays()},Bucket.prototype.prepareArrayGroup=function(programName,numVertices){var groups=this.arrayGroups[programName],currentGroup=groups.length&&groups[groups.length-1];return currentGroup&&currentGroup.hasCapacityFor(numVertices)||((currentGroup=new ArrayGroup({layoutVertexArrayType:this.programInterfaces[programName].layoutVertexArrayType,elementArrayType:this.programInterfaces[programName].elementArrayType,elementArrayType2:this.programInterfaces[programName].elementArrayType2,paintVertexArrayTypes:this.paintVertexArrayTypes[programName]})).index=groups.length,groups.push(currentGroup)),currentGroup},Bucket.prototype.createArrays=function(){this.arrayGroups={},this.paintVertexArrayTypes={};for(var programName in this.programInterfaces){this.arrayGroups[programName]=[];var paintVertexArrayTypes=this.paintVertexArrayTypes[programName]={},layerPaintAttributes=this.paintAttributes[programName];for(var layerName in layerPaintAttributes)paintVertexArrayTypes[layerName]=new Bucket.VertexArrayType(layerPaintAttributes[layerName].attributes)}},Bucket.prototype.destroy=function(gl){for(var programName in this.bufferGroups)for(var programBufferGroups=this.bufferGroups[programName],i=0;i<programBufferGroups.length;i++)programBufferGroups[i].destroy(gl)},Bucket.prototype.trimArrays=function(){for(var programName in this.arrayGroups)for(var arrayGroups=this.arrayGroups[programName],i=0;i<arrayGroups.length;i++)arrayGroups[i].trim()},Bucket.prototype.isEmpty=function(){for(var programName in this.arrayGroups)for(var arrayGroups=this.arrayGroups[programName],i=0;i<arrayGroups.length;i++)if(!arrayGroups[i].isEmpty())return!1;return!0},Bucket.prototype.getTransferables=function(transferables){for(var programName in this.arrayGroups)for(var arrayGroups=this.arrayGroups[programName],i=0;i<arrayGroups.length;i++)arrayGroups[i].getTransferables(transferables)},Bucket.prototype.setUniforms=function(gl,programName,program,layer,globalProperties){for(var uniforms=this.paintAttributes[programName][layer.id].uniforms,i=0;i<uniforms.length;i++){var uniform=uniforms[i],uniformLocation=program[uniform.name];gl["uniform"+uniform.components+"fv"](uniformLocation,uniform.getValue(layer,globalProperties))}},Bucket.prototype.serialize=function(){return{layerId:this.layer.id,zoom:this.zoom,arrays:util.mapObject(this.arrayGroups,function(programArrayGroups){return programArrayGroups.map(function(arrayGroup){return arrayGroup.serialize()})}),paintVertexArrayTypes:util.mapObject(this.paintVertexArrayTypes,function(arrayTypes){return util.mapObject(arrayTypes,function(arrayType){return arrayType.serialize()})}),childLayerIds:this.childLayers.map(function(layer){return layer.id})}},Bucket.prototype.createFilter=function(){this.filter||(this.filter=featureFilter(this.layer.filter))};var FAKE_ZOOM_HISTORY={lastIntegerZoom:1/0,lastIntegerZoomTime:0,lastZoom:0};Bucket.prototype.recalculateStyleLayers=function(){for(var i=0;i<this.childLayers.length;i++)this.childLayers[i].recalculate(this.zoom,FAKE_ZOOM_HISTORY)},Bucket.prototype.populatePaintArrays=function(interfaceName,globalProperties,featureProperties,startGroup,startIndex){for(var l=0;l<this.childLayers.length;l++)for(var layer=this.childLayers[l],groups=this.arrayGroups[interfaceName],g=startGroup.index;g<groups.length;g++){var group=groups[g],length=group.layoutVertexArray.length,paintArray=group.paintVertexArrays[layer.id];paintArray.resize(length);for(var attributes=this.paintAttributes[interfaceName][layer.id].attributes,m=0;m<attributes.length;m++)for(var attribute=attributes[m],value=attribute.getValue(layer,globalProperties,featureProperties),multiplier=attribute.multiplier||1,components=attribute.components||1,i=g===startGroup.index?startIndex:0;i<length;i++)for(var vertex=paintArray.get(i),c=0;c<components;c++)vertex[components>1?attribute.name+c:attribute.name]=value[c]*multiplier}},Bucket.VertexArrayType=function(members){return new StructArrayType({members:members,alignment:4})},Bucket.ElementArrayType=function(components){return new StructArrayType({members:[{type:"Uint16",name:"vertices",components:components||3}]})}},{"../util/struct_array":59,"../util/util":61,"./array_group":23,"./bucket/circle_bucket":25,"./bucket/fill_bucket":26,"./bucket/line_bucket":27,"./bucket/symbol_bucket":28,"./buffer_group":30,assert:80,"feature-filter":6}],25:[function(require,module,exports){"use strict";function CircleBucket(){Bucket.apply(this,arguments)}var Bucket=require("../bucket"),util=require("../../util/util"),loadGeometry=require("../load_geometry"),EXTENT=Bucket.EXTENT;module.exports=CircleBucket,CircleBucket.prototype=util.inherit(Bucket,{}),CircleBucket.prototype.addCircleVertex=function(layoutVertexArray,x,y,extrudeX,extrudeY){return layoutVertexArray.emplaceBack(2*x+(extrudeX+1)/2,2*y+(extrudeY+1)/2)},CircleBucket.prototype.programInterfaces={circle:{layoutVertexArrayType:new Bucket.VertexArrayType([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:new Bucket.ElementArrayType,paintAttributes:[{name:"a_color",components:4,type:"Uint8",getValue:function(layer,globalProperties,featureProperties){return layer.getPaintValue("circle-color",globalProperties,featureProperties)},multiplier:255,paintProperty:"circle-color"},{name:"a_radius",components:1,type:"Uint16",isLayerConstant:!1,getValue:function(layer,globalProperties,featureProperties){return[layer.getPaintValue("circle-radius",globalProperties,featureProperties)]},multiplier:10,paintProperty:"circle-radius"},{name:"a_blur",components:1,type:"Uint16",isLayerConstant:!1,getValue:function(layer,globalProperties,featureProperties){return[layer.getPaintValue("circle-blur",globalProperties,featureProperties)]},multiplier:10,paintProperty:"circle-blur"},{name:"a_opacity",components:1,type:"Uint16",isLayerConstant:!1,getValue:function(layer,globalProperties,featureProperties){return[layer.getPaintValue("circle-opacity",globalProperties,featureProperties)]},multiplier:255,paintProperty:"circle-opacity"}]}},CircleBucket.prototype.addFeature=function(feature){for(var globalProperties={zoom:this.zoom},geometries=loadGeometry(feature),startGroup=this.prepareArrayGroup("circle",0),startIndex=startGroup.layoutVertexArray.length,j=0;j<geometries.length;j++)for(var k=0;k<geometries[j].length;k++){var x=geometries[j][k].x,y=geometries[j][k].y;if(!(x<0||x>=EXTENT||y<0||y>=EXTENT)){var group=this.prepareArrayGroup("circle",4),layoutVertexArray=group.layoutVertexArray,index=this.addCircleVertex(layoutVertexArray,x,y,-1,-1);this.addCircleVertex(layoutVertexArray,x,y,1,-1),this.addCircleVertex(layoutVertexArray,x,y,1,1),this.addCircleVertex(layoutVertexArray,x,y,-1,1),group.elementArray.emplaceBack(index,index+1,index+2),group.elementArray.emplaceBack(index,index+3,index+2)}}this.populatePaintArrays("circle",globalProperties,feature.properties,startGroup,startIndex)}},{"../../util/util":61,"../bucket":24,"../load_geometry":32}],26:[function(require,module,exports){"use strict";function FillBucket(){Bucket.apply(this,arguments)}var Bucket=require("../bucket"),util=require("../../util/util"),loadGeometry=require("../load_geometry"),earcut=require("earcut"),classifyRings=require("../../util/classify_rings");module.exports=FillBucket,FillBucket.prototype=util.inherit(Bucket,{}),FillBucket.prototype.programInterfaces={fill:{layoutVertexArrayType:new Bucket.VertexArrayType([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:new Bucket.ElementArrayType(1),elementArrayType2:new Bucket.ElementArrayType(2),paintAttributes:[{name:"a_color",components:4,type:"Uint8",getValue:function(layer,globalProperties,featureProperties){return layer.getPaintValue("fill-color",globalProperties,featureProperties)},multiplier:255,paintProperty:"fill-color"},{name:"a_outline_color",components:4,type:"Uint8",getValue:function(layer,globalProperties,featureProperties){return layer.getPaintValue("fill-outline-color",globalProperties,featureProperties)},multiplier:255,paintProperty:"fill-outline-color"},{name:"a_opacity",components:1,type:"Uint8",getValue:function(layer,globalProperties,featureProperties){return[layer.getPaintValue("fill-opacity",globalProperties,featureProperties)]},multiplier:255,paintProperty:"fill-opacity"}]}},FillBucket.prototype.addFeature=function(feature){for(var lines=loadGeometry(feature),polygons=classifyRings(lines,500),startGroup=this.prepareArrayGroup("fill",0),startIndex=startGroup.layoutVertexArray.length,i=0;i<polygons.length;i++)this.addPolygon(polygons[i]);this.populatePaintArrays("fill",{zoom:this.zoom},feature.properties,startGroup,startIndex)},FillBucket.prototype.addPolygon=function(polygon){for(var numVertices=0,k=0;k<polygon.length;k++)numVertices+=polygon[k].length;for(var group=this.prepareArrayGroup("fill",numVertices),flattened=[],holeIndices=[],startIndex=group.layoutVertexArray.length,r=0;r<polygon.length;r++){var ring=polygon[r];r>0&&holeIndices.push(flattened.length/2);for(var v=0;v<ring.length;v++){var vertex=ring[v],index=group.layoutVertexArray.emplaceBack(vertex.x,vertex.y);v>=1&&group.elementArray2.emplaceBack(index-1,index),flattened.push(vertex.x),flattened.push(vertex.y)}}for(var triangleIndices=earcut(flattened,holeIndices),i=0;i<triangleIndices.length;i++)group.elementArray.emplaceBack(triangleIndices[i]+startIndex)}},{"../../util/classify_rings":54,"../../util/util":61,"../bucket":24,"../load_geometry":32,earcut:5}],27:[function(require,module,exports){"use strict";function LineBucket(){Bucket.apply(this,arguments)}var Bucket=require("../bucket"),util=require("../../util/util"),loadGeometry=require("../load_geometry"),EXTENT=Bucket.EXTENT,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),MAX_LINE_DISTANCE=Math.pow(2,14)/.5;module.exports=LineBucket,LineBucket.prototype=util.inherit(Bucket,{}),LineBucket.prototype.addLineVertex=function(layoutVertexBuffer,point,extrude,tx,ty,dir,linesofar){return layoutVertexBuffer.emplaceBack(point.x<<1|tx,point.y<<1|ty,Math.round(63*extrude.x)+128,Math.round(63*extrude.y)+128,1+(0===dir?0:dir<0?-1:1)|(.5*linesofar&63)<<2,.5*linesofar>>6)},LineBucket.prototype.programInterfaces={line:{layoutVertexArrayType:new Bucket.VertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}]),elementArrayType:new Bucket.ElementArrayType}},LineBucket.prototype.addFeature=function(feature){for(var lines=loadGeometry(feature,15),i=0;i<lines.length;i++)this.addLine(lines[i],this.layer.layout["line-join"],this.layer.layout["line-cap"],this.layer.layout["line-miter-limit"],this.layer.layout["line-round-limit"])},LineBucket.prototype.addLine=function(vertices,join,cap,miterLimit,roundLimit){for(var len=vertices.length;len>2&&vertices[len-1].equals(vertices[len-2]);)len--;if(!(vertices.length<2)){"bevel"===join&&(miterLimit=1.05);var sharpCornerOffset=EXTENT/(512*this.overscaling)*15,firstVertex=vertices[0],lastVertex=vertices[len-1],closed=firstVertex.equals(lastVertex);if(this.prepareArrayGroup("line",10*len),2!==len||!closed){this.distance=0;var currentVertex,prevVertex,nextVertex,prevNormal,nextNormal,offsetA,offsetB,beginCap=cap,endCap=closed?"butt":cap,startOfLine=!0;this.e1=this.e2=this.e3=-1,closed&&(currentVertex=vertices[len-2],nextNormal=firstVertex.sub(currentVertex)._unit()._perp());for(var i=0;i<len;i++)if(!(nextVertex=closed&&i===len-1?vertices[1]:vertices[i+1])||!vertices[i].equals(nextVertex)){nextNormal&&(prevNormal=nextNormal),currentVertex&&(prevVertex=currentVertex),currentVertex=vertices[i],nextNormal=nextVertex?nextVertex.sub(currentVertex)._unit()._perp():prevNormal;var joinNormal=(prevNormal=prevNormal||nextNormal).add(nextNormal)._unit(),cosHalfAngle=joinNormal.x*nextNormal.x+joinNormal.y*nextNormal.y,miterLength=1/cosHalfAngle,isSharpCorner=cosHalfAngle<COS_HALF_SHARP_CORNER&&prevVertex&&nextVertex;if(isSharpCorner&&i>0){var prevSegmentLength=currentVertex.dist(prevVertex);if(prevSegmentLength>2*sharpCornerOffset){var newPrevVertex=currentVertex.sub(currentVertex.sub(prevVertex)._mult(sharpCornerOffset/prevSegmentLength)._round());this.distance+=newPrevVertex.dist(prevVertex),this.addCurrentVertex(newPrevVertex,this.distance,prevNormal.mult(1),0,0,!1),prevVertex=newPrevVertex}}var middleVertex=prevVertex&&nextVertex,currentJoin=middleVertex?join:nextVertex?beginCap:endCap;if(middleVertex&&"round"===currentJoin&&(miterLength<roundLimit?currentJoin="miter":miterLength<=2&&(currentJoin="fakeround")),"miter"===currentJoin&&miterLength>miterLimit&&(currentJoin="bevel"),"bevel"===currentJoin&&(miterLength>2&&(currentJoin="flipbevel"),miterLength<miterLimit&&(currentJoin="miter")),prevVertex&&(this.distance+=currentVertex.dist(prevVertex)),"miter"===currentJoin)joinNormal._mult(miterLength),this.addCurrentVertex(currentVertex,this.distance,joinNormal,0,0,!1);else if("flipbevel"===currentJoin){if(miterLength>100)joinNormal=nextNormal.clone();else{var direction=prevNormal.x*nextNormal.y-prevNormal.y*nextNormal.x>0?-1:1,bevelLength=miterLength*prevNormal.add(nextNormal).mag()/prevNormal.sub(nextNormal).mag();joinNormal._perp()._mult(bevelLength*direction)}this.addCurrentVertex(currentVertex,this.distance,joinNormal,0,0,!1),this.addCurrentVertex(currentVertex,this.distance,joinNormal.mult(-1),0,0,!1)}else if("bevel"===currentJoin||"fakeround"===currentJoin){var lineTurnsLeft=prevNormal.x*nextNormal.y-prevNormal.y*nextNormal.x>0,offset=-Math.sqrt(miterLength*miterLength-1);if(lineTurnsLeft?(offsetB=0,offsetA=offset):(offsetA=0,offsetB=offset),startOfLine||this.addCurrentVertex(currentVertex,this.distance,prevNormal,offsetA,offsetB,!1),"fakeround"===currentJoin){for(var approxFractionalJoinNormal,n=Math.floor(8*(.5-(cosHalfAngle-.5))),m=0;m<n;m++)approxFractionalJoinNormal=nextNormal.mult((m+1)/(n+1))._add(prevNormal)._unit(),this.addPieSliceVertex(currentVertex,this.distance,approxFractionalJoinNormal,lineTurnsLeft);this.addPieSliceVertex(currentVertex,this.distance,joinNormal,lineTurnsLeft);for(var k=n-1;k>=0;k--)approxFractionalJoinNormal=prevNormal.mult((k+1)/(n+1))._add(nextNormal)._unit(),this.addPieSliceVertex(currentVertex,this.distance,approxFractionalJoinNormal,lineTurnsLeft)}nextVertex&&this.addCurrentVertex(currentVertex,this.distance,nextNormal,-offsetA,-offsetB,!1)}else"butt"===currentJoin?(startOfLine||this.addCurrentVertex(currentVertex,this.distance,prevNormal,0,0,!1),nextVertex&&this.addCurrentVertex(currentVertex,this.distance,nextNormal,0,0,!1)):"square"===currentJoin?(startOfLine||(this.addCurrentVertex(currentVertex,this.distance,prevNormal,1,1,!1),this.e1=this.e2=-1),nextVertex&&this.addCurrentVertex(currentVertex,this.distance,nextNormal,-1,-1,!1)):"round"===currentJoin&&(startOfLine||(this.addCurrentVertex(currentVertex,this.distance,prevNormal,0,0,!1),this.addCurrentVertex(currentVertex,this.distance,prevNormal,1,1,!0),this.e1=this.e2=-1),nextVertex&&(this.addCurrentVertex(currentVertex,this.distance,nextNormal,-1,-1,!0),this.addCurrentVertex(currentVertex,this.distance,nextNormal,0,0,!1)));if(isSharpCorner&&i<len-1){var nextSegmentLength=currentVertex.dist(nextVertex);if(nextSegmentLength>2*sharpCornerOffset){var newCurrentVertex=currentVertex.add(nextVertex.sub(currentVertex)._mult(sharpCornerOffset/nextSegmentLength)._round());this.distance+=newCurrentVertex.dist(currentVertex),this.addCurrentVertex(newCurrentVertex,this.distance,nextNormal.mult(1),0,0,!1),currentVertex=newCurrentVertex}}startOfLine=!1}}}},LineBucket.prototype.addCurrentVertex=function(currentVertex,distance,normal,endLeft,endRight,round){var extrude,tx=round?1:0,arrayGroup=this.arrayGroups.line[this.arrayGroups.line.length-1],layoutVertexArray=arrayGroup.layoutVertexArray,elementArray=arrayGroup.elementArray;extrude=normal.clone(),endLeft&&extrude._sub(normal.perp()._mult(endLeft)),this.e3=this.addLineVertex(layoutVertexArray,currentVertex,extrude,tx,0,endLeft,distance),this.e1>=0&&this.e2>=0&&elementArray.emplaceBack(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3,extrude=normal.mult(-1),endRight&&extrude._sub(normal.perp()._mult(endRight)),this.e3=this.addLineVertex(layoutVertexArray,currentVertex,extrude,tx,1,-endRight,distance),this.e1>=0&&this.e2>=0&&elementArray.emplaceBack(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3,distance>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(currentVertex,this.distance,normal,endLeft,endRight,round))},LineBucket.prototype.addPieSliceVertex=function(currentVertex,distance,extrude,lineTurnsLeft){var ty=lineTurnsLeft?1:0;extrude=extrude.mult(lineTurnsLeft?-1:1);var arrayGroup=this.arrayGroups.line[this.arrayGroups.line.length-1],layoutVertexArray=arrayGroup.layoutVertexArray,elementArray=arrayGroup.elementArray;this.e3=this.addLineVertex(layoutVertexArray,currentVertex,extrude,0,ty,0,distance),this.e1>=0&&this.e2>=0&&elementArray.emplaceBack(this.e1,this.e2,this.e3),lineTurnsLeft?this.e2=this.e3:this.e1=this.e3}},{"../../util/util":61,"../bucket":24,"../load_geometry":32}],28:[function(require,module,exports){"use strict";function SymbolBucket(options){Bucket.apply(this,arguments),this.showCollisionBoxes=options.showCollisionBoxes,this.overscaling=options.overscaling,this.collisionBoxArray=options.collisionBoxArray,this.symbolQuadsArray=options.symbolQuadsArray,this.symbolInstancesArray=options.symbolInstancesArray,this.sdfIcons=options.sdfIcons,this.iconsNeedLinear=options.iconsNeedLinear,this.adjustedTextSize=options.adjustedTextSize,this.adjustedIconSize=options.adjustedIconSize,this.fontstack=options.fontstack}function addVertex(array,x,y,ox,oy,tx,ty,minzoom,maxzoom,labelminzoom,labelangle){return array.emplaceBack(x,y,Math.round(64*ox),Math.round(64*oy),tx/4,ty/4,10*(labelminzoom||0),labelangle,10*(minzoom||0),10*Math.min(maxzoom||25,25))}var Point=require("point-geometry"),Bucket=require("../bucket"),Anchor=require("../../symbol/anchor"),getAnchors=require("../../symbol/get_anchors"),resolveTokens=require("../../util/token"),Quads=require("../../symbol/quads"),Shaping=require("../../symbol/shaping"),resolveText=require("../../symbol/resolve_text"),mergeLines=require("../../symbol/mergelines"),clipLine=require("../../symbol/clip_line"),util=require("../../util/util"),loadGeometry=require("../load_geometry"),CollisionFeature=require("../../symbol/collision_feature"),shapeText=Shaping.shapeText,shapeIcon=Shaping.shapeIcon,getGlyphQuads=Quads.getGlyphQuads,getIconQuads=Quads.getIconQuads,EXTENT=Bucket.EXTENT;module.exports=SymbolBucket,SymbolBucket.MAX_QUADS=65535,SymbolBucket.prototype=util.inherit(Bucket,{}),SymbolBucket.prototype.serialize=function(){var serialized=Bucket.prototype.serialize.apply(this);return serialized.sdfIcons=this.sdfIcons,serialized.iconsNeedLinear=this.iconsNeedLinear,serialized.adjustedTextSize=this.adjustedTextSize,serialized.adjustedIconSize=this.adjustedIconSize,serialized.fontstack=this.fontstack,serialized};var layoutVertexArrayType=new Bucket.VertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_offset",components:2,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"}]),elementArrayType=new Bucket.ElementArrayType;SymbolBucket.prototype.addCollisionBoxVertex=function(layoutVertexArray,point,extrude,maxZoom,placementZoom){return layoutVertexArray.emplaceBack(point.x,point.y,Math.round(extrude.x),Math.round(extrude.y),10*maxZoom,10*placementZoom)},SymbolBucket.prototype.programInterfaces={glyph:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType},icon:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType},collisionBox:{layoutVertexArrayType:new Bucket.VertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}])}},SymbolBucket.prototype.populateArrays=function(collisionTile,stacks,icons){var zoomHistory={lastIntegerZoom:1/0,lastIntegerZoomTime:0,lastZoom:0};this.adjustedTextMaxSize=this.layer.getLayoutValue("text-size",{zoom:18,zoomHistory:zoomHistory}),this.adjustedTextSize=this.layer.getLayoutValue("text-size",{zoom:this.zoom+1,zoomHistory:zoomHistory}),this.adjustedIconMaxSize=this.layer.getLayoutValue("icon-size",{zoom:18,zoomHistory:zoomHistory}),this.adjustedIconSize=this.layer.getLayoutValue("icon-size",{zoom:this.zoom+1,zoomHistory:zoomHistory});var tileSize=512*this.overscaling;this.tilePixelRatio=EXTENT/tileSize,this.compareText={},this.iconsNeedLinear=!1,this.symbolInstancesStartIndex=this.symbolInstancesArray.length;var layout=this.layer.layout,features=this.features,textFeatures=this.textFeatures,horizontalAlign=.5,verticalAlign=.5;switch(layout["text-anchor"]){case"right":case"top-right":case"bottom-right":horizontalAlign=1;break;case"left":case"top-left":case"bottom-left":horizontalAlign=0}switch(layout["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":verticalAlign=1;break;case"top":case"top-right":case"top-left":verticalAlign=0}for(var justify="right"===layout["text-justify"]?1:"left"===layout["text-justify"]?0:.5,lineHeight=24*layout["text-line-height"],maxWidth="line"!==layout["symbol-placement"]?24*layout["text-max-width"]:0,spacing=24*layout["text-letter-spacing"],textOffset=[24*layout["text-offset"][0],24*layout["text-offset"][1]],fontstack=this.fontstack=layout["text-font"].join(","),geometries=[],g=0;g<features.length;g++)geometries.push(loadGeometry(features[g]));if("line"===layout["symbol-placement"]){var merged=mergeLines(features,textFeatures,geometries);geometries=merged.geometries,features=merged.features,textFeatures=merged.textFeatures}for(var shapedText,shapedIcon,k=0;k<features.length;k++)if(geometries[k]){if(shapedText=textFeatures[k]?shapeText(textFeatures[k],stacks[fontstack],maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,textOffset):null,layout["icon-image"]){var image=icons[resolveTokens(features[k].properties,layout["icon-image"])];shapedIcon=shapeIcon(image,layout),image&&(void 0===this.sdfIcons?this.sdfIcons=image.sdf:this.sdfIcons!==image.sdf&&util.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),1!==image.pixelRatio?this.iconsNeedLinear=!0:0===layout["icon-rotate"]&&this.layer.isLayoutValueFeatureConstant("icon-rotate")||(this.iconsNeedLinear=!0))}else shapedIcon=null;(shapedText||shapedIcon)&&this.addFeature(geometries[k],shapedText,shapedIcon,features[k])}this.symbolInstancesEndIndex=this.symbolInstancesArray.length,this.placeFeatures(collisionTile,this.showCollisionBoxes),this.trimArrays()},SymbolBucket.prototype.addFeature=function(lines,shapedText,shapedIcon,feature){var layout=this.layer.layout,fontScale=this.adjustedTextSize/24,textMaxSize=void 0!==this.adjustedTextMaxSize?this.adjustedTextMaxSize:this.adjustedTextSize,textBoxScale=this.tilePixelRatio*fontScale,textMaxBoxScale=this.tilePixelRatio*textMaxSize/24,iconBoxScale=this.tilePixelRatio*this.adjustedIconSize,symbolMinDistance=this.tilePixelRatio*layout["symbol-spacing"],avoidEdges=layout["symbol-avoid-edges"],textPadding=layout["text-padding"]*this.tilePixelRatio,iconPadding=layout["icon-padding"]*this.tilePixelRatio,textMaxAngle=layout["text-max-angle"]/180*Math.PI,textAlongLine="map"===layout["text-rotation-alignment"]&&"line"===layout["symbol-placement"],iconAlongLine="map"===layout["icon-rotation-alignment"]&&"line"===layout["symbol-placement"],mayOverlap=layout["text-allow-overlap"]||layout["icon-allow-overlap"]||layout["text-ignore-placement"]||layout["icon-ignore-placement"],isLine="line"===layout["symbol-placement"],textRepeatDistance=symbolMinDistance/2;isLine&&(lines=clipLine(lines,0,0,EXTENT,EXTENT));for(var i=0;i<lines.length;i++)for(var anchors,line=lines[i],j=0,len=(anchors=isLine?getAnchors(line,symbolMinDistance,textMaxAngle,shapedText,shapedIcon,24,textMaxBoxScale,this.overscaling,EXTENT):[new Anchor(line[0].x,line[0].y,0)]).length;j<len;j++){var anchor=anchors[j];if(!(shapedText&&isLine&&this.anchorIsTooClose(shapedText.text,textRepeatDistance,anchor))){var inside=!(anchor.x<0||anchor.x>EXTENT||anchor.y<0||anchor.y>EXTENT);if(!avoidEdges||inside){var addToBuffers=inside||mayOverlap;this.addSymbolInstance(anchor,line,shapedText,shapedIcon,this.layer,addToBuffers,this.symbolInstancesArray.length,this.collisionBoxArray,feature.index,this.sourceLayerIndex,this.index,textBoxScale,textPadding,textAlongLine,iconBoxScale,iconPadding,iconAlongLine,{zoom:this.zoom},feature.properties)}}}},SymbolBucket.prototype.anchorIsTooClose=function(text,repeatDistance,anchor){var compareText=this.compareText;if(text in compareText){for(var otherAnchors=compareText[text],k=otherAnchors.length-1;k>=0;k--)if(anchor.dist(otherAnchors[k])<repeatDistance)return!0}else compareText[text]=[];return compareText[text].push(anchor),!1},SymbolBucket.prototype.placeFeatures=function(collisionTile,showCollisionBoxes){this.recalculateStyleLayers(),this.createArrays();var layout=this.layer.layout,maxScale=collisionTile.maxScale,textAlongLine="map"===layout["text-rotation-alignment"]&&"line"===layout["symbol-placement"],iconAlongLine="map"===layout["icon-rotation-alignment"]&&"line"===layout["symbol-placement"];if(layout["text-allow-overlap"]||layout["icon-allow-overlap"]||layout["text-ignore-placement"]||layout["icon-ignore-placement"]){var symbolInstancesStructTypeArray=this.symbolInstancesArray.toArray(this.symbolInstancesStartIndex,this.symbolInstancesEndIndex),angle=collisionTile.angle,sin=Math.sin(angle),cos=Math.cos(angle);this.sortedSymbolInstances=symbolInstancesStructTypeArray.sort(function(a,b){return(sin*a.anchorPointX+cos*a.anchorPointY|0)-(sin*b.anchorPointX+cos*b.anchorPointY|0)||b.index-a.index})}for(var p=this.symbolInstancesStartIndex;p<this.symbolInstancesEndIndex;p++){var symbolInstance=this.sortedSymbolInstances?this.sortedSymbolInstances[p-this.symbolInstancesStartIndex]:this.symbolInstancesArray.get(p),textCollisionFeature={boxStartIndex:symbolInstance.textBoxStartIndex,boxEndIndex:symbolInstance.textBoxEndIndex},iconCollisionFeature={boxStartIndex:symbolInstance.iconBoxStartIndex,boxEndIndex:symbolInstance.iconBoxEndIndex},hasText=!(symbolInstance.textBoxStartIndex===symbolInstance.textBoxEndIndex),hasIcon=!(symbolInstance.iconBoxStartIndex===symbolInstance.iconBoxEndIndex),iconWithoutText=layout["text-optional"]||!hasText,textWithoutIcon=layout["icon-optional"]||!hasIcon,glyphScale=hasText?collisionTile.placeCollisionFeature(textCollisionFeature,layout["text-allow-overlap"],layout["symbol-avoid-edges"]):collisionTile.minScale,iconScale=hasIcon?collisionTile.placeCollisionFeature(iconCollisionFeature,layout["icon-allow-overlap"],layout["symbol-avoid-edges"]):collisionTile.minScale;iconWithoutText||textWithoutIcon?!textWithoutIcon&&glyphScale?glyphScale=Math.max(iconScale,glyphScale):!iconWithoutText&&iconScale&&(iconScale=Math.max(iconScale,glyphScale)):iconScale=glyphScale=Math.max(iconScale,glyphScale),hasText&&(collisionTile.insertCollisionFeature(textCollisionFeature,glyphScale,layout["text-ignore-placement"]),glyphScale<=maxScale&&this.addSymbols("glyph",symbolInstance.glyphQuadStartIndex,symbolInstance.glyphQuadEndIndex,glyphScale,layout["text-keep-upright"],textAlongLine,collisionTile.angle)),hasIcon&&(collisionTile.insertCollisionFeature(iconCollisionFeature,iconScale,layout["icon-ignore-placement"]),iconScale<=maxScale&&this.addSymbols("icon",symbolInstance.iconQuadStartIndex,symbolInstance.iconQuadEndIndex,iconScale,layout["icon-keep-upright"],iconAlongLine,collisionTile.angle))}showCollisionBoxes&&this.addToDebugBuffers(collisionTile)},SymbolBucket.prototype.addSymbols=function(programName,quadsStart,quadsEnd,scale,keepUpright,alongLine,placementAngle){for(var group=this.prepareArrayGroup(programName,4*(quadsEnd-quadsStart)),elementArray=group.elementArray,layoutVertexArray=group.layoutVertexArray,zoom=this.zoom,placementZoom=Math.max(Math.log(scale)/Math.LN2+zoom,0),k=quadsStart;k<quadsEnd;k++){var symbol=this.symbolQuadsArray.get(k).SymbolQuad,a=(symbol.anchorAngle+placementAngle+Math.PI)%(2*Math.PI);if(!(keepUpright&&alongLine&&(a<=Math.PI/2||a>3*Math.PI/2))){var tl=symbol.tl,tr=symbol.tr,bl=symbol.bl,br=symbol.br,tex=symbol.tex,anchorPoint=symbol.anchorPoint,minZoom=Math.max(zoom+Math.log(symbol.minScale)/Math.LN2,placementZoom),maxZoom=Math.min(zoom+Math.log(symbol.maxScale)/Math.LN2,25);if(!(maxZoom<=minZoom)){minZoom===placementZoom&&(minZoom=0);var glyphAngle=Math.round(symbol.glyphAngle/(2*Math.PI)*256),index=addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,tl.x,tl.y,tex.x,tex.y,minZoom,maxZoom,placementZoom,glyphAngle);addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,tr.x,tr.y,tex.x+tex.w,tex.y,minZoom,maxZoom,placementZoom,glyphAngle),addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,bl.x,bl.y,tex.x,tex.y+tex.h,minZoom,maxZoom,placementZoom,glyphAngle),addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,br.x,br.y,tex.x+tex.w,tex.y+tex.h,minZoom,maxZoom,placementZoom,glyphAngle),elementArray.emplaceBack(index,index+1,index+2),elementArray.emplaceBack(index+1,index+2,index+3)}}}},SymbolBucket.prototype.updateIcons=function(icons){this.recalculateStyleLayers();var iconValue=this.layer.layout["icon-image"];if(iconValue)for(var i=0;i<this.features.length;i++){var iconName=resolveTokens(this.features[i].properties,iconValue);iconName&&(icons[iconName]=!0)}},SymbolBucket.prototype.updateFont=function(stacks){this.recalculateStyleLayers();var fontName=this.layer.layout["text-font"],stack=stacks[fontName]=stacks[fontName]||{};this.textFeatures=resolveText(this.features,this.layer.layout,stack)},SymbolBucket.prototype.addToDebugBuffers=function(collisionTile){for(var layoutVertexArray=this.prepareArrayGroup("collisionBox",0).layoutVertexArray,angle=-collisionTile.angle,yStretch=collisionTile.yStretch,j=this.symbolInstancesStartIndex;j<this.symbolInstancesEndIndex;j++){var symbolInstance=this.symbolInstancesArray.get(j);symbolInstance.textCollisionFeature={boxStartIndex:symbolInstance.textBoxStartIndex,boxEndIndex:symbolInstance.textBoxEndIndex},symbolInstance.iconCollisionFeature={boxStartIndex:symbolInstance.iconBoxStartIndex,boxEndIndex:symbolInstance.iconBoxEndIndex};for(var i=0;i<2;i++){var feature=symbolInstance[0===i?"textCollisionFeature":"iconCollisionFeature"];if(feature)for(var b=feature.boxStartIndex;b<feature.boxEndIndex;b++){var box=this.collisionBoxArray.get(b),anchorPoint=box.anchorPoint,tl=new Point(box.x1,box.y1*yStretch)._rotate(angle),tr=new Point(box.x2,box.y1*yStretch)._rotate(angle),bl=new Point(box.x1,box.y2*yStretch)._rotate(angle),br=new Point(box.x2,box.y2*yStretch)._rotate(angle),maxZoom=Math.max(0,Math.min(25,this.zoom+Math.log(box.maxScale)/Math.LN2)),placementZoom=Math.max(0,Math.min(25,this.zoom+Math.log(box.placementScale)/Math.LN2));this.addCollisionBoxVertex(layoutVertexArray,anchorPoint,tl,maxZoom,placementZoom),this.addCollisionBoxVertex(layoutVertexArray,anchorPoint,tr,maxZoom,placementZoom),this.addCollisionBoxVertex(layoutVertexArray,anchorPoint,tr,maxZoom,placementZoom),this.addCollisionBoxVertex(layoutVertexArray,anchorPoint,br,maxZoom,placementZoom),this.addCollisionBoxVertex(layoutVertexArray,anchorPoint,br,maxZoom,placementZoom),this.addCollisionBoxVertex(layoutVertexArray,anchorPoint,bl,maxZoom,placementZoom),this.addCollisionBoxVertex(layoutVertexArray,anchorPoint,bl,maxZoom,placementZoom),this.addCollisionBoxVertex(layoutVertexArray,anchorPoint,tl,maxZoom,placementZoom)}}}},SymbolBucket.prototype.addSymbolInstance=function(anchor,line,shapedText,shapedIcon,layer,addToBuffers,index,collisionBoxArray,featureIndex,sourceLayerIndex,bucketIndex,textBoxScale,textPadding,textAlongLine,iconBoxScale,iconPadding,iconAlongLine,globalProperties,featureProperties){var glyphQuadStartIndex,glyphQuadEndIndex,iconQuadStartIndex,iconQuadEndIndex,textCollisionFeature,iconCollisionFeature,glyphQuads,iconQuads;if(shapedText&&(glyphQuads=addToBuffers?getGlyphQuads(anchor,shapedText,textBoxScale,line,layer,textAlongLine):[],textCollisionFeature=new CollisionFeature(collisionBoxArray,line,anchor,featureIndex,sourceLayerIndex,bucketIndex,shapedText,textBoxScale,textPadding,textAlongLine,!1)),glyphQuadStartIndex=this.symbolQuadsArray.length,glyphQuads&&glyphQuads.length)for(var i=0;i<glyphQuads.length;i++)this.addSymbolQuad(glyphQuads[i]);glyphQuadEndIndex=this.symbolQuadsArray.length;var textBoxStartIndex=textCollisionFeature?textCollisionFeature.boxStartIndex:this.collisionBoxArray.length,textBoxEndIndex=textCollisionFeature?textCollisionFeature.boxEndIndex:this.collisionBoxArray.length;shapedIcon&&(iconQuads=addToBuffers?getIconQuads(anchor,shapedIcon,iconBoxScale,line,layer,iconAlongLine,shapedText,globalProperties,featureProperties):[],iconCollisionFeature=new CollisionFeature(collisionBoxArray,line,anchor,featureIndex,sourceLayerIndex,bucketIndex,shapedIcon,iconBoxScale,iconPadding,iconAlongLine,!0)),iconQuadStartIndex=this.symbolQuadsArray.length,iconQuads&&1===iconQuads.length&&this.addSymbolQuad(iconQuads[0]),iconQuadEndIndex=this.symbolQuadsArray.length;var iconBoxStartIndex=iconCollisionFeature?iconCollisionFeature.boxStartIndex:this.collisionBoxArray.length,iconBoxEndIndex=iconCollisionFeature?iconCollisionFeature.boxEndIndex:this.collisionBoxArray.length;return iconQuadEndIndex>SymbolBucket.MAX_QUADS&&util.warnOnce("Too many symbols being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),glyphQuadEndIndex>SymbolBucket.MAX_QUADS&&util.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),this.symbolInstancesArray.emplaceBack(textBoxStartIndex,textBoxEndIndex,iconBoxStartIndex,iconBoxEndIndex,glyphQuadStartIndex,glyphQuadEndIndex,iconQuadStartIndex,iconQuadEndIndex,anchor.x,anchor.y,index)},SymbolBucket.prototype.addSymbolQuad=function(symbolQuad){return this.symbolQuadsArray.emplaceBack(symbolQuad.anchorPoint.x,symbolQuad.anchorPoint.y,symbolQuad.tl.x,symbolQuad.tl.y,symbolQuad.tr.x,symbolQuad.tr.y,symbolQuad.bl.x,symbolQuad.bl.y,symbolQuad.br.x,symbolQuad.br.y,symbolQuad.tex.h,symbolQuad.tex.w,symbolQuad.tex.x,symbolQuad.tex.y,symbolQuad.anchorAngle,symbolQuad.glyphAngle,symbolQuad.maxScale,symbolQuad.minScale)}},{"../../symbol/anchor":40,"../../symbol/clip_line":42,"../../symbol/collision_feature":44,"../../symbol/get_anchors":46,"../../symbol/mergelines":47,"../../symbol/quads":48,"../../symbol/resolve_text":49,"../../symbol/shaping":50,"../../util/token":60,"../../util/util":61,"../bucket":24,"../load_geometry":32,"point-geometry":65}],29:[function(require,module,exports){"use strict";function Buffer(array,arrayType,type){this.arrayBuffer=array.arrayBuffer,this.length=array.length,this.attributes=arrayType.members,this.itemSize=arrayType.bytesPerElement,this.type=type,this.arrayType=arrayType}module.exports=Buffer,Buffer.prototype.bind=function(gl){var type=gl[this.type];this.buffer?gl.bindBuffer(type,this.buffer):(this.buffer=gl.createBuffer(),gl.bindBuffer(type,this.buffer),gl.bufferData(type,this.arrayBuffer,gl.STATIC_DRAW),this.arrayBuffer=null)};var AttributeType={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT"};Buffer.prototype.setVertexAttribPointers=function(gl,program){for(var j=0;j<this.attributes.length;j++){var member=this.attributes[j],attribIndex=program[member.name];void 0!==attribIndex&&gl.vertexAttribPointer(attribIndex,member.components,gl[AttributeType[member.type]],!1,this.arrayType.bytesPerElement,member.offset)}},Buffer.prototype.destroy=function(gl){this.buffer&&gl.deleteBuffer(this.buffer)},Buffer.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"}},{}],30:[function(require,module,exports){"use strict";function BufferGroup(arrayGroup,arrayTypes){this.layoutVertexBuffer=new Buffer(arrayGroup.layoutVertexArray,arrayTypes.layoutVertexArrayType,Buffer.BufferType.VERTEX),arrayGroup.elementArray&&(this.elementBuffer=new Buffer(arrayGroup.elementArray,arrayTypes.elementArrayType,Buffer.BufferType.ELEMENT));var secondVaos,vaos=this.vaos={};arrayGroup.elementArray2&&(this.elementBuffer2=new Buffer(arrayGroup.elementArray2,arrayTypes.elementArrayType2,Buffer.BufferType.ELEMENT),secondVaos=this.secondVaos={}),this.paintVertexBuffers=util.mapObject(arrayGroup.paintVertexArrays,function(array,name){return vaos[name]=new VertexArrayObject,arrayGroup.elementArray2&&(secondVaos[name]=new VertexArrayObject),new Buffer(array,arrayTypes.paintVertexArrayTypes[name],Buffer.BufferType.VERTEX)})}var util=require("../util/util"),Buffer=require("./buffer"),VertexArrayObject=require("../render/vertex_array_object");module.exports=BufferGroup,BufferGroup.prototype.destroy=function(gl){this.layoutVertexBuffer.destroy(gl),this.elementBuffer&&this.elementBuffer.destroy(gl),this.elementBuffer2&&this.elementBuffer2.destroy(gl);for(var n in this.paintVertexBuffers)this.paintVertexBuffers[n].destroy(gl);for(var j in this.vaos)this.vaos[j].destroy(gl);for(var k in this.secondVaos)this.secondVaos[k].destroy(gl)}},{"../render/vertex_array_object":34,"../util/util":61,"./buffer":29}],31:[function(require,module,exports){"use strict";function FeatureIndex(coord,overscaling,collisionTile){if(coord.grid){var serialized=coord,rawTileData=overscaling;coord=serialized.coord,overscaling=serialized.overscaling,this.grid=new Grid(serialized.grid),this.featureIndexArray=new FeatureIndexArray(serialized.featureIndexArray),this.rawTileData=rawTileData,this.bucketLayerIDs=serialized.bucketLayerIDs}else this.grid=new Grid(EXTENT,16,0),this.featureIndexArray=new FeatureIndexArray;this.coord=coord,this.overscaling=overscaling,this.x=coord.x,this.y=coord.y,this.z=coord.z-Math.log(overscaling)/Math.LN2,this.setCollisionTile(collisionTile)}function translateDistance(translate){return Math.sqrt(translate[0]*translate[0]+translate[1]*translate[1])}function topDownFeatureComparator(a,b){return b-a}function getLineWidth(paint){return paint["line-gap-width"]>0?paint["line-gap-width"]+2*paint["line-width"]:paint["line-width"]}function translate(queryGeometry,translate,translateAnchor,bearing,pixelsToTileUnits){if(!translate[0]&&!translate[1])return queryGeometry;translate=Point.convert(translate),"viewport"===translateAnchor&&translate._rotate(-bearing);for(var translated=[],i=0;i<queryGeometry.length;i++){for(var ring=queryGeometry[i],translatedRing=[],k=0;k<ring.length;k++)translatedRing.push(ring[k].sub(translate._mult(pixelsToTileUnits)));translated.push(translatedRing)}return translated}function offsetLine(rings,offset){for(var newRings=[],zero=new Point(0,0),k=0;k<rings.length;k++){for(var ring=rings[k],newRing=[],i=0;i<ring.length;i++){var a=ring[i-1],b=ring[i],c=ring[i+1],aToB=0===i?zero:b.sub(a)._unit()._perp(),bToC=i===ring.length-1?zero:c.sub(b)._unit()._perp(),extrude=aToB._add(bToC)._unit(),cosHalfAngle=extrude.x*bToC.x+extrude.y*bToC.y;extrude._mult(1/cosHalfAngle),newRing.push(extrude._mult(offset)._add(b))}newRings.push(newRing)}return newRings}var Point=require("point-geometry"),loadGeometry=require("./load_geometry"),EXTENT=require("./bucket").EXTENT,featureFilter=require("feature-filter"),StructArrayType=require("../util/struct_array"),Grid=require("grid-index"),DictionaryCoder=require("../util/dictionary_coder"),vt=require("vector-tile"),Protobuf=require("pbf"),GeoJSONFeature=require("../util/vectortile_to_geojson"),arraysIntersect=require("../util/util").arraysIntersect,intersection=require("../util/intersection_tests"),multiPolygonIntersectsBufferedMultiPoint=intersection.multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon=intersection.multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine=intersection.multiPolygonIntersectsBufferedMultiLine,FeatureIndexArray=new StructArrayType({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]});module.exports=FeatureIndex,FeatureIndex.prototype.insert=function(feature,featureIndex,sourceLayerIndex,bucketIndex){var key=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(featureIndex,sourceLayerIndex,bucketIndex);for(var geometry=loadGeometry(feature),r=0;r<geometry.length;r++){for(var ring=geometry[r],bbox=[1/0,1/0,-1/0,-1/0],i=0;i<ring.length;i++){var p=ring[i];bbox[0]=Math.min(bbox[0],p.x),bbox[1]=Math.min(bbox[1],p.y),bbox[2]=Math.max(bbox[2],p.x),bbox[3]=Math.max(bbox[3],p.y)}this.grid.insert(key,bbox[0],bbox[1],bbox[2],bbox[3])}},FeatureIndex.prototype.setCollisionTile=function(collisionTile){this.collisionTile=collisionTile},FeatureIndex.prototype.serialize=function(){var data={coord:this.coord,overscaling:this.overscaling,grid:this.grid.toArrayBuffer(),featureIndexArray:this.featureIndexArray.serialize(),bucketLayerIDs:this.bucketLayerIDs};return{data:data,transferables:[data.grid,data.featureIndexArray.arrayBuffer]}},FeatureIndex.prototype.query=function(args,styleLayers){this.vtLayers||(this.vtLayers=new vt.VectorTile(new Protobuf(new Uint8Array(this.rawTileData))).layers,this.sourceLayerCoder=new DictionaryCoder(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));var result={},params=args.params||{},pixelsToTileUnits=EXTENT/args.tileSize/args.scale,filter=featureFilter(params.filter),additionalRadius=0;for(var id in styleLayers){var styleLayer=styleLayers[id],paint=styleLayer.paint,styleLayerDistance=0;"line"===styleLayer.type?styleLayerDistance=getLineWidth(paint)/2+Math.abs(paint["line-offset"])+translateDistance(paint["line-translate"]):"fill"===styleLayer.type?styleLayerDistance=translateDistance(paint["fill-translate"]):"circle"===styleLayer.type&&(styleLayerDistance=paint["circle-radius"]+translateDistance(paint["circle-translate"])),additionalRadius=Math.max(additionalRadius,styleLayerDistance*pixelsToTileUnits)}for(var queryGeometry=args.queryGeometry.map(function(q){return q.map(function(p){return new Point(p.x,p.y)})}),minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0,i=0;i<queryGeometry.length;i++)for(var ring=queryGeometry[i],k=0;k<ring.length;k++){var p=ring[k];minX=Math.min(minX,p.x),minY=Math.min(minY,p.y),maxX=Math.max(maxX,p.x),maxY=Math.max(maxY,p.y)}var matching=this.grid.query(minX-additionalRadius,minY-additionalRadius,maxX+additionalRadius,maxY+additionalRadius);matching.sort(topDownFeatureComparator),this.filterMatching(result,matching,this.featureIndexArray,queryGeometry,filter,params.layers,styleLayers,args.bearing,pixelsToTileUnits);var matchingSymbols=this.collisionTile.queryRenderedSymbols(minX,minY,maxX,maxY,args.scale);return matchingSymbols.sort(),this.filterMatching(result,matchingSymbols,this.collisionTile.collisionBoxArray,queryGeometry,filter,params.layers,styleLayers,args.bearing,pixelsToTileUnits),result},FeatureIndex.prototype.filterMatching=function(result,matching,array,queryGeometry,filter,filterLayerIDs,styleLayers,bearing,pixelsToTileUnits){for(var previousIndex,k=0;k<matching.length;k++){var index=matching[k];if(index!==previousIndex){previousIndex=index;var match=array.get(index),layerIDs=this.bucketLayerIDs[match.bucketIndex];if(!filterLayerIDs||arraysIntersect(filterLayerIDs,layerIDs)){var sourceLayerName=this.sourceLayerCoder.decode(match.sourceLayerIndex),feature=this.vtLayers[sourceLayerName].feature(match.featureIndex);if(filter(feature))for(var geometry=null,l=0;l<layerIDs.length;l++){var layerID=layerIDs[l];if(!(filterLayerIDs&&filterLayerIDs.indexOf(layerID)<0)){var styleLayer=styleLayers[layerID];if(styleLayer){var translatedPolygon;if("symbol"!==styleLayer.type){geometry||(geometry=loadGeometry(feature));var paint=styleLayer.paint;if("line"===styleLayer.type){translatedPolygon=translate(queryGeometry,paint["line-translate"],paint["line-translate-anchor"],bearing,pixelsToTileUnits);var halfWidth=getLineWidth(paint)/2*pixelsToTileUnits;if(paint["line-offset"]&&(geometry=offsetLine(geometry,paint["line-offset"]*pixelsToTileUnits)),!multiPolygonIntersectsBufferedMultiLine(translatedPolygon,geometry,halfWidth))continue}else if("fill"===styleLayer.type){if(translatedPolygon=translate(queryGeometry,paint["fill-translate"],paint["fill-translate-anchor"],bearing,pixelsToTileUnits),!multiPolygonIntersectsMultiPolygon(translatedPolygon,geometry))continue}else if("circle"===styleLayer.type){translatedPolygon=translate(queryGeometry,paint["circle-translate"],paint["circle-translate-anchor"],bearing,pixelsToTileUnits);var circleRadius=paint["circle-radius"]*pixelsToTileUnits;if(!multiPolygonIntersectsBufferedMultiPoint(translatedPolygon,geometry,circleRadius))continue}}var geojsonFeature=new GeoJSONFeature(feature,this.z,this.x,this.y);geojsonFeature.layer=styleLayer.serialize({includeRefProperties:!0});var layerResult=result[layerID];void 0===layerResult&&(layerResult=result[layerID]=[]),layerResult.push(geojsonFeature)}}}}}}}},{"../util/dictionary_coder":55,"../util/intersection_tests":58,"../util/struct_array":59,"../util/util":61,"../util/vectortile_to_geojson":62,"./bucket":24,"./load_geometry":32,"feature-filter":6,"grid-index":17,pbf:64,"point-geometry":65,"vector-tile":71}],32:[function(require,module,exports){"use strict";function createBounds(bits){return{min:-1*Math.pow(2,bits-1),max:Math.pow(2,bits-1)-1}}var util=require("../util/util"),EXTENT=require("./bucket").EXTENT,assert=require("assert"),boundsLookup={15:createBounds(15),16:createBounds(16)};module.exports=function(feature,bits){var bounds=boundsLookup[bits||16];assert(bounds);for(var scale=EXTENT/feature.extent,geometry=feature.loadGeometry(),r=0;r<geometry.length;r++)for(var ring=geometry[r],p=0;p<ring.length;p++){var point=ring[p];point.x=Math.round(point.x*scale),point.y=Math.round(point.y*scale),(point.x<bounds.min||point.x>bounds.max||point.y<bounds.min||point.y>bounds.max)&&util.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return geometry}},{"../util/util":61,"./bucket":24,assert:80}],33:[function(require,module,exports){"use strict";function Coordinate(column,row,zoom){this.column=column,this.row=row,this.zoom=zoom}module.exports=Coordinate,Coordinate.prototype={clone:function(){return new Coordinate(this.column,this.row,this.zoom)},zoomTo:function(zoom){return this.clone()._zoomTo(zoom)},sub:function(c){return this.clone()._sub(c)},_zoomTo:function(zoom){var scale=Math.pow(2,zoom-this.zoom);return this.column*=scale,this.row*=scale,this.zoom=zoom,this},_sub:function(c){return c=c.zoomTo(this.zoom),this.column-=c.column,this.row-=c.row,this}}},{}],34:[function(require,module,exports){"use strict";function VertexArrayObject(){this.boundProgram=null,this.boundVertexBuffer=null,this.boundVertexBuffer2=null,this.boundElementBuffer=null,this.vao=null}var assert=require("assert");module.exports=VertexArrayObject,VertexArrayObject.prototype.bind=function(gl,program,layoutVertexBuffer,elementBuffer,vertexBuffer2){void 0===gl.extVertexArrayObject&&(gl.extVertexArrayObject=gl.getExtension("OES_vertex_array_object"));var isFreshBindRequired=!this.vao||this.boundProgram!==program||this.boundVertexBuffer!==layoutVertexBuffer||this.boundVertexBuffer2!==vertexBuffer2||this.boundElementBuffer!==elementBuffer;!gl.extVertexArrayObject||isFreshBindRequired?this.freshBind(gl,program,layoutVertexBuffer,elementBuffer,vertexBuffer2):gl.extVertexArrayObject.bindVertexArrayOES(this.vao)},VertexArrayObject.prototype.freshBind=function(gl,program,layoutVertexBuffer,elementBuffer,vertexBuffer2){var numPrevAttributes,numNextAttributes=program.numAttributes;if(gl.extVertexArrayObject)this.vao&&this.destroy(gl),this.vao=gl.extVertexArrayObject.createVertexArrayOES(),gl.extVertexArrayObject.bindVertexArrayOES(this.vao),numPrevAttributes=0,this.boundProgram=program,this.boundVertexBuffer=layoutVertexBuffer,this.boundVertexBuffer2=vertexBuffer2,this.boundElementBuffer=elementBuffer;else{numPrevAttributes=gl.currentNumAttributes||0;for(var i=numNextAttributes;i<numPrevAttributes;i++)assert(0!==i),gl.disableVertexAttribArray(i)}for(var j=numPrevAttributes;j<numNextAttributes;j++)gl.enableVertexAttribArray(j);layoutVertexBuffer.bind(gl),layoutVertexBuffer.setVertexAttribPointers(gl,program),vertexBuffer2&&(vertexBuffer2.bind(gl),vertexBuffer2.setVertexAttribPointers(gl,program)),elementBuffer&&elementBuffer.bind(gl),gl.currentNumAttributes=numNextAttributes},VertexArrayObject.prototype.unbind=function(gl){var ext=gl.extVertexArrayObject;ext&&ext.bindVertexArrayOES(null)},VertexArrayObject.prototype.destroy=function(gl){var ext=gl.extVertexArrayObject;ext&&this.vao&&(ext.deleteVertexArrayOES(this.vao),this.vao=null)}},{assert:80}],35:[function(require,module,exports){"use strict";function GeoJSONSource(id,options,dispatcher){options=options||{},this.id=id,this.dispatcher=dispatcher,this._data=options.data,void 0!==options.maxzoom&&(this.maxzoom=options.maxzoom),options.type&&(this.type=options.type);var scale=EXTENT/this.tileSize;this.workerOptions=util.extend({source:this.id,cluster:options.cluster||!1,geojsonVtOptions:{buffer:(void 0!==options.buffer?options.buffer:128)*scale,tolerance:(void 0!==options.tolerance?options.tolerance:.375)*scale,extent:EXTENT,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:Math.min(options.clusterMaxZoom,this.maxzoom-1)||this.maxzoom-1,extent:EXTENT,radius:(options.clusterRadius||50)*scale,log:!1}},options.workerOptions),this._updateWorkerData(function(err){err?this.fire("error",{error:err}):this.fire("load")}.bind(this))}var Evented=require("../util/evented"),util=require("../util/util"),urlResolve=require("resolve-url"),EXTENT=require("../data/bucket").EXTENT;module.exports=GeoJSONSource,GeoJSONSource.prototype=util.inherit(Evented,{type:"geojson",minzoom:0,maxzoom:18,tileSize:512,isTileClipped:!0,reparseOverscaled:!0,onAdd:function(map){this.map=map},setData:function(data){return this._data=data,this._updateWorkerData(function(err){if(err)return this.fire("error",{error:err});this.fire("change")}.bind(this)),this},_updateWorkerData:function(callback){var options=util.extend({},this.workerOptions),data=this._data;"string"==typeof data?options.url="undefined"!=typeof window?urlResolve(window.location.href,data):data:options.data=JSON.stringify(data),this.workerID=this.dispatcher.send(this.type+".loadData",options,function(err){this._loaded=!0,callback(err)}.bind(this))},loadTile:function(tile,callback){var overscaling=tile.coord.z>this.maxzoom?Math.pow(2,tile.coord.z-this.maxzoom):1,params={type:this.type,uid:tile.uid,coord:tile.coord,zoom:tile.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:overscaling,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};tile.workerID=this.dispatcher.send("load tile",params,function(err,data){if(tile.unloadVectorData(this.map.painter),!tile.aborted)return err?callback(err):(tile.loadVectorData(data,this.map.style),tile.redoWhenDone&&(tile.redoWhenDone=!1,tile.redoPlacement(this)),callback(null))}.bind(this),this.workerID)},abortTile:function(tile){tile.aborted=!0},unloadTile:function(tile){tile.unloadVectorData(this.map.painter),this.dispatcher.send("remove tile",{uid:tile.uid,source:this.id},function(){},tile.workerID)},serialize:function(){return{type:this.type,data:this._data}}})},{"../data/bucket":24,"../util/evented":56,"../util/util":61,"resolve-url":67}],36:[function(require,module,exports){"use strict";function GeoJSONWorkerSource(actor,styleLayers,loadGeoJSON){loadGeoJSON&&(this.loadGeoJSON=loadGeoJSON),VectorTileWorkerSource.call(this,actor,styleLayers)}var util=require("../util/util"),ajax=require("../util/ajax"),rewind=require("geojson-rewind"),GeoJSONWrapper=require("./geojson_wrapper"),vtpbf=require("vt-pbf"),supercluster=require("supercluster"),geojsonvt=require("geojson-vt"),VectorTileWorkerSource=require("./vector_tile_worker_source");module.exports=GeoJSONWorkerSource,GeoJSONWorkerSource.prototype=util.inherit(VectorTileWorkerSource,{_geoJSONIndexes:{},loadVectorData:function(params,callback){var source=params.source,coord=params.coord;if(!this._geoJSONIndexes[source])return callback(null,null);var geoJSONTile=this._geoJSONIndexes[source].getTile(Math.min(coord.z,params.maxZoom),coord.x,coord.y);if(!geoJSONTile)return callback(null,null);var geojsonWrapper=new GeoJSONWrapper(geoJSONTile.features);geojsonWrapper.name="_geojsonTileLayer";var pbf=vtpbf({layers:{_geojsonTileLayer:geojsonWrapper}});0===pbf.byteOffset&&pbf.byteLength===pbf.buffer.byteLength||(pbf=new Uint8Array(pbf)),callback(null,{tile:geojsonWrapper,rawTileData:pbf.buffer})},loadData:function(params,callback){var handleData=function(err,data){return err?callback(err):"object"!=typeof data?callback(new Error("Input data is not a valid GeoJSON object.")):(rewind(data,!0),void this._indexData(data,params,function(err,indexed){if(err)return callback(err);this._geoJSONIndexes[params.source]=indexed,callback(null)}.bind(this)))}.bind(this);this.loadGeoJSON(params,handleData)},loadGeoJSON:function(params,callback){if(params.url)ajax.getJSON(params.url,callback);else{if("string"!=typeof params.data)return callback(new Error("Input data is not a valid GeoJSON object."));try{return callback(null,JSON.parse(params.data))}catch(e){return callback(new Error("Input data is not a valid GeoJSON object."))}}},_indexData:function(data,params,callback){try{params.cluster?callback(null,supercluster(params.superclusterOptions).load(data.features)):callback(null,geojsonvt(data,params.geojsonVtOptions))}catch(err){return callback(err)}}})},{"../util/ajax":53,"../util/util":61,"./geojson_wrapper":37,"./vector_tile_worker_source":38,"geojson-rewind":8,"geojson-vt":12,supercluster:69,"vt-pbf":75}],37:[function(require,module,exports){"use strict";function GeoJSONWrapper(features){this.features=features,this.length=features.length,this.extent=EXTENT}function FeatureWrapper(feature){if(this.type=feature.type,1===feature.type){this.rawGeometry=[];for(var i=0;i<feature.geometry.length;i++)this.rawGeometry.push([feature.geometry[i]])}else this.rawGeometry=feature.geometry;this.properties=feature.tags,this.extent=EXTENT}var Point=require("point-geometry"),VectorTileFeature=require("vector-tile").VectorTileFeature,EXTENT=require("../data/bucket").EXTENT;module.exports=GeoJSONWrapper,GeoJSONWrapper.prototype.feature=function(i){return new FeatureWrapper(this.features[i])},FeatureWrapper.prototype.loadGeometry=function(){var rings=this.rawGeometry;this.geometry=[];for(var i=0;i<rings.length;i++){for(var ring=rings[i],newRing=[],j=0;j<ring.length;j++)newRing.push(new Point(ring[j][0],ring[j][1]));this.geometry.push(newRing)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var rings=this.geometry,x1=1/0,x2=-1/0,y1=1/0,y2=-1/0,i=0;i<rings.length;i++)for(var ring=rings[i],j=0;j<ring.length;j++){var coord=ring[j];x1=Math.min(x1,coord.x),x2=Math.max(x2,coord.x),y1=Math.min(y1,coord.y),y2=Math.max(y2,coord.y)}return[x1,y1,x2,y2]},FeatureWrapper.prototype.toGeoJSON=VectorTileFeature.prototype.toGeoJSON},{"../data/bucket":24,"point-geometry":65,"vector-tile":71}],38:[function(require,module,exports){"use strict";function VectorTileWorkerSource(actor,styleLayers,loadVectorData){this.actor=actor,this.styleLayers=styleLayers,loadVectorData&&(this.loadVectorData=loadVectorData),this.loading={},this.loaded={}}var ajax=require("../util/ajax"),vt=require("vector-tile"),Protobuf=require("pbf"),WorkerTile=require("./worker_tile");module.exports=VectorTileWorkerSource,VectorTileWorkerSource.prototype={loadTile:function(params,callback){function done(err,data){return delete this.loading[source][uid],err?callback(err):data?(tile.data=data.tile,tile.parse(tile.data,this.styleLayers.getLayerFamilies(),this.actor,data.rawTileData,callback),this.loaded[source]=this.loaded[source]||{},void(this.loaded[source][uid]=tile)):callback(null,null)}var source=params.source,uid=params.uid;this.loading[source]||(this.loading[source]={});var tile=this.loading[source][uid]=new WorkerTile(params);tile.abort=this.loadVectorData(params,done.bind(this))},reloadTile:function(params,callback){var loaded=this.loaded[params.source],uid=params.uid;if(loaded&&loaded[uid]){var tile=loaded[uid];tile.parse(tile.data,this.styleLayers.getLayerFamilies(),this.actor,params.rawTileData,callback)}},abortTile:function(params){var loading=this.loading[params.source],uid=params.uid;loading&&loading[uid]&&loading[uid].abort&&(loading[uid].abort(),delete loading[uid])},removeTile:function(params){var loaded=this.loaded[params.source],uid=params.uid;loaded&&loaded[uid]&&delete loaded[uid]},loadVectorData:function(params,callback){function done(err,data){if(err)return callback(err);var tile=new vt.VectorTile(new Protobuf(new Uint8Array(data)));callback(err,{tile:tile,rawTileData:data})}var xhr=ajax.getArrayBuffer(params.url,done.bind(this));return function(){xhr.abort()}},redoPlacement:function(params,callback){var loaded=this.loaded[params.source],loading=this.loading[params.source],uid=params.uid;if(loaded&&loaded[uid]){var result=loaded[uid].redoPlacement(params.angle,params.pitch,params.showCollisionBoxes);result.result&&callback(null,result.result,result.transferables)}else loading&&loading[uid]&&(loading[uid].angle=params.angle)}}},{"../util/ajax":53,"./worker_tile":39,pbf:64,"vector-tile":71}],39:[function(require,module,exports){"use strict";function WorkerTile(params){this.coord=params.coord,this.uid=params.uid,this.zoom=params.zoom,this.tileSize=params.tileSize,this.source=params.source,this.overscaling=params.overscaling,this.angle=params.angle,this.pitch=params.pitch,this.showCollisionBoxes=params.showCollisionBoxes}function isBucketNonEmpty(bucket){return!bucket.isEmpty()}function serializeBucket(bucket){return bucket.serialize()}function getTransferables(buckets){var transferables=[];for(var i in buckets)buckets[i].getTransferables(transferables);return transferables}function getLayerId(layer){return layer.id}var FeatureIndex=require("../data/feature_index"),CollisionTile=require("../symbol/collision_tile"),Bucket=require("../data/bucket"),CollisionBoxArray=require("../symbol/collision_box"),DictionaryCoder=require("../util/dictionary_coder"),util=require("../util/util"),SymbolInstancesArray=require("../symbol/symbol_instances"),SymbolQuadsArray=require("../symbol/symbol_quads");module.exports=WorkerTile,WorkerTile.prototype.parse=function(data,layerFamilies,actor,rawTileData,callback){function sortLayerIntoBuckets(layer,buckets){for(var i=0;i<layer.length;i++){var feature=layer.feature(i);feature.index=i;for(var id in buckets)buckets[id].filter(feature)&&buckets[id].features.push(feature)}}function gotDependency(err){if(err)return callback(err);if(2===++deps){for(var i=symbolBuckets.length-1;i>=0;i--)parseBucket(tile,symbolBuckets[i]);done()}}function parseBucket(tile,bucket){if(bucket.populateArrays(collisionTile,stacks,icons),"symbol"!==bucket.type)for(var i=0;i<bucket.features.length;i++){var feature=bucket.features[i];featureIndex.insert(feature,feature.index,bucket.sourceLayerIndex,bucket.index)}bucket.features=null}function done(){tile.status="done",tile.redoPlacementAfterDone&&(tile.redoPlacement(tile.angle,tile.pitch,null),tile.redoPlacementAfterDone=!1);var featureIndex_=featureIndex.serialize(),collisionTile_=collisionTile.serialize(),collisionBoxArray=tile.collisionBoxArray.serialize(),symbolInstancesArray=tile.symbolInstancesArray.serialize(),symbolQuadsArray=tile.symbolQuadsArray.serialize(),transferables=[rawTileData].concat(featureIndex_.transferables).concat(collisionTile_.transferables),nonEmptyBuckets=buckets.filter(isBucketNonEmpty);callback(null,{buckets:nonEmptyBuckets.map(serializeBucket),featureIndex:featureIndex_.data,collisionTile:collisionTile_.data,collisionBoxArray:collisionBoxArray,symbolInstancesArray:symbolInstancesArray,symbolQuadsArray:symbolQuadsArray,rawTileData:rawTileData},getTransferables(nonEmptyBuckets).concat(transferables))}this.status="parsing",this.data=data,this.collisionBoxArray=new CollisionBoxArray,this.symbolInstancesArray=new SymbolInstancesArray,this.symbolQuadsArray=new SymbolQuadsArray;var i,layer,sourceLayerId,bucket,collisionTile=new CollisionTile(this.angle,this.pitch,this.collisionBoxArray),featureIndex=new FeatureIndex(this.coord,this.overscaling,collisionTile,data.layers),sourceLayerCoder=new DictionaryCoder(data.layers?Object.keys(data.layers).sort():["_geojsonTileLayer"]),tile=this,bucketsById={},bucketsBySourceLayer={},bucketIndex=0;for(var layerId in layerFamilies)(layer=layerFamilies[layerId][0]).source===this.source&&(layer.ref||layer.minzoom&&this.zoom<layer.minzoom||layer.maxzoom&&this.zoom>=layer.maxzoom||layer.layout&&"none"===layer.layout.visibility||data.layers&&!data.layers[layer.sourceLayer]||((bucket=Bucket.create({layer:layer,index:bucketIndex++,childLayers:layerFamilies[layerId],zoom:this.zoom,overscaling:this.overscaling,showCollisionBoxes:this.showCollisionBoxes,collisionBoxArray:this.collisionBoxArray,symbolQuadsArray:this.symbolQuadsArray,symbolInstancesArray:this.symbolInstancesArray,sourceLayerIndex:sourceLayerCoder.encode(layer.sourceLayer||"_geojsonTileLayer")})).createFilter(),bucketsById[layer.id]=bucket,data.layers&&(bucketsBySourceLayer[sourceLayerId=layer.sourceLayer]=bucketsBySourceLayer[sourceLayerId]||{},bucketsBySourceLayer[sourceLayerId][layer.id]=bucket)));if(data.layers)for(sourceLayerId in bucketsBySourceLayer)1===layer.version&&util.warnOnce('Vector tile source "'+this.source+'" layer "'+sourceLayerId+'" does not use vector tile spec v2 and therefore may have some rendering errors.'),(layer=data.layers[sourceLayerId])&&sortLayerIntoBuckets(layer,bucketsBySourceLayer[sourceLayerId]);else sortLayerIntoBuckets(data,bucketsById);var buckets=[],symbolBuckets=this.symbolBuckets=[],otherBuckets=[];featureIndex.bucketLayerIDs={};for(var id in bucketsById)0!==(bucket=bucketsById[id]).features.length&&(featureIndex.bucketLayerIDs[bucket.index]=bucket.childLayers.map(getLayerId),buckets.push(bucket),"symbol"===bucket.type?symbolBuckets.push(bucket):otherBuckets.push(bucket));var icons={},stacks={},deps=0;if(symbolBuckets.length>0){for(i=symbolBuckets.length-1;i>=0;i--)symbolBuckets[i].updateIcons(icons),symbolBuckets[i].updateFont(stacks);for(var fontName in stacks)stacks[fontName]=Object.keys(stacks[fontName]).map(Number);icons=Object.keys(icons),actor.send("get glyphs",{uid:this.uid,stacks:stacks},function(err,newStacks){stacks=newStacks,gotDependency(err)}),icons.length?actor.send("get icons",{icons:icons},function(err,newIcons){icons=newIcons,gotDependency(err)}):gotDependency()}for(i=otherBuckets.length-1;i>=0;i--)parseBucket(this,otherBuckets[i]);if(0===symbolBuckets.length)return done()},WorkerTile.prototype.redoPlacement=function(angle,pitch,showCollisionBoxes){if("done"!==this.status)return this.redoPlacementAfterDone=!0,this.angle=angle,{};for(var collisionTile=new CollisionTile(angle,pitch,this.collisionBoxArray),buckets=this.symbolBuckets,i=buckets.length-1;i>=0;i--)buckets[i].placeFeatures(collisionTile,showCollisionBoxes);var collisionTile_=collisionTile.serialize(),nonEmptyBuckets=buckets.filter(isBucketNonEmpty);return{result:{buckets:nonEmptyBuckets.map(serializeBucket),collisionTile:collisionTile_.data},transferables:getTransferables(nonEmptyBuckets).concat(collisionTile_.transferables)}}},{"../data/bucket":24,"../data/feature_index":31,"../symbol/collision_box":43,"../symbol/collision_tile":45,"../symbol/symbol_instances":51,"../symbol/symbol_quads":52,"../util/dictionary_coder":55,"../util/util":61}],40:[function(require,module,exports){"use strict";function Anchor(x,y,angle,segment){this.x=x,this.y=y,this.angle=angle,void 0!==segment&&(this.segment=segment)}var Point=require("point-geometry");module.exports=Anchor,Anchor.prototype=Object.create(Point.prototype),Anchor.prototype.clone=function(){return new Anchor(this.x,this.y,this.angle,this.segment)}},{"point-geometry":65}],41:[function(require,module,exports){"use strict";function checkMaxAngle(line,anchor,labelLength,windowSize,maxAngle){if(void 0===anchor.segment)return!0;for(var p=anchor,index=anchor.segment+1,anchorDistance=0;anchorDistance>-labelLength/2;){if(--index<0)return!1;anchorDistance-=line[index].dist(p),p=line[index]}anchorDistance+=line[index].dist(line[index+1]),index++;for(var recentCorners=[],recentAngleDelta=0;anchorDistance<labelLength/2;){var prev=line[index-1],current=line[index],next=line[index+1];if(!next)return!1;var angleDelta=prev.angleTo(current)-current.angleTo(next);for(angleDelta=Math.abs((angleDelta+3*Math.PI)%(2*Math.PI)-Math.PI),recentCorners.push({distance:anchorDistance,angleDelta:angleDelta}),recentAngleDelta+=angleDelta;anchorDistance-recentCorners[0].distance>windowSize;)recentAngleDelta-=recentCorners.shift().angleDelta;if(recentAngleDelta>maxAngle)return!1;index++,anchorDistance+=current.dist(next)}return!0}module.exports=checkMaxAngle},{}],42:[function(require,module,exports){"use strict";function clipLine(lines,x1,y1,x2,y2){for(var clippedLines=[],l=0;l<lines.length;l++)for(var clippedLine,line=lines[l],i=0;i<line.length-1;i++){var p0=line[i],p1=line[i+1];p0.x<x1&&p1.x<x1||(p0.x<x1?p0=new Point(x1,p0.y+(p1.y-p0.y)*((x1-p0.x)/(p1.x-p0.x)))._round():p1.x<x1&&(p1=new Point(x1,p0.y+(p1.y-p0.y)*((x1-p0.x)/(p1.x-p0.x)))._round()),p0.y<y1&&p1.y<y1||(p0.y<y1?p0=new Point(p0.x+(p1.x-p0.x)*((y1-p0.y)/(p1.y-p0.y)),y1)._round():p1.y<y1&&(p1=new Point(p0.x+(p1.x-p0.x)*((y1-p0.y)/(p1.y-p0.y)),y1)._round()),p0.x>=x2&&p1.x>=x2||(p0.x>=x2?p0=new Point(x2,p0.y+(p1.y-p0.y)*((x2-p0.x)/(p1.x-p0.x)))._round():p1.x>=x2&&(p1=new Point(x2,p0.y+(p1.y-p0.y)*((x2-p0.x)/(p1.x-p0.x)))._round()),p0.y>=y2&&p1.y>=y2||(p0.y>=y2?p0=new Point(p0.x+(p1.x-p0.x)*((y2-p0.y)/(p1.y-p0.y)),y2)._round():p1.y>=y2&&(p1=new Point(p0.x+(p1.x-p0.x)*((y2-p0.y)/(p1.y-p0.y)),y2)._round()),clippedLine&&p0.equals(clippedLine[clippedLine.length-1])||(clippedLine=[p0],clippedLines.push(clippedLine)),clippedLine.push(p1)))))}return clippedLines}var Point=require("point-geometry");module.exports=clipLine},{"point-geometry":65}],43:[function(require,module,exports){"use strict";var StructArrayType=require("../util/struct_array"),util=require("../util/util"),Point=require("point-geometry"),CollisionBoxArray=module.exports=new StructArrayType({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});util.extendAll(CollisionBoxArray.prototype.StructType.prototype,{get anchorPoint(){return new Point(this.anchorPointX,this.anchorPointY)}})},{"../util/struct_array":59,"../util/util":61,"point-geometry":65}],44:[function(require,module,exports){"use strict";function CollisionFeature(collisionBoxArray,line,anchor,featureIndex,sourceLayerIndex,bucketIndex,shaped,boxScale,padding,alignLine,straight){var y1=shaped.top*boxScale-padding,y2=shaped.bottom*boxScale+padding,x1=shaped.left*boxScale-padding,x2=shaped.right*boxScale+padding;if(this.boxStartIndex=collisionBoxArray.length,alignLine){var height=y2-y1,length=x2-x1;if(height>0)if(height=Math.max(10*boxScale,height),straight){var vector=line[anchor.segment+1].sub(line[anchor.segment])._unit()._mult(length),straightLine=[anchor.sub(vector),anchor.add(vector)];this._addLineCollisionBoxes(collisionBoxArray,straightLine,anchor,0,length,height,featureIndex,sourceLayerIndex,bucketIndex)}else this._addLineCollisionBoxes(collisionBoxArray,line,anchor,anchor.segment,length,height,featureIndex,sourceLayerIndex,bucketIndex)}else collisionBoxArray.emplaceBack(anchor.x,anchor.y,x1,y1,x2,y2,1/0,featureIndex,sourceLayerIndex,bucketIndex,0,0,0,0,0);this.boxEndIndex=collisionBoxArray.length}module.exports=CollisionFeature,CollisionFeature.prototype._addLineCollisionBoxes=function(collisionBoxArray,line,anchor,segment,labelLength,boxSize,featureIndex,sourceLayerIndex,bucketIndex){var step=boxSize/2,nBoxes=Math.floor(labelLength/step),firstBoxOffset=-boxSize/2,bboxes=this.boxes,p=anchor,index=segment+1,anchorDistance=firstBoxOffset;do{if(--index<0)return bboxes;anchorDistance-=line[index].dist(p),p=line[index]}while(anchorDistance>-labelLength/2);for(var segmentLength=line[index].dist(line[index+1]),i=0;i<nBoxes;i++){for(var boxDistanceToAnchor=-labelLength/2+i*step;anchorDistance+segmentLength<boxDistanceToAnchor;){if(anchorDistance+=segmentLength,++index+1>=line.length)return bboxes;segmentLength=line[index].dist(line[index+1])}var segmentBoxDistance=boxDistanceToAnchor-anchorDistance,p0=line[index],boxAnchorPoint=line[index+1].sub(p0)._unit()._mult(segmentBoxDistance)._add(p0)._round(),maxScale=labelLength/2/Math.max(Math.abs(boxDistanceToAnchor-firstBoxOffset)-step/2,0);collisionBoxArray.emplaceBack(boxAnchorPoint.x,boxAnchorPoint.y,-boxSize/2,-boxSize/2,boxSize/2,boxSize/2,maxScale,featureIndex,sourceLayerIndex,bucketIndex,0,0,0,0,0)}return bboxes}},{}],45:[function(require,module,exports){"use strict";function CollisionTile(angle,pitch,collisionBoxArray){if("object"==typeof angle){var serialized=angle;collisionBoxArray=pitch,angle=serialized.angle,pitch=serialized.pitch,this.grid=new Grid(serialized.grid),this.ignoredGrid=new Grid(serialized.ignoredGrid)}else this.grid=new Grid(EXTENT,12,6),this.ignoredGrid=new Grid(EXTENT,12,0);this.angle=angle,this.pitch=pitch;var sin=Math.sin(angle),cos=Math.cos(angle);if(this.rotationMatrix=[cos,-sin,sin,cos],this.reverseRotationMatrix=[cos,sin,-sin,cos],this.yStretch=1/Math.cos(pitch/180*Math.PI),this.yStretch=Math.pow(this.yStretch,1.3),this.collisionBoxArray=collisionBoxArray,0===collisionBoxArray.length){collisionBoxArray.emplaceBack();collisionBoxArray.emplaceBack(0,0,0,-32767,0,32767,32767,0,0,0,0,0,0,0,0,0),collisionBoxArray.emplaceBack(EXTENT,0,0,-32767,0,32767,32767,0,0,0,0,0,0,0,0,0),collisionBoxArray.emplaceBack(0,0,-32767,0,32767,0,32767,0,0,0,0,0,0,0,0,0),collisionBoxArray.emplaceBack(0,EXTENT,-32767,0,32767,0,32767,0,0,0,0,0,0,0,0,0)}this.tempCollisionBox=collisionBoxArray.get(0),this.edges=[collisionBoxArray.get(1),collisionBoxArray.get(2),collisionBoxArray.get(3),collisionBoxArray.get(4)]}var Point=require("point-geometry"),EXTENT=require("../data/bucket").EXTENT,Grid=require("grid-index");module.exports=CollisionTile,CollisionTile.prototype.serialize=function(){var data={angle:this.angle,pitch:this.pitch,grid:this.grid.toArrayBuffer(),ignoredGrid:this.ignoredGrid.toArrayBuffer()};return{data:data,transferables:[data.grid,data.ignoredGrid]}},CollisionTile.prototype.minScale=.25,CollisionTile.prototype.maxScale=2,CollisionTile.prototype.placeCollisionFeature=function(collisionFeature,allowOverlap,avoidEdges){for(var collisionBoxArray=this.collisionBoxArray,minPlacementScale=this.minScale,rotationMatrix=this.rotationMatrix,yStretch=this.yStretch,b=collisionFeature.boxStartIndex;b<collisionFeature.boxEndIndex;b++){var box=collisionBoxArray.get(b),anchorPoint=box.anchorPoint._matMult(rotationMatrix),x=anchorPoint.x,y=anchorPoint.y,x1=x+box.x1,y1=y+box.y1*yStretch,x2=x+box.x2,y2=y+box.y2*yStretch;if(box.bbox0=x1,box.bbox1=y1,box.bbox2=x2,box.bbox3=y2,!allowOverlap)for(var blockingBoxes=this.grid.query(x1,y1,x2,y2),i=0;i<blockingBoxes.length;i++){var blocking=collisionBoxArray.get(blockingBoxes[i]),blockingAnchorPoint=blocking.anchorPoint._matMult(rotationMatrix);if((minPlacementScale=this.getPlacementScale(minPlacementScale,anchorPoint,box,blockingAnchorPoint,blocking))>=this.maxScale)return minPlacementScale}if(avoidEdges){var rotatedCollisionBox;if(this.angle){var reverseRotationMatrix=this.reverseRotationMatrix,tl=new Point(box.x1,box.y1).matMult(reverseRotationMatrix),tr=new Point(box.x2,box.y1).matMult(reverseRotationMatrix),bl=new Point(box.x1,box.y2).matMult(reverseRotationMatrix),br=new Point(box.x2,box.y2).matMult(reverseRotationMatrix);(rotatedCollisionBox=this.tempCollisionBox).anchorPointX=box.anchorPoint.x,rotatedCollisionBox.anchorPointY=box.anchorPoint.y,rotatedCollisionBox.x1=Math.min(tl.x,tr.x,bl.x,br.x),rotatedCollisionBox.y1=Math.min(tl.y,tr.x,bl.x,br.x),rotatedCollisionBox.x2=Math.max(tl.x,tr.x,bl.x,br.x),rotatedCollisionBox.y2=Math.max(tl.y,tr.x,bl.x,br.x),rotatedCollisionBox.maxScale=box.maxScale}else rotatedCollisionBox=box;for(var k=0;k<this.edges.length;k++){var edgeBox=this.edges[k];if((minPlacementScale=this.getPlacementScale(minPlacementScale,box.anchorPoint,rotatedCollisionBox,edgeBox.anchorPoint,edgeBox))>=this.maxScale)return minPlacementScale}}}return minPlacementScale},CollisionTile.prototype.queryRenderedSymbols=function(minX,minY,maxX,maxY,scale){var sourceLayerFeatures={},result=[],collisionBoxArray=this.collisionBoxArray,rotationMatrix=this.rotationMatrix,anchorPoint=new Point(minX,minY)._matMult(rotationMatrix),queryBox=this.tempCollisionBox;queryBox.anchorX=anchorPoint.x,queryBox.anchorY=anchorPoint.y,queryBox.x1=0,queryBox.y1=0,queryBox.x2=maxX-minX,queryBox.y2=maxY-minY,queryBox.maxScale=scale,scale=queryBox.maxScale;for(var searchBox=[anchorPoint.x+queryBox.x1/scale,anchorPoint.y+queryBox.y1/scale*this.yStretch,anchorPoint.x+queryBox.x2/scale,anchorPoint.y+queryBox.y2/scale*this.yStretch],blockingBoxKeys=this.grid.query(searchBox[0],searchBox[1],searchBox[2],searchBox[3]),blockingBoxKeys2=this.ignoredGrid.query(searchBox[0],searchBox[1],searchBox[2],searchBox[3]),k=0;k<blockingBoxKeys2.length;k++)blockingBoxKeys.push(blockingBoxKeys2[k]);for(var i=0;i<blockingBoxKeys.length;i++){var blocking=collisionBoxArray.get(blockingBoxKeys[i]),sourceLayer=blocking.sourceLayerIndex,featureIndex=blocking.featureIndex;if(void 0===sourceLayerFeatures[sourceLayer]&&(sourceLayerFeatures[sourceLayer]={}),!sourceLayerFeatures[sourceLayer][featureIndex]){var blockingAnchorPoint=blocking.anchorPoint.matMult(rotationMatrix);this.getPlacementScale(this.minScale,anchorPoint,queryBox,blockingAnchorPoint,blocking)>=scale&&(sourceLayerFeatures[sourceLayer][featureIndex]=!0,result.push(blockingBoxKeys[i]))}}return result},CollisionTile.prototype.getPlacementScale=function(minPlacementScale,anchorPoint,box,blockingAnchorPoint,blocking){var anchorDiffX=anchorPoint.x-blockingAnchorPoint.x,anchorDiffY=anchorPoint.y-blockingAnchorPoint.y,s1=(blocking.x1-box.x2)/anchorDiffX,s2=(blocking.x2-box.x1)/anchorDiffX,s3=(blocking.y1-box.y2)*this.yStretch/anchorDiffY,s4=(blocking.y2-box.y1)*this.yStretch/anchorDiffY;(isNaN(s1)||isNaN(s2))&&(s1=s2=1),(isNaN(s3)||isNaN(s4))&&(s3=s4=1);var collisionFreeScale=Math.min(Math.max(s1,s2),Math.max(s3,s4)),blockingMaxScale=blocking.maxScale,boxMaxScale=box.maxScale;return collisionFreeScale>blockingMaxScale&&(collisionFreeScale=blockingMaxScale),collisionFreeScale>boxMaxScale&&(collisionFreeScale=boxMaxScale),collisionFreeScale>minPlacementScale&&collisionFreeScale>=blocking.placementScale&&(minPlacementScale=collisionFreeScale),minPlacementScale},CollisionTile.prototype.insertCollisionFeature=function(collisionFeature,minPlacementScale,ignorePlacement){for(var grid=ignorePlacement?this.ignoredGrid:this.grid,collisionBoxArray=this.collisionBoxArray,k=collisionFeature.boxStartIndex;k<collisionFeature.boxEndIndex;k++){var box=collisionBoxArray.get(k);box.placementScale=minPlacementScale,minPlacementScale<this.maxScale&&grid.insert(k,box.bbox0,box.bbox1,box.bbox2,box.bbox3)}}},{"../data/bucket":24,"grid-index":17,"point-geometry":65}],46:[function(require,module,exports){"use strict";function getAnchors(line,spacing,maxAngle,shapedText,shapedIcon,glyphSize,boxScale,overscaling,tileExtent){var angleWindowSize=shapedText?.6*glyphSize*boxScale:0,labelLength=Math.max(shapedText?shapedText.right-shapedText.left:0,shapedIcon?shapedIcon.right-shapedIcon.left:0),isLineContinued=0===line[0].x||line[0].x===tileExtent||0===line[0].y||line[0].y===tileExtent;spacing-labelLength*boxScale<spacing/4&&(spacing=labelLength*boxScale+spacing/4);var fixedExtraOffset=2*glyphSize;return resample(line,isLineContinued?spacing/2*overscaling%spacing:(labelLength/2+fixedExtraOffset)*boxScale*overscaling%spacing,spacing,angleWindowSize,maxAngle,labelLength*boxScale,isLineContinued,!1,tileExtent)}function resample(line,offset,spacing,angleWindowSize,maxAngle,labelLength,isLineContinued,placeAtMiddle,tileExtent){for(var halfLabelLength=labelLength/2,lineLength=0,k=0;k<line.length-1;k++)lineLength+=line[k].dist(line[k+1]);for(var distance=0,markedDistance=offset-spacing,anchors=[],i=0;i<line.length-1;i++){for(var a=line[i],b=line[i+1],segmentDist=a.dist(b),angle=b.angleTo(a);markedDistance+spacing<distance+segmentDist;){var t=((markedDistance+=spacing)-distance)/segmentDist,x=interpolate(a.x,b.x,t),y=interpolate(a.y,b.y,t);if(x>=0&&x<tileExtent&&y>=0&&y<tileExtent&&markedDistance-halfLabelLength>=0&&markedDistance+halfLabelLength<=lineLength){var anchor=new Anchor(x,y,angle,i)._round();angleWindowSize&&!checkMaxAngle(line,anchor,labelLength,angleWindowSize,maxAngle)||anchors.push(anchor)}}distance+=segmentDist}return placeAtMiddle||anchors.length||isLineContinued||(anchors=resample(line,distance/2,spacing,angleWindowSize,maxAngle,labelLength,isLineContinued,!0,tileExtent)),anchors}var interpolate=require("../util/interpolate"),Anchor=require("../symbol/anchor"),checkMaxAngle=require("./check_max_angle");module.exports=getAnchors},{"../symbol/anchor":40,"../util/interpolate":57,"./check_max_angle":41}],47:[function(require,module,exports){"use strict";module.exports=function(features,textFeatures,geometries){function add(k){mergedFeatures.push(features[k]),mergedGeom.push(geometries[k]),mergedTexts.push(textFeatures[k]),mergedIndex++}function mergeFromRight(leftKey,rightKey,geom){var i=rightIndex[leftKey];return delete rightIndex[leftKey],rightIndex[rightKey]=i,mergedGeom[i][0].pop(),mergedGeom[i][0]=mergedGeom[i][0].concat(geom[0]),i}function mergeFromLeft(leftKey,rightKey,geom){var i=leftIndex[rightKey];return delete leftIndex[rightKey],leftIndex[leftKey]=i,mergedGeom[i][0].shift(),mergedGeom[i][0]=geom[0].concat(mergedGeom[i][0]),i}function getKey(text,geom,onRight){var point=onRight?geom[0][geom[0].length-1]:geom[0][0];return text+":"+point.x+":"+point.y}var k,leftIndex={},rightIndex={},mergedFeatures=[],mergedGeom=[],mergedTexts=[],mergedIndex=0;for(k=0;k<features.length;k++){var geom=geometries[k],text=textFeatures[k];if(text){var leftKey=getKey(text,geom),rightKey=getKey(text,geom,!0);if(leftKey in rightIndex&&rightKey in leftIndex&&rightIndex[leftKey]!==leftIndex[rightKey]){var j=mergeFromLeft(leftKey,rightKey,geom),i=mergeFromRight(leftKey,rightKey,mergedGeom[j]);delete leftIndex[leftKey],delete rightIndex[rightKey],rightIndex[getKey(text,mergedGeom[i],!0)]=i,mergedGeom[j]=null}else leftKey in rightIndex?mergeFromRight(leftKey,rightKey,geom):rightKey in leftIndex?mergeFromLeft(leftKey,rightKey,geom):(add(k),leftIndex[leftKey]=mergedIndex-1,rightIndex[rightKey]=mergedIndex-1)}else add(k)}return{features:mergedFeatures,textFeatures:mergedTexts,geometries:mergedGeom}}},{}],48:[function(require,module,exports){"use strict";function SymbolQuad(anchorPoint,tl,tr,bl,br,tex,anchorAngle,glyphAngle,minScale,maxScale){this.anchorPoint=anchorPoint,this.tl=tl,this.tr=tr,this.bl=bl,this.br=br,this.tex=tex,this.anchorAngle=anchorAngle,this.glyphAngle=glyphAngle,this.minScale=minScale,this.maxScale=maxScale}function getIconQuads(anchor,shapedIcon,boxScale,line,layer,alongLine,shapedText,globalProperties,featureProperties){var tl,tr,br,bl,rect=shapedIcon.image.rect,layout=layer.layout,left=shapedIcon.left-1,right=left+rect.w/shapedIcon.image.pixelRatio,top=shapedIcon.top-1,bottom=top+rect.h/shapedIcon.image.pixelRatio;if("none"!==layout["icon-text-fit"]&&shapedText){var iconWidth=right-left,iconHeight=bottom-top,size=layout["text-size"]/24,textLeft=shapedText.left*size,textRight=shapedText.right*size,textTop=shapedText.top*size,textWidth=textRight-textLeft,textHeight=shapedText.bottom*size-textTop,padT=layout["icon-text-fit-padding"][0],padR=layout["icon-text-fit-padding"][1],padB=layout["icon-text-fit-padding"][2],padL=layout["icon-text-fit-padding"][3],offsetY="width"===layout["icon-text-fit"]?.5*(textHeight-iconHeight):0,offsetX="height"===layout["icon-text-fit"]?.5*(textWidth-iconWidth):0,width="width"===layout["icon-text-fit"]||"both"===layout["icon-text-fit"]?textWidth:iconWidth,height="height"===layout["icon-text-fit"]||"both"===layout["icon-text-fit"]?textHeight:iconHeight;tl=new Point(textLeft+offsetX-padL,textTop+offsetY-padT),tr=new Point(textLeft+offsetX+padR+width,textTop+offsetY-padT),br=new Point(textLeft+offsetX+padR+width,textTop+offsetY+padB+height),bl=new Point(textLeft+offsetX-padL,textTop+offsetY+padB+height)}else tl=new Point(left,top),tr=new Point(right,top),br=new Point(right,bottom),bl=new Point(left,bottom);var angle=layer.getLayoutValue("icon-rotate",globalProperties,featureProperties)*Math.PI/180;if(alongLine){var prev=line[anchor.segment];if(anchor.y===prev.y&&anchor.x===prev.x&&anchor.segment+1<line.length){var next=line[anchor.segment+1];angle+=Math.atan2(anchor.y-next.y,anchor.x-next.x)+Math.PI}else angle+=Math.atan2(anchor.y-prev.y,anchor.x-prev.x)}if(angle){var sin=Math.sin(angle),cos=Math.cos(angle),matrix=[cos,-sin,sin,cos];tl=tl.matMult(matrix),tr=tr.matMult(matrix),bl=bl.matMult(matrix),br=br.matMult(matrix)}return[new SymbolQuad(new Point(anchor.x,anchor.y),tl,tr,bl,br,shapedIcon.image.rect,0,0,minScale,1/0)]}function getGlyphQuads(anchor,shaping,boxScale,line,layer,alongLine){for(var textRotate=layer.layout["text-rotate"]*Math.PI/180,keepUpright=layer.layout["text-keep-upright"],positionedGlyphs=shaping.positionedGlyphs,quads=[],k=0;k<positionedGlyphs.length;k++){var positionedGlyph=positionedGlyphs[k],glyph=positionedGlyph.glyph,rect=glyph.rect;if(rect){var glyphInstances,centerX=(positionedGlyph.x+glyph.advance/2)*boxScale,labelMinScale=minScale;alongLine?(labelMinScale=getSegmentGlyphs(glyphInstances=[],anchor,centerX,line,anchor.segment,!0),keepUpright&&(labelMinScale=Math.min(labelMinScale,getSegmentGlyphs(glyphInstances,anchor,centerX,line,anchor.segment,!1)))):glyphInstances=[{anchorPoint:new Point(anchor.x,anchor.y),offset:0,angle:0,maxScale:1/0,minScale:minScale}];for(var x1=positionedGlyph.x+glyph.left,y1=positionedGlyph.y-glyph.top,x2=x1+rect.w,y2=y1+rect.h,otl=new Point(x1,y1),otr=new Point(x2,y1),obl=new Point(x1,y2),obr=new Point(x2,y2),i=0;i<glyphInstances.length;i++){var instance=glyphInstances[i],tl=otl,tr=otr,bl=obl,br=obr;if(textRotate){var sin=Math.sin(textRotate),cos=Math.cos(textRotate),matrix=[cos,-sin,sin,cos];tl=tl.matMult(matrix),tr=tr.matMult(matrix),bl=bl.matMult(matrix),br=br.matMult(matrix)}var glyphMinScale=Math.max(instance.minScale,labelMinScale),anchorAngle=(anchor.angle+instance.offset+2*Math.PI)%(2*Math.PI),glyphAngle=(instance.angle+instance.offset+2*Math.PI)%(2*Math.PI);quads.push(new SymbolQuad(instance.anchorPoint,tl,tr,bl,br,rect,anchorAngle,glyphAngle,glyphMinScale,instance.maxScale))}}}return quads}function getSegmentGlyphs(glyphs,anchor,offset,line,segment,forward){var upsideDown=!forward;offset<0&&(forward=!forward),forward&&segment++;var newAnchorPoint=new Point(anchor.x,anchor.y),end=line[segment],prevScale=1/0;offset=Math.abs(offset);for(var placementScale=minScale;;){var distance=newAnchorPoint.dist(end),scale=offset/distance,angle=Math.atan2(end.y-newAnchorPoint.y,end.x-newAnchorPoint.x);if(forward||(angle+=Math.PI),glyphs.push({anchorPoint:newAnchorPoint,offset:upsideDown?Math.PI:0,minScale:scale,maxScale:prevScale,angle:(angle+2*Math.PI)%(2*Math.PI)}),scale<=placementScale)break;for(newAnchorPoint=end;newAnchorPoint.equals(end);)if(segment+=forward?1:-1,!(end=line[segment]))return scale;var unit=end.sub(newAnchorPoint)._unit();newAnchorPoint=newAnchorPoint.sub(unit._mult(distance)),prevScale=scale}return placementScale}var Point=require("point-geometry");module.exports={getIconQuads:getIconQuads,getGlyphQuads:getGlyphQuads,SymbolQuad:SymbolQuad};var minScale=.5},{"point-geometry":65}],49:[function(require,module,exports){"use strict";function resolveText(features,layoutProperties,codepoints){for(var textFeatures=[],i=0,fl=features.length;i<fl;i++){var text=resolveTokens(features[i].properties,layoutProperties["text-field"]);if(text){text=text.toString();var transform=layoutProperties["text-transform"];"uppercase"===transform?text=text.toLocaleUpperCase():"lowercase"===transform&&(text=text.toLocaleLowerCase());for(var j=0;j<text.length;j++)codepoints[text.charCodeAt(j)]=!0;textFeatures[i]=text}else textFeatures[i]=null}return textFeatures}var resolveTokens=require("../util/token");module.exports=resolveText},{"../util/token":60}],50:[function(require,module,exports){"use strict";function PositionedGlyph(codePoint,x,y,glyph){this.codePoint=codePoint,this.x=x,this.y=y,this.glyph=glyph}function Shaping(positionedGlyphs,text,top,bottom,left,right){this.positionedGlyphs=positionedGlyphs,this.text=text,this.top=top,this.bottom=bottom,this.left=left,this.right=right}function shapeText(text,glyphs,maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,translate){for(var positionedGlyphs=[],shaping=new Shaping(positionedGlyphs,text,translate[1],translate[1],translate[0],translate[0]),x=0,i=0;i<text.length;i++){var codePoint=text.charCodeAt(i),glyph=glyphs[codePoint];glyph&&(positionedGlyphs.push(new PositionedGlyph(codePoint,x,-17,glyph)),x+=glyph.advance+spacing)}return!!positionedGlyphs.length&&(linewrap(shaping,glyphs,lineHeight,maxWidth,horizontalAlign,verticalAlign,justify,translate),shaping)}function linewrap(shaping,glyphs,lineHeight,maxWidth,horizontalAlign,verticalAlign,justify,translate){var lastSafeBreak=null,lengthBeforeCurrentLine=0,lineStartIndex=0,line=0,maxLineLength=0,positionedGlyphs=shaping.positionedGlyphs;if(maxWidth)for(var i=0;i<positionedGlyphs.length;i++){var positionedGlyph=positionedGlyphs[i];if(positionedGlyph.x-=lengthBeforeCurrentLine,positionedGlyph.y+=lineHeight*line,positionedGlyph.x>maxWidth&&null!==lastSafeBreak){var lineLength=positionedGlyphs[lastSafeBreak+1].x;maxLineLength=Math.max(lineLength,maxLineLength);for(var k=lastSafeBreak+1;k<=i;k++)positionedGlyphs[k].y+=lineHeight,positionedGlyphs[k].x-=lineLength;if(justify){var lineEnd=lastSafeBreak;invisible[positionedGlyphs[lastSafeBreak].codePoint]&&lineEnd--,justifyLine(positionedGlyphs,glyphs,lineStartIndex,lineEnd,justify)}lineStartIndex=lastSafeBreak+1,lastSafeBreak=null,lengthBeforeCurrentLine+=lineLength,line++}breakable[positionedGlyph.codePoint]&&(lastSafeBreak=i)}var lastPositionedGlyph=positionedGlyphs[positionedGlyphs.length-1],lastLineLength=lastPositionedGlyph.x+glyphs[lastPositionedGlyph.codePoint].advance;maxLineLength=Math.max(maxLineLength,lastLineLength);var height=(line+1)*lineHeight;justifyLine(positionedGlyphs,glyphs,lineStartIndex,positionedGlyphs.length-1,justify),align(positionedGlyphs,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,line,translate),shaping.top+=-verticalAlign*height,shaping.bottom=shaping.top+height,shaping.left+=-horizontalAlign*maxLineLength,shaping.right=shaping.left+maxLineLength}function justifyLine(positionedGlyphs,glyphs,start,end,justify){for(var lastAdvance=glyphs[positionedGlyphs[end].codePoint].advance,lineIndent=(positionedGlyphs[end].x+lastAdvance)*justify,j=start;j<=end;j++)positionedGlyphs[j].x-=lineIndent}function align(positionedGlyphs,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,line,translate){for(var shiftX=(justify-horizontalAlign)*maxLineLength+translate[0],shiftY=(-verticalAlign*(line+1)+.5)*lineHeight+translate[1],j=0;j<positionedGlyphs.length;j++)positionedGlyphs[j].x+=shiftX,positionedGlyphs[j].y+=shiftY}function shapeIcon(image,layout){if(!image||!image.rect)return null;var dx=layout["icon-offset"][0],dy=layout["icon-offset"][1],x1=dx-image.width/2,x2=x1+image.width,y1=dy-image.height/2;return new PositionedIcon(image,y1,y1+image.height,x1,x2)}function PositionedIcon(image,top,bottom,left,right){this.image=image,this.top=top,this.bottom=bottom,this.left=left,this.right=right}module.exports={shapeText:shapeText,shapeIcon:shapeIcon};var invisible={32:!0,8203:!0},breakable={32:!0,38:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0}},{}],51:[function(require,module,exports){"use strict";var StructArrayType=require("../util/struct_array"),util=require("../util/util"),Point=require("point-geometry"),SymbolInstancesArray=module.exports=new StructArrayType({members:[{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"glyphQuadStartIndex"},{type:"Uint16",name:"glyphQuadEndIndex"},{type:"Uint16",name:"iconQuadStartIndex"},{type:"Uint16",name:"iconQuadEndIndex"},{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int8",name:"index"}]});util.extendAll(SymbolInstancesArray.prototype.StructType.prototype,{get anchorPoint(){return new Point(this.anchorPointX,this.anchorPointY)}})},{"../util/struct_array":59,"../util/util":61,"point-geometry":65}],52:[function(require,module,exports){"use strict";var StructArrayType=require("../util/struct_array"),util=require("../util/util"),Point=require("point-geometry"),SymbolQuad=require("./quads").SymbolQuad,SymbolQuadsArray=module.exports=new StructArrayType({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"tlX"},{type:"Float32",name:"tlY"},{type:"Float32",name:"trX"},{type:"Float32",name:"trY"},{type:"Float32",name:"blX"},{type:"Float32",name:"blY"},{type:"Float32",name:"brX"},{type:"Float32",name:"brY"},{type:"Int16",name:"texH"},{type:"Int16",name:"texW"},{type:"Int16",name:"texX"},{type:"Int16",name:"texY"},{type:"Float32",name:"anchorAngle"},{type:"Float32",name:"glyphAngle"},{type:"Float32",name:"maxScale"},{type:"Float32",name:"minScale"}]});util.extendAll(SymbolQuadsArray.prototype.StructType.prototype,{get anchorPoint(){return new Point(this.anchorPointX,this.anchorPointY)},get SymbolQuad(){return new SymbolQuad(this.anchorPoint,new Point(this.tlX,this.tlY),new Point(this.trX,this.trY),new Point(this.blX,this.blY),new Point(this.brX,this.brY),{x:this.texX,y:this.texY,h:this.texH,w:this.texW,height:this.texH,width:this.texW},this.anchorAngle,this.glyphAngle,this.minScale,this.maxScale)}})},{"../util/struct_array":59,"../util/util":61,"./quads":48,"point-geometry":65}],53:[function(require,module,exports){"use strict";function sameOrigin(url){var a=document.createElement("a");return a.href=url,a.protocol===document.location.protocol&&a.host===document.location.host}exports.getJSON=function(url,callback){var xhr=new XMLHttpRequest;return xhr.open("GET",url,!0),xhr.setRequestHeader("Accept","application/json"),xhr.onerror=function(e){callback(e)},xhr.onload=function(){if(xhr.status>=200&&xhr.status<300&&xhr.response){var data;try{data=JSON.parse(xhr.response)}catch(err){return callback(err)}callback(null,data)}else callback(new Error(xhr.statusText))},xhr.send(),xhr},exports.getArrayBuffer=function(url,callback){var xhr=new XMLHttpRequest;return xhr.open("GET",url,!0),xhr.responseType="arraybuffer",xhr.onerror=function(e){callback(e)},xhr.onload=function(){xhr.status>=200&&xhr.status<300&&xhr.response?callback(null,xhr.response):callback(new Error(xhr.statusText))},xhr.send(),xhr},exports.getImage=function(url,callback){return exports.getArrayBuffer(url,function(err,imgData){if(err)return callback(err);var img=new Image;img.onload=function(){callback(null,img),(window.URL||window.webkitURL).revokeObjectURL(img.src)};var blob=new Blob([new Uint8Array(imgData)],{type:"image/png"});return img.src=(window.URL||window.webkitURL).createObjectURL(blob),img.getData=function(){var canvas=document.createElement("canvas"),context=canvas.getContext("2d");return canvas.width=img.width,canvas.height=img.height,context.drawImage(img,0,0),context.getImageData(0,0,img.width,img.height).data},img})},exports.getVideo=function(urls,callback){var video=document.createElement("video");video.onloadstart=function(){callback(null,video)};for(var i=0;i<urls.length;i++){var s=document.createElement("source");sameOrigin(urls[i])||(video.crossOrigin="Anonymous"),s.src=urls[i],video.appendChild(s)}return video.getData=function(){return video},video}},{}],54:[function(require,module,exports){"use strict";function compareAreas(a,b){return b.area-a.area}function calculateSignedArea(ring){for(var p1,p2,sum=0,i=0,len=ring.length,j=len-1;i<len;j=i++)p1=ring[i],sum+=((p2=ring[j]).x-p1.x)*(p1.y+p2.y);return sum}var quickselect=require("quickselect");module.exports=function(rings,maxRings){var len=rings.length;if(len<=1)return[rings];for(var polygon,ccw,polygons=[],i=0;i<len;i++){var area=calculateSignedArea(rings[i]);0!==area&&(rings[i].area=Math.abs(area),void 0===ccw&&(ccw=area<0),ccw===area<0?(polygon&&polygons.push(polygon),polygon=[rings[i]]):polygon.push(rings[i]))}if(polygon&&polygons.push(polygon),maxRings>1)for(var j=0;j<polygons.length;j++)polygons[j].length<=maxRings||(quickselect(polygons[j],maxRings,1,polygons[j].length-1,compareAreas),polygons[j]=polygons[j].slice(0,maxRings));return polygons}},{quickselect:66}],55:[function(require,module,exports){"use strict";function DictionaryCoder(strings){this._stringToNumber={},this._numberToString=[];for(var i=0;i<strings.length;i++){var string=strings[i];this._stringToNumber[string]=i,this._numberToString[i]=string}}var assert=require("assert");module.exports=DictionaryCoder,DictionaryCoder.prototype.encode=function(string){return assert(string in this._stringToNumber),this._stringToNumber[string]},DictionaryCoder.prototype.decode=function(n){return assert(n<this._numberToString.length),this._numberToString[n]}},{assert:80}],56:[function(require,module,exports){"use strict";var util=require("./util"),Evented={on:function(type,listener){return this._events=this._events||{},this._events[type]=this._events[type]||[],this._events[type].push(listener),this},off:function(type,listener){if(!type)return delete this._events,this;if(!this.listens(type))return this;if(listener){var idx=this._events[type].indexOf(listener);idx>=0&&this._events[type].splice(idx,1),this._events[type].length||delete this._events[type]}else delete this._events[type];return this},once:function(type,listener){var wrapper=function(data){this.off(type,wrapper),listener.call(this,data)}.bind(this);return this.on(type,wrapper),this},fire:function(type,data){if(!this.listens(type))return util.endsWith(type,"error")&&console.error(data&&data.error||data||"Empty error event"),this;data=util.extend({},data),util.extend(data,{type:type,target:this});for(var listeners=this._events[type].slice(),i=0;i<listeners.length;i++)listeners[i].call(this,data);return this},listens:function(type){return!(!this._events||!this._events[type])}};module.exports=Evented},{"./util":61}],57:[function(require,module,exports){"use strict";function interpolate(a,b,t){return a*(1-t)+b*t}module.exports=interpolate,interpolate.number=interpolate,interpolate.vec2=function(from,to,t){return[interpolate(from[0],to[0],t),interpolate(from[1],to[1],t)]},interpolate.color=function(from,to,t){return[interpolate(from[0],to[0],t),interpolate(from[1],to[1],t),interpolate(from[2],to[2],t),interpolate(from[3],to[3],t)]},interpolate.array=function(from,to,t){return from.map(function(d,i){return interpolate(d,to[i],t)})}},{}],58:[function(require,module,exports){"use strict";function multiPolygonIntersectsBufferedMultiPoint(multiPolygon,rings,radius){for(var j=0;j<multiPolygon.length;j++)for(var polygon=multiPolygon[j],i=0;i<rings.length;i++)for(var ring=rings[i],k=0;k<ring.length;k++){var point=ring[k];if(polygonContainsPoint(polygon,point))return!0;if(pointIntersectsBufferedLine(point,polygon,radius))return!0}return!1}function multiPolygonIntersectsMultiPolygon(multiPolygonA,multiPolygonB){if(1===multiPolygonA.length&&1===multiPolygonA[0].length)return multiPolygonContainsPoint(multiPolygonB,multiPolygonA[0][0]);for(var m=0;m<multiPolygonB.length;m++)for(var ring=multiPolygonB[m],n=0;n<ring.length;n++)if(multiPolygonContainsPoint(multiPolygonA,ring[n]))return!0;for(var j=0;j<multiPolygonA.length;j++){for(var polygon=multiPolygonA[j],i=0;i<polygon.length;i++)if(multiPolygonContainsPoint(multiPolygonB,polygon[i]))return!0;for(var k=0;k<multiPolygonB.length;k++)if(lineIntersectsLine(polygon,multiPolygonB[k]))return!0}return!1}function multiPolygonIntersectsBufferedMultiLine(multiPolygon,multiLine,radius){for(var i=0;i<multiLine.length;i++)for(var line=multiLine[i],j=0;j<multiPolygon.length;j++){var polygon=multiPolygon[j];if(polygon.length>=3)for(var k=0;k<line.length;k++)if(polygonContainsPoint(polygon,line[k]))return!0;if(lineIntersectsBufferedLine(polygon,line,radius))return!0}return!1}function lineIntersectsBufferedLine(lineA,lineB,radius){if(lineA.length>1){if(lineIntersectsLine(lineA,lineB))return!0;for(var j=0;j<lineB.length;j++)if(pointIntersectsBufferedLine(lineB[j],lineA,radius))return!0}for(var k=0;k<lineA.length;k++)if(pointIntersectsBufferedLine(lineA[k],lineB,radius))return!0;return!1}function lineIntersectsLine(lineA,lineB){for(var i=0;i<lineA.length-1;i++)for(var a0=lineA[i],a1=lineA[i+1],j=0;j<lineB.length-1;j++)if(lineSegmentIntersectsLineSegment(a0,a1,lineB[j],lineB[j+1]))return!0;return!1}function isCounterClockwise(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)}function lineSegmentIntersectsLineSegment(a0,a1,b0,b1){return isCounterClockwise(a0,b0,b1)!==isCounterClockwise(a1,b0,b1)&&isCounterClockwise(a0,a1,b0)!==isCounterClockwise(a0,a1,b1)}function pointIntersectsBufferedLine(p,line,radius){var radiusSquared=radius*radius;if(1===line.length)return p.distSqr(line[0])<radiusSquared;for(var i=1;i<line.length;i++)if(distToSegmentSquared(p,line[i-1],line[i])<radiusSquared)return!0;return!1}function distToSegmentSquared(p,v,w){var l2=v.distSqr(w);if(0===l2)return p.distSqr(v);var t=((p.x-v.x)*(w.x-v.x)+(p.y-v.y)*(w.y-v.y))/l2;return t<0?p.distSqr(v):t>1?p.distSqr(w):p.distSqr(w.sub(v)._mult(t)._add(v))}function multiPolygonContainsPoint(rings,p){for(var ring,p1,p2,c=!1,k=0;k<rings.length;k++)for(var i=0,j=(ring=rings[k]).length-1;i<ring.length;j=i++)p1=ring[i],p2=ring[j],p1.y>p.y!=p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x&&(c=!c);return c}function polygonContainsPoint(ring,p){for(var c=!1,i=0,j=ring.length-1;i<ring.length;j=i++){var p1=ring[i],p2=ring[j];p1.y>p.y!=p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x&&(c=!c)}return c}module.exports={multiPolygonIntersectsBufferedMultiPoint:multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon:multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine:multiPolygonIntersectsBufferedMultiLine}},{}],59:[function(require,module,exports){"use strict";function StructArrayType(options){function StructType(){Struct.apply(this,arguments)}function StructArrayType(){StructArray.apply(this,arguments),this.members=StructType.prototype.members}var key=JSON.stringify(options);if(structArrayTypeCache[key])return structArrayTypeCache[key];void 0===options.alignment&&(options.alignment=1),StructType.prototype=Object.create(Struct.prototype);var offset=0,maxSize=0,usedTypes=["Uint8"];return StructType.prototype.members=options.members.map(function(member){member={name:member.name,type:member.type,components:member.components||1},assert(member.name.length),assert(member.type in viewTypes),usedTypes.indexOf(member.type)<0&&usedTypes.push(member.type);var typeSize=sizeOf(member.type);maxSize=Math.max(maxSize,typeSize),member.offset=offset=align(offset,Math.max(options.alignment,typeSize));for(var c=0;c<member.components;c++)Object.defineProperty(StructType.prototype,member.name+(1===member.components?"":c),{get:createGetter(member,c),set:createSetter(member,c)});return offset+=typeSize*member.components,member}),StructType.prototype.alignment=options.alignment,StructType.prototype.size=align(offset,Math.max(maxSize,options.alignment)),StructArrayType.serialize=serializeStructArrayType,StructArrayType.prototype=Object.create(StructArray.prototype),StructArrayType.prototype.StructType=StructType,StructArrayType.prototype.bytesPerElement=StructType.prototype.size,StructArrayType.prototype.emplaceBack=createEmplaceBack(StructType.prototype.members,StructType.prototype.size),StructArrayType.prototype._usedTypes=usedTypes,structArrayTypeCache[key]=StructArrayType,StructArrayType}function serializeStructArrayType(){return{members:this.prototype.StructType.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}}function align(offset,size){return Math.ceil(offset/size)*size}function sizeOf(type){return viewTypes[type].BYTES_PER_ELEMENT}function getArrayViewName(type){return type.toLowerCase()}function createEmplaceBack(members,bytesPerElement){for(var usedTypeSizes=[],argNames=[],body="var i = this.length;\nthis.resize(this.length + 1);\n",m=0;m<members.length;m++){var member=members[m],size=sizeOf(member.type);usedTypeSizes.indexOf(size)<0&&(usedTypeSizes.push(size),body+="var o"+size.toFixed(0)+" = i * "+(bytesPerElement/size).toFixed(0)+";\n");for(var c=0;c<member.components;c++){var argName="v"+argNames.length,index="o"+size.toFixed(0)+" + "+(member.offset/size+c).toFixed(0);body+="this."+getArrayViewName(member.type)+"["+index+"] = "+argName+";\n",argNames.push(argName)}}return body+="return i;",new Function(argNames,body)}function createMemberComponentString(member,component){var index="this._pos"+sizeOf(member.type).toFixed(0)+" + "+(member.offset/sizeOf(member.type)+component).toFixed(0);return"this._structArray."+getArrayViewName(member.type)+"["+index+"]"}function createGetter(member,c){return new Function([],"return "+createMemberComponentString(member,c)+";")}function createSetter(member,c){return new Function(["x"],createMemberComponentString(member,c)+" = x;")}function Struct(structArray,index){this._structArray=structArray,this._pos1=index*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}function StructArray(serialized){void 0!==serialized?(this.arrayBuffer=serialized.arrayBuffer,this.length=serialized.length,this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement,this._refreshViews()):(this.capacity=-1,this.resize(0))}var assert=require("assert");module.exports=StructArrayType;var viewTypes={Int8:Int8Array,Uint8:Uint8Array,Uint8Clamped:Uint8ClampedArray,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array,Float64:Float64Array},structArrayTypeCache={};StructArray.prototype.DEFAULT_CAPACITY=128,StructArray.prototype.RESIZE_MULTIPLIER=5,StructArray.prototype.serialize=function(){return this.trim(),{length:this.length,arrayBuffer:this.arrayBuffer}},StructArray.prototype.get=function(index){return new this.StructType(this,index)},StructArray.prototype.trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},StructArray.prototype.resize=function(n){if(this.length=n,n>this.capacity){this.capacity=Math.max(n,Math.floor(this.capacity*this.RESIZE_MULTIPLIER),this.DEFAULT_CAPACITY),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var oldUint8Array=this.uint8;this._refreshViews(),oldUint8Array&&this.uint8.set(oldUint8Array)}},StructArray.prototype._refreshViews=function(){for(var t=0;t<this._usedTypes.length;t++){var type=this._usedTypes[t];this[getArrayViewName(type)]=new viewTypes[type](this.arrayBuffer)}},StructArray.prototype.toArray=function(startIndex,endIndex){for(var array=[],i=startIndex;i<endIndex;i++){var struct=this.get(i);array.push(struct)}return array}},{assert:80}],60:[function(require,module,exports){"use strict";function resolveTokens(properties,text){return text.replace(/{([^{}]+)}/g,function(match,key){return key in properties?properties[key]:""})}module.exports=resolveTokens},{}],61:[function(require,module,exports){"use strict";var UnitBezier=require("unitbezier"),Coordinate=require("../geo/coordinate");exports.easeCubicInOut=function(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)},exports.bezier=function(p1x,p1y,p2x,p2y){var bezier=new UnitBezier(p1x,p1y,p2x,p2y);return function(t){return bezier.solve(t)}},exports.ease=exports.bezier(.25,.1,.25,1),exports.clamp=function(n,min,max){return Math.min(max,Math.max(min,n))},exports.wrap=function(n,min,max){var d=max-min,w=((n-min)%d+d)%d+min;return w===min?max:w},exports.coalesce=function(){for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(null!==arg&&void 0!==arg)return arg}},exports.asyncAll=function(array,fn,callback){if(!array.length)return callback(null,[]);var remaining=array.length,results=new Array(array.length),error=null;array.forEach(function(item,i){fn(item,function(err,result){err&&(error=err),results[i]=result,0==--remaining&&callback(error,results)})})},exports.keysDifference=function(obj,other){var difference=[];for(var i in obj)i in other||difference.push(i);return difference},exports.extend=function(dest){for(var i=1;i<arguments.length;i++){var src=arguments[i];for(var k in src)dest[k]=src[k]}return dest},exports.extendAll=function(dest,src){for(var i in src)Object.defineProperty(dest,i,Object.getOwnPropertyDescriptor(src,i));return dest},exports.inherit=function(parent,props){var parentProto="function"==typeof parent?parent.prototype:parent,proto=Object.create(parentProto);return exports.extendAll(proto,props),proto},exports.pick=function(src,properties){for(var result={},i=0;i<properties.length;i++){var k=properties[i];k in src&&(result[k]=src[k])}return result};var id=1;exports.uniqueId=function(){return id++},exports.debounce=function(fn,time){var timer,args;return function(){args=arguments,clearTimeout(timer),timer=setTimeout(function(){fn.apply(null,args)},time)}},exports.bindAll=function(fns,context){fns.forEach(function(fn){context[fn]&&(context[fn]=context[fn].bind(context))})},exports.bindHandlers=function(context){for(var i in context)"function"==typeof context[i]&&0===i.indexOf("_on")&&(context[i]=context[i].bind(context))},exports.setOptions=function(obj,options){obj.hasOwnProperty("options")||(obj.options=obj.options?Object.create(obj.options):{});for(var i in options)obj.options[i]=options[i];return obj.options},exports.getCoordinatesCenter=function(coords){for(var minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0,i=0;i<coords.length;i++)minX=Math.min(minX,coords[i].column),minY=Math.min(minY,coords[i].row),maxX=Math.max(maxX,coords[i].column),maxY=Math.max(maxY,coords[i].row);var dx=maxX-minX,dy=maxY-minY,dMax=Math.max(dx,dy);return new Coordinate((minX+maxX)/2,(minY+maxY)/2,0).zoomTo(Math.floor(-Math.log(dMax)/Math.LN2))},exports.endsWith=function(string,suffix){return-1!==string.indexOf(suffix,string.length-suffix.length)},exports.startsWith=function(string,prefix){return 0===string.indexOf(prefix)},exports.mapObject=function(input,iterator,context){var output={};for(var key in input)output[key]=iterator.call(context||this,input[key],key,input);return output},exports.filterObject=function(input,iterator,context){var output={};for(var key in input)iterator.call(context||this,input[key],key,input)&&(output[key]=input[key]);return output},exports.deepEqual=function deepEqual(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!==b.length)return!1;for(var i=0;i<a.length;i++)if(!deepEqual(a[i],b[i]))return!1;return!0}if("object"==typeof a&&null!==a&&null!==b){if("object"!=typeof b)return!1;if(Object.keys(a).length!==Object.keys(b).length)return!1;for(var key in a)if(!deepEqual(a[key],b[key]))return!1;return!0}return a===b},exports.clone=function(input){return Array.isArray(input)?input.map(exports.clone):"object"==typeof input?exports.mapObject(input,exports.clone):input},exports.arraysIntersect=function(a,b){for(var l=0;l<a.length;l++)if(b.indexOf(a[l])>=0)return!0;return!1};var warnOnceHistory={};exports.warnOnce=function(message){warnOnceHistory[message]||("undefined"!=typeof console&&console.warn(message),warnOnceHistory[message]=!0)}},{"../geo/coordinate":33,unitbezier:70}],62:[function(require,module,exports){"use strict";function Feature(vectorTileFeature,z,x,y){this._vectorTileFeature=vectorTileFeature,vectorTileFeature._z=z,vectorTileFeature._x=x,vectorTileFeature._y=y,this.properties=vectorTileFeature.properties,null!=vectorTileFeature.id&&(this.id=vectorTileFeature.id)}module.exports=Feature,Feature.prototype={type:"Feature",get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},set geometry(g){this._geometry=g},toJSON:function(){var json={};for(var i in this)"_geometry"!==i&&"_vectorTileFeature"!==i&&"toJSON"!==i&&(json[i]=this[i]);return json}}},{}],63:[function(require,module,exports){"use strict";function Buffer(length){var arr;length&&length.length&&(length=(arr=length).length);var buf=new Uint8Array(length||0);return arr&&buf.set(arr),buf.readUInt32LE=BufferMethods.readUInt32LE,buf.writeUInt32LE=BufferMethods.writeUInt32LE,buf.readInt32LE=BufferMethods.readInt32LE,buf.writeInt32LE=BufferMethods.writeInt32LE,buf.readFloatLE=BufferMethods.readFloatLE,buf.writeFloatLE=BufferMethods.writeFloatLE,buf.readDoubleLE=BufferMethods.readDoubleLE,buf.writeDoubleLE=BufferMethods.writeDoubleLE,buf.toString=BufferMethods.toString,buf.write=BufferMethods.write,buf.slice=BufferMethods.slice,buf.copy=BufferMethods.copy,buf._isBuffer=!0,buf}function encodeString(str){for(var c,lead,length=str.length,bytes=[],i=0;i<length;i++){if((c=str.charCodeAt(i))>55295&&c<57344){if(!lead){c>56319||i+1===length?bytes.push(239,191,189):lead=c;continue}if(c<56320){bytes.push(239,191,189),lead=c;continue}c=lead-55296<<10|c-56320|65536,lead=null}else lead&&(bytes.push(239,191,189),lead=null);c<128?bytes.push(c):c<2048?bytes.push(c>>6|192,63&c|128):c<65536?bytes.push(c>>12|224,c>>6&63|128,63&c|128):bytes.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}return bytes}module.exports=Buffer;var BufferMethods,lastStr,lastStrEncoded,ieee754=require("ieee754");(BufferMethods={readUInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+16777216*this[pos+3]},writeUInt32LE:function(val,pos){this[pos]=val,this[pos+1]=val>>>8,this[pos+2]=val>>>16,this[pos+3]=val>>>24},readInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+(this[pos+3]<<24)},readFloatLE:function(pos){return ieee754.read(this,pos,!0,23,4)},readDoubleLE:function(pos){return ieee754.read(this,pos,!0,52,8)},writeFloatLE:function(val,pos){return ieee754.write(this,val,pos,!0,23,4)},writeDoubleLE:function(val,pos){return ieee754.write(this,val,pos,!0,52,8)},toString:function(encoding,start,end){var str="",tmp="";start=start||0,end=Math.min(this.length,end||this.length);for(var i=start;i<end;i++){var ch=this[i];ch<=127?(str+=decodeURIComponent(tmp)+String.fromCharCode(ch),tmp=""):tmp+="%"+ch.toString(16)}return str+=decodeURIComponent(tmp)},write:function(str,pos){for(var bytes=str===lastStr?lastStrEncoded:encodeString(str),i=0;i<bytes.length;i++)this[pos+i]=bytes[i]},slice:function(start,end){return this.subarray(start,end)},copy:function(buf,pos){pos=pos||0;for(var i=0;i<this.length;i++)buf[pos+i]=this[i]}}).writeInt32LE=BufferMethods.writeUInt32LE,Buffer.byteLength=function(str){return lastStr=str,(lastStrEncoded=encodeString(str)).length},Buffer.isBuffer=function(buf){return!(!buf||!buf._isBuffer)}},{ieee754:18}],64:[function(require,module,exports){(function(global){"use strict";function Pbf(buf){this.buf=Buffer.isBuffer(buf)?buf:new Buffer(buf||0),this.pos=0,this.length=this.buf.length}function readVarintRemainder(val,pbf){var b,buf=pbf.buf;if(b=buf[pbf.pos++],val+=268435456*(127&b),b<128)return val;if(b=buf[pbf.pos++],val+=34359738368*(127&b),b<128)return val;if(b=buf[pbf.pos++],val+=4398046511104*(127&b),b<128)return val;if(b=buf[pbf.pos++],val+=562949953421312*(127&b),b<128)return val;if(b=buf[pbf.pos++],val+=72057594037927940*(127&b),b<128)return val;if(b=buf[pbf.pos++],val+=0x8000000000000000*(127&b),b<128)return val;throw new Error("Expected varint not more than 10 bytes")}function writeBigVarint(val,pbf){pbf.realloc(10);for(var maxPos=pbf.pos+10;val>=1;){if(pbf.pos>=maxPos)throw new Error("Given varint doesn't fit into 10 bytes");var b=255&val;pbf.buf[pbf.pos++]=b|(val>=128?128:0),val/=128}}function reallocForRawMessage(startPos,len,pbf){var extraLen=len<=16383?1:len<=2097151?2:len<=268435455?3:Math.ceil(Math.log(len)/(7*Math.LN2));pbf.realloc(extraLen);for(var i=pbf.pos-1;i>=startPos;i--)pbf.buf[i+extraLen]=pbf.buf[i]}function writePackedVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeVarint(arr[i])}function writePackedSVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSVarint(arr[i])}function writePackedFloat(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFloat(arr[i])}function writePackedDouble(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeDouble(arr[i])}function writePackedBoolean(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeBoolean(arr[i])}function writePackedFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed32(arr[i])}function writePackedSFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed32(arr[i])}function writePackedFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed64(arr[i])}function writePackedSFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed64(arr[i])}module.exports=Pbf;var Buffer=global.Buffer||require("./buffer");Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var POW_2_63=Math.pow(2,63);Pbf.prototype={destroy:function(){this.buf=null},readFields:function(readField,result,end){for(end=end||this.length;this.pos<end;){var val=this.readVarint(),tag=val>>3,startPos=this.pos;readField(tag,result,this),this.pos===startPos&&this.skip(val)}return result},readMessage:function(readField,result){return this.readFields(readField,result,this.readVarint()+this.pos)},readFixed32:function(){var val=this.buf.readUInt32LE(this.pos);return this.pos+=4,val},readSFixed32:function(){var val=this.buf.readInt32LE(this.pos);return this.pos+=4,val},readFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readUInt32LE(this.pos+4);return this.pos+=8,val},readSFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readInt32LE(this.pos+4);return this.pos+=8,val},readFloat:function(){var val=this.buf.readFloatLE(this.pos);return this.pos+=4,val},readDouble:function(){var val=this.buf.readDoubleLE(this.pos);return this.pos+=8,val},readVarint:function(){var val,b,buf=this.buf;return b=buf[this.pos++],val=127&b,b<128?val:(b=buf[this.pos++],val|=(127&b)<<7,b<128?val:(b=buf[this.pos++],val|=(127&b)<<14,b<128?val:(b=buf[this.pos++],val|=(127&b)<<21,b<128?val:readVarintRemainder(val,this))))},readVarint64:function(){var startPos=this.pos,val=this.readVarint();if(val<POW_2_63)return val;for(var pos=this.pos-2;255===this.buf[pos];)pos--;pos<startPos&&(pos=startPos),val=0;for(var i=0;i<pos-startPos+1;i++){var b=127&~this.buf[startPos+i];val+=i<4?b<<7*i:b*Math.pow(2,7*i)}return-val-1},readSVarint:function(){var num=this.readVarint();return num%2==1?(num+1)/-2:num/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var end=this.readVarint()+this.pos,str=this.buf.toString("utf8",this.pos,end);return this.pos=end,str},readBytes:function(){var end=this.readVarint()+this.pos,buffer=this.buf.slice(this.pos,end);return this.pos=end,buffer},readPackedVarint:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readVarint());return arr},readPackedSVarint:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readSVarint());return arr},readPackedBoolean:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readBoolean());return arr},readPackedFloat:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readFloat());return arr},readPackedDouble:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readDouble());return arr},readPackedFixed32:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readFixed32());return arr},readPackedSFixed32:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readSFixed32());return arr},readPackedFixed64:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readFixed64());return arr},readPackedSFixed64:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readSFixed64());return arr},skip:function(val){var type=7&val;if(type===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(type===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(type===Pbf.Fixed32)this.pos+=4;else{if(type!==Pbf.Fixed64)throw new Error("Unimplemented type: "+type);this.pos+=8}},writeTag:function(tag,type){this.writeVarint(tag<<3|type)},realloc:function(min){for(var length=this.length||16;length<this.pos+min;)length*=2;if(length!==this.length){var buf=new Buffer(length);this.buf.copy(buf),this.buf=buf,this.length=length}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(val){this.realloc(4),this.buf.writeUInt32LE(val,this.pos),this.pos+=4},writeSFixed32:function(val){this.realloc(4),this.buf.writeInt32LE(val,this.pos),this.pos+=4},writeFixed64:function(val){this.realloc(8),this.buf.writeInt32LE(-1&val,this.pos),this.buf.writeUInt32LE(Math.floor(val*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(val){this.realloc(8),this.buf.writeInt32LE(-1&val,this.pos),this.buf.writeInt32LE(Math.floor(val*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(val){(val=+val)>268435455?writeBigVarint(val,this):(this.realloc(4),this.buf[this.pos++]=127&val|(val>127?128:0),val<=127||(this.buf[this.pos++]=127&(val>>>=7)|(val>127?128:0),val<=127||(this.buf[this.pos++]=127&(val>>>=7)|(val>127?128:0),val<=127||(this.buf[this.pos++]=val>>>7&127))))},writeSVarint:function(val){this.writeVarint(val<0?2*-val-1:2*val)},writeBoolean:function(val){this.writeVarint(Boolean(val))},writeString:function(str){str=String(str);var bytes=Buffer.byteLength(str);this.writeVarint(bytes),this.realloc(bytes),this.buf.write(str,this.pos),this.pos+=bytes},writeFloat:function(val){this.realloc(4),this.buf.writeFloatLE(val,this.pos),this.pos+=4},writeDouble:function(val){this.realloc(8),this.buf.writeDoubleLE(val,this.pos),this.pos+=8},writeBytes:function(buffer){var len=buffer.length;this.writeVarint(len),this.realloc(len);for(var i=0;i<len;i++)this.buf[this.pos++]=buffer[i]},writeRawMessage:function(fn,obj){var startPos=++this.pos;fn(obj,this);var len=this.pos-startPos;len>=128&&reallocForRawMessage(startPos,len,this),this.pos=startPos-1,this.writeVarint(len),this.pos+=len},writeMessage:function(tag,fn,obj){this.writeTag(tag,Pbf.Bytes),this.writeRawMessage(fn,obj)},writePackedVarint:function(tag,arr){this.writeMessage(tag,writePackedVarint,arr)},writePackedSVarint:function(tag,arr){this.writeMessage(tag,writePackedSVarint,arr)},writePackedBoolean:function(tag,arr){this.writeMessage(tag,writePackedBoolean,arr)},writePackedFloat:function(tag,arr){this.writeMessage(tag,writePackedFloat,arr)},writePackedDouble:function(tag,arr){this.writeMessage(tag,writePackedDouble,arr)},writePackedFixed32:function(tag,arr){this.writeMessage(tag,writePackedFixed32,arr)},writePackedSFixed32:function(tag,arr){this.writeMessage(tag,writePackedSFixed32,arr)},writePackedFixed64:function(tag,arr){this.writeMessage(tag,writePackedFixed64,arr)},writePackedSFixed64:function(tag,arr){this.writeMessage(tag,writePackedSFixed64,arr)},writeBytesField:function(tag,buffer){this.writeTag(tag,Pbf.Bytes),this.writeBytes(buffer)},writeFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32),this.writeFixed32(val)},writeSFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32),this.writeSFixed32(val)},writeFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64),this.writeFixed64(val)},writeSFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64),this.writeSFixed64(val)},writeVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint),this.writeVarint(val)},writeSVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint),this.writeSVarint(val)},writeStringField:function(tag,str){this.writeTag(tag,Pbf.Bytes),this.writeString(str)},writeFloatField:function(tag,val){this.writeTag(tag,Pbf.Fixed32),this.writeFloat(val)},writeDoubleField:function(tag,val){this.writeTag(tag,Pbf.Fixed64),this.writeDouble(val)},writeBooleanField:function(tag,val){this.writeVarintField(tag,Boolean(val))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":63}],65:[function(require,module,exports){"use strict";function Point(x,y){this.x=x,this.y=y}module.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(a){return this.clone()._rotate(a)},matMult:function(m){return this.clone()._matMult(m)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var dx=p.x-this.x,dy=p.y-this.y;return dx*dx+dy*dy},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(x,y){return Math.atan2(this.x*y-this.y*x,this.x*x+this.y*y)},_matMult:function(m){var x=m[0]*this.x+m[1]*this.y,y=m[2]*this.x+m[3]*this.y;return this.x=x,this.y=y,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(k){return this.x*=k,this.y*=k,this},_div:function(k){return this.x/=k,this.y/=k,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var y=this.y;return this.y=this.x,this.x=-y,this},_rotate:function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),x=cos*this.x-sin*this.y,y=sin*this.x+cos*this.y;return this.x=x,this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(a){return a instanceof Point?a:Array.isArray(a)?new Point(a[0],a[1]):a}},{}],66:[function(require,module,exports){"use strict";function partialSort(arr,k,left,right,compare){for(left=left||0,right=right||arr.length-1,compare=compare||defaultCompare;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);partialSort(arr,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),compare(arr[right],t)>0&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;compare(arr[j],t)>0;)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}module.exports=partialSort},{}],67:[function(require,module,exports){!function(root,factory){"object"==typeof exports?module.exports=factory():root.resolveUrl=factory()}(this,function(){function resolveUrl(){var numUrls=arguments.length;if(0===numUrls)throw new Error("resolveUrl requires at least one argument; got none.");var base=document.createElement("base");if(base.href=arguments[0],1===numUrls)return base.href;var head=document.getElementsByTagName("head")[0];head.insertBefore(base,head.firstChild);for(var resolved,a=document.createElement("a"),index=1;index<numUrls;index++)a.href=arguments[index],resolved=a.href,base.href=resolved;return head.removeChild(base),resolved}return resolveUrl})},{}],68:[function(require,module,exports){function element(x,dims){return search(x,dims).val}function formatPair(x){return format(x.lat,"lat")+" "+format(x.lon,"lon")}function format(x,dim){var dms=coordToDMS(x,dim);return dms.whole+" "+(dms.minutes?dms.minutes+"' ":"")+(dms.seconds?dms.seconds+'" ':"")+dms.dir}function coordToDMS(x,dim){var dir=({lat:["N","S"],lon:["E","W"]}[dim]||"")[x>=0?0:1],abs=Math.abs(x),whole=Math.floor(abs),fractionMinutes=60*(abs-whole),minutes=Math.floor(fractionMinutes);return{whole:whole,minutes:minutes,seconds:Math.floor(60*(fractionMinutes-minutes)),dir:dir}}function search(x,dims,r){if(dims||(dims="NSEW"),"string"!=typeof x)return{val:null,regex:r};var m=(r=r||/[\s\,]*([\-|\|\]?[0-9.]+)? *(?:([0-9.]+)['] *)?(?:([0-9.]+)(?:''|"||) *)?([NSEW])?/gi).exec(x);return m?m[4]&&-1===dims.indexOf(m[4])?{val:null,regex:r}:{val:((m[1]?parseFloat(m[1]):0)+(m[2]?parseFloat(m[2])/60:0)+(m[3]?parseFloat(m[3])/3600:0))*(m[4]&&"S"===m[4]||"W"===m[4]?-1:1),regex:r,raw:m[0],dim:m[4]}:{val:null,regex:r}}function pair(x,dims){var one=search(x=x.trim(),dims);if(null===one.val)return null;var two=search(x,dims,one.regex);return null===two.val?null:one.raw+two.raw!==x?null:one.dim?swapdim(one.val,two.val,one.dim):[one.val,two.val]}function swapdim(a,b,dim){return"N"===dim||"S"===dim?[a,b]:"W"===dim||"E"===dim?[b,a]:void 0}module.exports=element,module.exports.pair=pair,module.exports.format=format,module.exports.formatPair=formatPair,module.exports.coordToDMS=coordToDMS},{}],69:[function(require,module,exports){"use strict";function supercluster(options){return new SuperCluster(options)}function SuperCluster(options){this.options=extend(Object.create(this.options),options),this.trees=new Array(this.options.maxZoom+1)}function createCluster(x,y,numPoints,id,properties){return{x:x,y:y,zoom:1/0,id:id,properties:properties,parentId:-1,numPoints:numPoints}}function createPointCluster(p,id){var coords=p.geometry.coordinates;return{x:lngX(coords[0]),y:latY(coords[1]),zoom:1/0,id:id,parentId:-1}}function getClusterJSON(cluster){return{type:"Feature",properties:getClusterProperties(cluster),geometry:{type:"Point",coordinates:[xLng(cluster.x),yLat(cluster.y)]}}}function getClusterProperties(cluster){var count=cluster.numPoints,abbrev=count>=1e4?Math.round(count/1e3)+"k":count>=1e3?Math.round(count/100)/10+"k":count;return extend(extend({},cluster.properties),{cluster:!0,cluster_id:cluster.id,point_count:count,point_count_abbreviated:abbrev})}function lngX(lng){return lng/360+.5}function latY(lat){var sin=Math.sin(lat*Math.PI/180),y=.5-.25*Math.log((1+sin)/(1-sin))/Math.PI;return y<0?0:y>1?1:y}function xLng(x){return 360*(x-.5)}function yLat(y){var y2=(180-360*y)*Math.PI/180;return 360*Math.atan(Math.exp(y2))/Math.PI-90}function extend(dest,src){for(var id in src)dest[id]=src[id];return dest}function getX(p){return p.x}function getY(p){return p.y}var kdbush=require("kdbush");module.exports=supercluster,SuperCluster.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(props){return props}},load:function(points){var log=this.options.log;log&&console.time("total time");var timerId="prepare "+points.length+" points";log&&console.time(timerId),this.points=points;var clusters=points.map(createPointCluster);log&&console.timeEnd(timerId);for(var z=this.options.maxZoom;z>=this.options.minZoom;z--){var now=+Date.now();this.trees[z+1]=kdbush(clusters,getX,getY,this.options.nodeSize,Float32Array),clusters=this._cluster(clusters,z),log&&console.log("z%d: %d clusters in %dms",z,clusters.length,+Date.now()-now)}return this.trees[this.options.minZoom]=kdbush(clusters,getX,getY,this.options.nodeSize,Float32Array),log&&console.timeEnd("total time"),this},getClusters:function(bbox,zoom){for(var tree=this.trees[this._limitZoom(zoom)],ids=tree.range(lngX(bbox[0]),latY(bbox[3]),lngX(bbox[2]),latY(bbox[1])),clusters=[],i=0;i<ids.length;i++){var c=tree.points[ids[i]];clusters.push(c.numPoints?getClusterJSON(c):this.points[c.id])}return clusters},getChildren:function(clusterId,clusterZoom){for(var origin=this.trees[clusterZoom+1].points[clusterId],r=this.options.radius/(this.options.extent*Math.pow(2,clusterZoom)),points=this.trees[clusterZoom+1].within(origin.x,origin.y,r),children=[],i=0;i<points.length;i++){var c=this.trees[clusterZoom+1].points[points[i]];c.parentId===clusterId&&children.push(c.numPoints?getClusterJSON(c):this.points[c.id])}return children},getLeaves:function(clusterId,clusterZoom,limit,offset){limit=limit||10,offset=offset||0;var leaves=[];return this._appendLeaves(leaves,clusterId,clusterZoom,limit,offset,0),leaves},getTile:function(z,x,y){var tree=this.trees[this._limitZoom(z)],z2=Math.pow(2,z),extent=this.options.extent,p=this.options.radius/extent,top=(y-p)/z2,bottom=(y+1+p)/z2,tile={features:[]};return this._addTileFeatures(tree.range((x-p)/z2,top,(x+1+p)/z2,bottom),tree.points,x,y,z2,tile),0===x&&this._addTileFeatures(tree.range(1-p/z2,top,1,bottom),tree.points,z2,y,z2,tile),x===z2-1&&this._addTileFeatures(tree.range(0,top,p/z2,bottom),tree.points,-1,y,z2,tile),tile.features.length?tile:null},getClusterExpansionZoom:function(clusterId,clusterZoom){for(;clusterZoom<this.options.maxZoom;){var children=this.getChildren(clusterId,clusterZoom);if(clusterZoom++,1!==children.length)break;clusterId=children[0].properties.cluster_id}return clusterZoom},_appendLeaves:function(result,clusterId,clusterZoom,limit,offset,skipped){for(var children=this.getChildren(clusterId,clusterZoom),i=0;i<children.length;i++){var props=children[i].properties;if(props.cluster?skipped+props.point_count<=offset?skipped+=props.point_count:skipped=this._appendLeaves(result,props.cluster_id,clusterZoom+1,limit,offset,skipped):skipped<offset?skipped++:result.push(children[i]),result.length===limit)break}return skipped},_addTileFeatures:function(ids,points,x,y,z2,tile){for(var i=0;i<ids.length;i++){var c=points[ids[i]];tile.features.push({type:1,geometry:[[Math.round(this.options.extent*(c.x*z2-x)),Math.round(this.options.extent*(c.y*z2-y))]],tags:c.numPoints?getClusterProperties(c):this.points[c.id].properties})}},_limitZoom:function(z){return Math.max(this.options.minZoom,Math.min(z,this.options.maxZoom+1))},_cluster:function(points,zoom){for(var clusters=[],r=this.options.radius/(this.options.extent*Math.pow(2,zoom)),i=0;i<points.length;i++){var p=points[i];if(!(p.zoom<=zoom)){p.zoom=zoom;var tree=this.trees[zoom+1],neighborIds=tree.within(p.x,p.y,r),numPoints=p.numPoints||1,wx=p.x*numPoints,wy=p.y*numPoints,clusterProperties=null;this.options.reduce&&(clusterProperties=this.options.initial(),this._accumulate(clusterProperties,p));for(var j=0;j<neighborIds.length;j++){var b=tree.points[neighborIds[j]];if(zoom<b.zoom){var numPoints2=b.numPoints||1;b.zoom=zoom,wx+=b.x*numPoints2,wy+=b.y*numPoints2,numPoints+=numPoints2,b.parentId=i,this.options.reduce&&this._accumulate(clusterProperties,b)}}1===numPoints?clusters.push(p):(p.parentId=i,clusters.push(createCluster(wx/numPoints,wy/numPoints,numPoints,i,clusterProperties)))}}return clusters},_accumulate:function(clusterProperties,point){var properties=point.numPoints?point.properties:this.options.map(this.points[point.id].properties);this.options.reduce(clusterProperties,properties)}}},{kdbush:19}],70:[function(require,module,exports){function UnitBezier(p1x,p1y,p2x,p2y){this.cx=3*p1x,this.bx=3*(p2x-p1x)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*p1y,this.by=3*(p2y-p1y)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p1x,this.p1y=p2y,this.p2x=p2x,this.p2y=p2y}module.exports=UnitBezier,UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},UnitBezier.prototype.solveCurveX=function(x,epsilon){void 0===epsilon&&(epsilon=1e-6);var t0,t1,t2,x2,i;for(t2=x,i=0;i<8;i++){if(x2=this.sampleCurveX(t2)-x,Math.abs(x2)<epsilon)return t2;var d2=this.sampleCurveDerivativeX(t2);if(Math.abs(d2)<1e-6)break;t2-=x2/d2}if(t0=0,t1=1,(t2=x)<t0)return t0;if(t2>t1)return t1;for(;t0<t1;){if(x2=this.sampleCurveX(t2),Math.abs(x2-x)<epsilon)return t2;x>x2?t0=t2:t1=t2,t2=.5*(t1-t0)+t0}return t2},UnitBezier.prototype.solve=function(x,epsilon){return this.sampleCurveY(this.solveCurveX(x,epsilon))}},{}],71:[function(require,module,exports){module.exports.VectorTile=require("./lib/vectortile.js"),module.exports.VectorTileFeature=require("./lib/vectortilefeature.js"),module.exports.VectorTileLayer=require("./lib/vectortilelayer.js")},{"./lib/vectortile.js":72,"./lib/vectortilefeature.js":73,"./lib/vectortilelayer.js":74}],72:[function(require,module,exports){"use strict";function VectorTile(pbf,end){this.layers=pbf.readFields(readTile,{},end)}function readTile(tag,layers,pbf){if(3===tag){var layer=new VectorTileLayer(pbf,pbf.readVarint()+pbf.pos);layer.length&&(layers[layer.name]=layer)}}var VectorTileLayer=require("./vectortilelayer");module.exports=VectorTile},{"./vectortilelayer":74}],73:[function(require,module,exports){"use strict";function VectorTileFeature(pbf,end,extent,keys,values){this.properties={},this.extent=extent,this.type=0,this._pbf=pbf,this._geometry=-1,this._keys=keys,this._values=values,pbf.readFields(readFeature,this,end)}function readFeature(tag,feature,pbf){1==tag?feature.id=pbf.readVarint():2==tag?readTag(pbf,feature):3==tag?feature.type=pbf.readVarint():4==tag&&(feature._geometry=pbf.pos)}function readTag(pbf,feature){for(var end=pbf.readVarint()+pbf.pos;pbf.pos<end;){var key=feature._keys[pbf.readVarint()],value=feature._values[pbf.readVarint()];feature.properties[key]=value}}function classifyRings(rings){var len=rings.length;if(len<=1)return[rings];for(var polygon,ccw,polygons=[],i=0;i<len;i++){var area=signedArea(rings[i]);0!==area&&(void 0===ccw&&(ccw=area<0),ccw===area<0?(polygon&&polygons.push(polygon),polygon=[rings[i]]):polygon.push(rings[i]))}return polygon&&polygons.push(polygon),polygons}function signedArea(ring){for(var p1,p2,sum=0,i=0,len=ring.length,j=len-1;i<len;j=i++)p1=ring[i],sum+=((p2=ring[j]).x-p1.x)*(p1.y+p2.y);return sum}var Point=require("point-geometry");module.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var pbf=this._pbf;pbf.pos=this._geometry;for(var line,end=pbf.readVarint()+pbf.pos,cmd=1,length=0,x=0,y=0,lines=[];pbf.pos<end;){if(!length){var cmdLen=pbf.readVarint();cmd=7&cmdLen,length=cmdLen>>3}if(length--,1===cmd||2===cmd)x+=pbf.readSVarint(),y+=pbf.readSVarint(),1===cmd&&(line&&lines.push(line),line=[]),line.push(new Point(x,y));else{if(7!==cmd)throw new Error("unknown command "+cmd);line&&line.push(line[0].clone())}}return line&&lines.push(line),lines},VectorTileFeature.prototype.bbox=function(){var pbf=this._pbf;pbf.pos=this._geometry;for(var end=pbf.readVarint()+pbf.pos,cmd=1,length=0,x=0,y=0,x1=1/0,x2=-1/0,y1=1/0,y2=-1/0;pbf.pos<end;){if(!length){var cmdLen=pbf.readVarint();cmd=7&cmdLen,length=cmdLen>>3}if(length--,1===cmd||2===cmd)x+=pbf.readSVarint(),y+=pbf.readSVarint(),x<x1&&(x1=x),x>x2&&(x2=x),y<y1&&(y1=y),y>y2&&(y2=y);else if(7!==cmd)throw new Error("unknown command "+cmd)}return[x1,y1,x2,y2]},VectorTileFeature.prototype.toGeoJSON=function(x,y,z){function project(line){for(var j=0;j<line.length;j++){var p=line[j],y2=180-360*(p.y+y0)/size;line[j]=[360*(p.x+x0)/size-180,360/Math.PI*Math.atan(Math.exp(y2*Math.PI/180))-90]}}var i,j,size=this.extent*Math.pow(2,z),x0=this.extent*x,y0=this.extent*y,coords=this.loadGeometry(),type=VectorTileFeature.types[this.type];switch(this.type){case 1:var points=[];for(i=0;i<coords.length;i++)points[i]=coords[i][0];project(coords=points);break;case 2:for(i=0;i<coords.length;i++)project(coords[i]);break;case 3:for(coords=classifyRings(coords),i=0;i<coords.length;i++)for(j=0;j<coords[i].length;j++)project(coords[i][j])}1===coords.length?coords=coords[0]:type="Multi"+type;var result={type:"Feature",geometry:{type:type,coordinates:coords},properties:this.properties};return"id"in this&&(result.id=this.id),result}},{"point-geometry":65}],74:[function(require,module,exports){"use strict";function VectorTileLayer(pbf,end){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=pbf,this._keys=[],this._values=[],this._features=[],pbf.readFields(readLayer,this,end),this.length=this._features.length}function readLayer(tag,layer,pbf){15===tag?layer.version=pbf.readVarint():1===tag?layer.name=pbf.readString():5===tag?layer.extent=pbf.readVarint():2===tag?layer._features.push(pbf.pos):3===tag?layer._keys.push(pbf.readString()):4===tag&&layer._values.push(readValueMessage(pbf))}function readValueMessage(pbf){for(var value=null,end=pbf.readVarint()+pbf.pos;pbf.pos<end;){var tag=pbf.readVarint()>>3;value=1===tag?pbf.readString():2===tag?pbf.readFloat():3===tag?pbf.readDouble():4===tag?pbf.readVarint64():5===tag?pbf.readVarint():6===tag?pbf.readSVarint():7===tag?pbf.readBoolean():null}return value}var VectorTileFeature=require("./vectortilefeature.js");module.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var end=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,end,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":73}],75:[function(require,module,exports){function fromVectorTileJs(tile){var layers=[];for(var l in tile.layers)layers.push(prepareLayer(tile.layers[l]));var out=new Pbf;return vtpb.tile.write({layers:layers},out),out.finish()}function fromGeojsonVt(layers){var l={};for(var k in layers)l[k]=new GeoJSONWrapper(layers[k].features),l[k].name=k;return fromVectorTileJs({layers:l})}function prepareLayer(layer){for(var preparedLayer={name:layer.name||"",version:layer.version||1,extent:layer.extent||4096,keys:[],values:[],features:[]},keycache={},valuecache={},i=0;i<layer.length;i++){var feature=layer.feature(i);feature.geometry=encodeGeometry(feature.loadGeometry());var tags=[];for(var key in feature.properties){var keyIndex=keycache[key];void 0===keyIndex&&(preparedLayer.keys.push(key),keyIndex=preparedLayer.keys.length-1,keycache[key]=keyIndex);var value=wrapValue(feature.properties[key]),valueIndex=valuecache[value.key];void 0===valueIndex&&(preparedLayer.values.push(value),valueIndex=preparedLayer.values.length-1,valuecache[value.key]=valueIndex),tags.push(keyIndex),tags.push(valueIndex)}feature.tags=tags,preparedLayer.features.push(feature)}return preparedLayer}function command(cmd,length){return(length<<3)+(7&cmd)}function zigzag(num){return num<<1^num>>31}function encodeGeometry(geometry){for(var encoded=[],x=0,y=0,rings=geometry.length,r=0;r<rings;r++){var ring=geometry[r];encoded.push(command(1,1));for(var i=0;i<ring.length;i++){1===i&&encoded.push(command(2,ring.length-1));var dx=ring[i].x-x,dy=ring[i].y-y;encoded.push(zigzag(dx),zigzag(dy)),x+=dx,y+=dy}}return encoded}function wrapValue(value){var result,type=typeof value;return result="string"===type?{string_value:value}:"boolean"===type?{bool_value:value}:"number"===type?value%1!=0?{double_value:value}:value<0?{sint_value:value}:{uint_value:value}:{string_value:value=JSON.stringify(value)},result.key=type+":"+value,result}var Pbf=require("pbf"),vtpb=require("./vector-tile-pb"),GeoJSONWrapper=require("./lib/geojson_wrapper");module.exports=fromVectorTileJs,module.exports.fromVectorTileJs=fromVectorTileJs,module.exports.fromGeojsonVt=fromGeojsonVt,module.exports.GeoJSONWrapper=GeoJSONWrapper},{"./lib/geojson_wrapper":76,"./vector-tile-pb":77,pbf:64}],76:[function(require,module,exports){"use strict";function GeoJSONWrapper(features){this.features=features,this.length=features.length}function FeatureWrapper(feature){this.id="number"==typeof feature.id?feature.id:void 0,this.type=feature.type,this.rawGeometry=1===feature.type?[feature.geometry]:feature.geometry,this.properties=feature.tags,this.extent=4096}var Point=require("point-geometry"),VectorTileFeature=require("vector-tile").VectorTileFeature;module.exports=GeoJSONWrapper,GeoJSONWrapper.prototype.feature=function(i){return new FeatureWrapper(this.features[i])},FeatureWrapper.prototype.loadGeometry=function(){var rings=this.rawGeometry;this.geometry=[];for(var i=0;i<rings.length;i++){for(var ring=rings[i],newRing=[],j=0;j<ring.length;j++)newRing.push(new Point(ring[j][0],ring[j][1]));this.geometry.push(newRing)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var rings=this.geometry,x1=1/0,x2=-1/0,y1=1/0,y2=-1/0,i=0;i<rings.length;i++)for(var ring=rings[i],j=0;j<ring.length;j++){var coord=ring[j];x1=Math.min(x1,coord.x),x2=Math.max(x2,coord.x),y1=Math.min(y1,coord.y),y2=Math.max(y2,coord.y)}return[x1,y1,x2,y2]},FeatureWrapper.prototype.toGeoJSON=VectorTileFeature.prototype.toGeoJSON},{"point-geometry":65,"vector-tile":71}],77:[function(require,module,exports){"use strict";function readTile(pbf,end){return pbf.readFields(readTileField,{layers:[]},end)}function readTileField(tag,tile,pbf){3===tag&&tile.layers.push(readLayer(pbf,pbf.readVarint()+pbf.pos))}function writeTile(tile,pbf){var i;if(void 0!==tile.layers)for(i=0;i<tile.layers.length;i++)pbf.writeMessage(3,writeLayer,tile.layers[i])}function readValue(pbf,end){return pbf.readFields(readValueField,{},end)}function readValueField(tag,value,pbf){1===tag?value.string_value=pbf.readString():2===tag?value.float_value=pbf.readFloat():3===tag?value.double_value=pbf.readDouble():4===tag?value.int_value=pbf.readVarint():5===tag?value.uint_value=pbf.readVarint():6===tag?value.sint_value=pbf.readSVarint():7===tag&&(value.bool_value=pbf.readBoolean())}function writeValue(value,pbf){void 0!==value.string_value&&pbf.writeStringField(1,value.string_value),void 0!==value.float_value&&pbf.writeFloatField(2,value.float_value),void 0!==value.double_value&&pbf.writeDoubleField(3,value.double_value),void 0!==value.int_value&&pbf.writeVarintField(4,value.int_value),void 0!==value.uint_value&&pbf.writeVarintField(5,value.uint_value),void 0!==value.sint_value&&pbf.writeSVarintField(6,value.sint_value),void 0!==value.bool_value&&pbf.writeBooleanField(7,value.bool_value)}function readFeature(pbf,end){var feature=pbf.readFields(readFeatureField,{},end);return void 0===feature.type&&(feature.type="Unknown"),feature}function readFeatureField(tag,feature,pbf){1===tag?feature.id=pbf.readVarint():2===tag?feature.tags=pbf.readPackedVarint():3===tag?feature.type=pbf.readVarint():4===tag&&(feature.geometry=pbf.readPackedVarint())}function writeFeature(feature,pbf){void 0!==feature.id&&pbf.writeVarintField(1,feature.id),void 0!==feature.tags&&pbf.writePackedVarint(2,feature.tags),void 0!==feature.type&&pbf.writeVarintField(3,feature.type),void 0!==feature.geometry&&pbf.writePackedVarint(4,feature.geometry)}function readLayer(pbf,end){return pbf.readFields(readLayerField,{features:[],keys:[],values:[]},end)}function readLayerField(tag,layer,pbf){15===tag?layer.version=pbf.readVarint():1===tag?layer.name=pbf.readString():2===tag?layer.features.push(readFeature(pbf,pbf.readVarint()+pbf.pos)):3===tag?layer.keys.push(pbf.readString()):4===tag?layer.values.push(readValue(pbf,pbf.readVarint()+pbf.pos)):5===tag&&(layer.extent=pbf.readVarint())}function writeLayer(layer,pbf){void 0!==layer.version&&pbf.writeVarintField(15,layer.version),void 0!==layer.name&&pbf.writeStringField(1,layer.name);var i;if(void 0!==layer.features)for(i=0;i<layer.features.length;i++)pbf.writeMessage(2,writeFeature,layer.features[i]);if(void 0!==layer.keys)for(i=0;i<layer.keys.length;i++)pbf.writeStringField(3,layer.keys[i]);if(void 0!==layer.values)for(i=0;i<layer.values.length;i++)pbf.writeMessage(4,writeValue,layer.values[i]);void 0!==layer.extent&&pbf.writeVarintField(5,layer.extent)}var tile=exports.tile={read:readTile,write:writeTile};tile.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3},tile.value={read:readValue,write:writeValue},tile.feature={read:readFeature,write:writeFeature},tile.layer={read:readLayer,write:writeLayer}},{}],78:[function(require,module,exports){var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(fn,options){function resolveSources(key){workerSources[key]=!0;for(var depPath in sources[key][1]){var depKey=sources[key][1][depPath];workerSources[depKey]||resolveSources(depKey)}}for(var wkey,cacheKeys=Object.keys(cache),i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i],exp=cache[key].exports;if(exp===fn||exp&&exp.default===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var wcache={},i=0,l=cacheKeys.length;i<l;i++)wcache[key=cacheKeys[i]]=key;sources[wkey]=[Function(["require","module","exports"],"("+fn+")(self)"),wcache]}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16),scache={};scache[wkey]=wkey,sources[skey]=[Function(["require"],"var f = require("+stringify(wkey)+");(f.default ? f.default : f)(self);"),scache];var workerSources={};resolveSources(skey);var src="("+bundleFn+")({"+Object.keys(workerSources).map(function(key){return stringify(key)+":["+sources[key][0]+","+stringify(sources[key][1])+"]"}).join(",")+"},{},["+stringify(skey)+"])",URL=window.URL||window.webkitURL||window.mozURL||window.msURL,blob=new Blob([src],{type:"text/javascript"});if(options&&options.bare)return blob;var workerUrl=URL.createObjectURL(blob),worker=new Worker(workerUrl);return worker.objectURL=workerUrl,worker}},{}],79:[function(require,module,exports){module.exports.RADIUS=6378137,module.exports.FLATTENING=1/298.257223563,module.exports.POLAR_RADIUS=6356752.3142},{}],80:[function(require,module,exports){function replacer(key,value){return util.isUndefined(value)?""+value:util.isNumber(value)&&!isFinite(value)?value.toString():util.isFunction(value)||util.isRegExp(value)?value.toString():value}function truncate(s,n){return util.isString(s)?s.length<n?s:s.slice(0,n):s}function getMessage(self){return truncate(JSON.stringify(self.actual,replacer),128)+" "+self.operator+" "+truncate(JSON.stringify(self.expected,replacer),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}function ok(value,message){value||fail(value,!0,message,"==",assert.ok)}function _deepEqual(actual,expected){if(actual===expected)return!0;if(util.isBuffer(actual)&&util.isBuffer(expected)){if(actual.length!=expected.length)return!1;for(var i=0;i<actual.length;i++)if(actual[i]!==expected[i])return!1;return!0}return util.isDate(actual)&&util.isDate(expected)?actual.getTime()===expected.getTime():util.isRegExp(actual)&&util.isRegExp(expected)?actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase:util.isObject(actual)||util.isObject(expected)?objEquiv(actual,expected):actual==expected}function isArguments(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function objEquiv(a,b){if(util.isNullOrUndefined(a)||util.isNullOrUndefined(b))return!1;if(a.prototype!==b.prototype)return!1;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;var aIsArgs=isArguments(a),bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return!1;if(aIsArgs)return a=pSlice.call(a),b=pSlice.call(b),_deepEqual(a,b);var key,i,ka=objectKeys(a),kb=objectKeys(b);if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!=kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!_deepEqual(a[key],b[key]))return!1;return!0}function expectedException(actual,expected){return!(!actual||!expected)&&("[object RegExp]"==Object.prototype.toString.call(expected)?expected.test(actual):actual instanceof expected||!0===expected.call({},actual))}function _throws(shouldThrow,block,expected,message){var actual;util.isString(expected)&&(message=expected,expected=null);try{block()}catch(e){actual=e}if(message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:"."),shouldThrow&&!actual&&fail(actual,expected,"Missing expected exception"+message),!shouldThrow&&expectedException(actual,expected)&&fail(actual,expected,"Got unwanted exception"+message),shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual)throw actual}var util=require("util/"),pSlice=Array.prototype.slice,hasOwn=Object.prototype.hasOwnProperty,assert=module.exports=ok;assert.AssertionError=function(options){this.name="AssertionError",this.actual=options.actual,this.expected=options.expected,this.operator=options.operator,options.message?(this.message=options.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,stackStartFunction);else{var err=new Error;if(err.stack){var out=err.stack,fn_name=stackStartFunction.name,idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}},util.inherits(assert.AssertionError,Error),assert.fail=fail,assert.ok=ok,assert.equal=function(actual,expected,message){actual!=expected&&fail(actual,expected,message,"==",assert.equal)},assert.notEqual=function(actual,expected,message){actual==expected&&fail(actual,expected,message,"!=",assert.notEqual)},assert.deepEqual=function(actual,expected,message){_deepEqual(actual,expected)||fail(actual,expected,message,"deepEqual",assert.deepEqual)},assert.notDeepEqual=function(actual,expected,message){_deepEqual(actual,expected)&&fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)},assert.strictEqual=function(actual,expected,message){actual!==expected&&fail(actual,expected,message,"===",assert.strictEqual)},assert.notStrictEqual=function(actual,expected,message){actual===expected&&fail(actual,expected,message,"!==",assert.notStrictEqual)},assert.throws=function(block,error,message){_throws.apply(this,[!0].concat(pSlice.call(arguments)))},assert.doesNotThrow=function(block,message){_throws.apply(this,[!1].concat(pSlice.call(arguments)))},assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)hasOwn.call(obj,key)&&keys.push(key);return keys}},{"util/":84}],81:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],82:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],83:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],84:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)&&(base=" [Function"+(value.name?": "+value.name:"")+"]"),isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(recurseTimes<0)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1)).indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;(name=JSON.stringify(""+key)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;return output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(!0===process.noDeprecation)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":83,_process:82,inherits:81}]},{},[1])(1)});
